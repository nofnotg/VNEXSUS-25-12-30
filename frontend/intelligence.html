<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Intelligence Platform 2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .results-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .panel-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #4a5568;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2d3748;
        }

        .form-group textarea {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #edf2f7;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 500;
            color: #718096;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-ready { background: #48bb78; }
        .status-processing { background: #ed8936; animation: pulse 2s infinite; }
        .status-error { background: #f56565; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
            width: 0%;
        }

        .result-card {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .result-card h4 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .metric-label {
            color: #718096;
        }

        .metric-value {
            font-weight: 600;
            color: #2d3748;
        }

        .timeline-item {
            border-left: 3px solid #667eea;
            padding-left: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 5px;
            width: 9px;
            height: 9px;
            border-radius: 50%;
            background: #667eea;
        }

        .timeline-date {
            font-size: 12px;
            color: #718096;
            margin-bottom: 5px;
        }

        .timeline-content {
            color: #2d3748;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .alert-success {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            color: #22543d;
        }

        .alert-error {
            background: #fed7d7;
            border: 1px solid #feb2b2;
            color: #742a2a;
        }

        .alert-info {
            background: #ebf8ff;
            border: 1px solid #90cdf4;
            color: #2a4365;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .file-upload {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .file-upload.dragover {
            border-color: #667eea;
            background: #ebf8ff;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  Medical Intelligence Platform 2.0</h1>
            <p>AI ê¸°ë°˜ ì˜ë£Œë¬¸ì„œ ì§€ëŠ¥í˜• ë¶„ì„ ì‹œìŠ¤í…œ</p>
        </div>

        <div class="main-content">
            <!-- ì…ë ¥ íŒ¨ë„ -->
            <div class="input-panel">
                <h2 class="panel-title">ğŸ“„ ë¬¸ì„œ ì…ë ¥</h2>
                
                <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ -->
                <div class="file-upload" id="fileUpload">
                    <div>ğŸ“ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</div>
                    <div style="font-size: 12px; color: #718096; margin-top: 5px;">ì§€ì› í˜•ì‹: TXT, PDF, DOC, DOCX (ìµœëŒ€ 10MB)</div>
                    <input type="file" id="fileInput" class="hidden" accept=".txt,.pdf,.doc,.docx">
                </div>

                <!-- í…ìŠ¤íŠ¸ ì…ë ¥ -->
                <div class="form-group">
                    <label for="inputText">ë˜ëŠ” ì§ì ‘ í…ìŠ¤íŠ¸ ì…ë ¥:</label>
                    <textarea id="inputText" placeholder="ì˜ë£Œë¬¸ì„œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...&#10;&#10;ì˜ˆì‹œ:&#10;í™˜ìëª…: ê¹€ì² ìˆ˜ (ë‚¨, 45ì„¸)&#10;ì§„ë£Œì¼: 2024-01-15&#10;ì§„ë£Œê¸°ê´€: ì„œìš¸ëŒ€í•™êµë³‘ì› ë‚´ê³¼&#10;&#10;ì£¼ì†Œ: ê³ í˜ˆì••ìœ¼ë¡œ ì¸í•œ ë‘í†µ ë° ì–´ì§€ëŸ¬ì›€&#10;&#10;í˜„ë³‘ë ¥:&#10;- 2023ë…„ 12ì›”ë¶€í„° í˜ˆì•• ìƒìŠ¹ (160/100 mmHg)&#10;- ê°„í—ì  ë‘í†µ ë° ì–´ì§€ëŸ¬ì›€ í˜¸ì†Œ&#10;- ê°€ì¡±ë ¥: ë¶€ì¹œ ê³ í˜ˆì••, ë‹¹ë‡¨ë³‘&#10;&#10;ì§„ë‹¨:&#10;1. ë³¸íƒœì„± ê³ í˜ˆì•• (I10)&#10;2. ê¸´ì¥ì„± ë‘í†µ (G44.2)&#10;&#10;ì²˜ë°©:&#10;- ì•”ë¡œë””í•€ 5mg 1ì¼ 1íšŒ&#10;- ì•„ìŠ¤í”¼ë¦° 100mg 1ì¼ 1íšŒ&#10;&#10;ê³„íš:&#10;- 2ì£¼ í›„ ì™¸ë˜ ì¶”ì ê´€ì°°&#10;- í˜ˆì•• ëª¨ë‹ˆí„°ë§&#10;- ìƒí™œìŠµê´€ ê°œì„  êµìœ¡"></textarea>
                </div>

                <!-- ì²˜ë¦¬ ì˜µì…˜ -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="processingMode">ì²˜ë¦¬ ëª¨ë“œ:</label>
                        <select id="processingMode">
                            <option value="FAST">âš¡ ë¹ ë¥¸ ì²˜ë¦¬ (ë¹„ìš© ìµœì í™”)</option>
                            <option value="BALANCED" selected>âš–ï¸ ê· í˜• ëª¨ë“œ (ê¶Œì¥)</option>
                            <option value="THOROUGH">ğŸ¯ ì •ë°€ ë¶„ì„ (ìµœê³  í’ˆì§ˆ)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="outputFormat">ì¶œë ¥ í˜•ì‹:</label>
                        <select id="outputFormat">
                            <option value="STANDARD">ğŸ“‹ í‘œì¤€ ë¦¬í¬íŠ¸</option>
                            <option value="ENHANCED">ğŸ“Š í–¥ìƒëœ ë¶„ì„</option>
                            <option value="MULTI_PANEL" selected>ğŸ›ï¸ ë©€í‹° íŒ¨ë„ (ì „ì²´)</option>
                        </select>
                    </div>
                </div>

                <!-- ê³ ê¸‰ ì˜µì…˜ -->
                <details style="margin-bottom: 20px;">
                    <summary style="cursor: pointer; font-weight: 500; margin-bottom: 10px;">ğŸ”§ ê³ ê¸‰ ì„¤ì •</summary>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="costLimit">ë¹„ìš© ì œí•œ (í† í°):</label>
                            <select id="costLimit">
                                <option value="5000">5,000 (ê²½ì œì )</option>
                                <option value="10000" selected>10,000 (í‘œì¤€)</option>
                                <option value="20000">20,000 (í”„ë¦¬ë¯¸ì—„)</option>
                                <option value="50000">50,000 (ë¬´ì œí•œ)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="accuracyThreshold">ì •í™•ë„ ì„ê³„ê°’:</label>
                            <select id="accuracyThreshold">
                                <option value="0.6">60% (ë¹ ë¥¸ ì²˜ë¦¬)</option>
                                <option value="0.8" selected>80% (ê· í˜•)</option>
                                <option value="0.9">90% (ê³ í’ˆì§ˆ)</option>
                                <option value="0.95">95% (ìµœê³ í’ˆì§ˆ)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="enableRealTime"> ì‹¤ì‹œê°„ ì²˜ë¦¬ ëª¨ë‹ˆí„°ë§ í™œì„±í™”
                        </label>
                    </div>
                </details>

                <!-- ë²„íŠ¼ ê·¸ë£¹ -->
                <div class="btn-group">
                    <button class="btn btn-primary" id="processBtn">
                        <span class="status-indicator status-ready"></span>
                        ğŸš€ ì§€ëŠ¥í˜• ë¶„ì„ ì‹œì‘
                    </button>
                    <button class="btn btn-secondary" id="demoBtn">
                        ğŸ¯ ë°ëª¨ ì‹¤í–‰
                    </button>
                    <button class="btn btn-secondary" id="clearBtn">
                        ğŸ—‘ï¸ ì´ˆê¸°í™”
                    </button>
                </div>

                <!-- ì§„í–‰ ìƒíƒœ -->
                <div id="progressSection" class="hidden" style="margin-top: 20px;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div id="progressText" style="text-align: center; margin-top: 5px; font-size: 14px; color: #718096;">
                        ì²˜ë¦¬ ì¤€ë¹„ ì¤‘...
                    </div>
                </div>
            </div>

            <!-- ê²°ê³¼ íŒ¨ë„ -->
            <div class="results-panel">
                <h2 class="panel-title">ğŸ“Š ë¶„ì„ ê²°ê³¼</h2>
                
                <div class="tabs">
                    <button class="tab active" data-tab="overview">ğŸ“‹ ê°œìš”</button>
                    <button class="tab" data-tab="raw">ğŸ” RAW</button>
                    <button class="tab" data-tab="thread">ğŸ§µ THREAD</button>
                    <button class="tab" data-tab="final">âœ… FINAL</button>
                    <button class="tab" data-tab="performance">âš¡ ì„±ëŠ¥</button>
                </div>

                <!-- ê°œìš” íƒ­ -->
                <div class="tab-content active" id="overview">
                    <div id="overviewContent">
                        <div class="alert alert-info">
                            ğŸ’¡ ì˜ë£Œë¬¸ì„œë¥¼ ì…ë ¥í•˜ê³  'ì§€ëŠ¥í˜• ë¶„ì„ ì‹œì‘' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
                            <br><br>
                            <strong>ì£¼ìš” ê¸°ëŠ¥:</strong>
                            <ul style="margin-top: 10px; padding-left: 20px;">
                                <li>ğŸ§  AI ê¸°ë°˜ ì˜ë£Œì •ë³´ ì¶”ì¶œ</li>
                                <li>ğŸ“… ì‹œê°„ìˆœ ì´ë²¤íŠ¸ ë¶„ì„</li>
                                <li>âš ï¸ ìœ„í—˜ë„ í‰ê°€</li>
                                <li>ğŸ’° ë³´í—˜ ì‹¬ì‚¬ ìµœì í™”</li>
                                <li>ğŸ“Š ì‹¤ì‹œê°„ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- RAW íƒ­ -->
                <div class="tab-content" id="raw">
                    <div id="rawContent">
                        <div class="loading">RAW ë°ì´í„° ëŒ€ê¸° ì¤‘</div>
                    </div>
                </div>

                <!-- THREAD íƒ­ -->
                <div class="tab-content" id="thread">
                    <div id="threadContent">
                        <div class="loading">THREAD ë¶„ì„ ëŒ€ê¸° ì¤‘</div>
                    </div>
                </div>

                <!-- FINAL íƒ­ -->
                <div class="tab-content" id="final">
                    <div id="finalContent">
                        <div class="loading">FINAL ê²°ê³¼ ëŒ€ê¸° ì¤‘</div>
                    </div>
                </div>

                <!-- ì„±ëŠ¥ íƒ­ -->
                <div class="tab-content" id="performance">
                    <div id="performanceContent">
                        <div class="loading">ì„±ëŠ¥ ë°ì´í„° ëŒ€ê¸° ì¤‘</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentJobId = null;
        let processingInterval = null;

        // DOM ìš”ì†Œ
        const fileUpload = document.getElementById('fileUpload');
        const fileInput = document.getElementById('fileInput');
        const inputText = document.getElementById('inputText');
        const processBtn = document.getElementById('processBtn');
        const demoBtn = document.getElementById('demoBtn');
        const clearBtn = document.getElementById('clearBtn');
        const progressSection = document.getElementById('progressSection');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');

        // íƒ­ ì‹œìŠ¤í…œ
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.dataset.tab;
                
                // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // ì„ íƒëœ íƒ­ í™œì„±í™”
                tab.classList.add('active');
                document.getElementById(targetTab).classList.add('active');
            });
        });

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        fileUpload.addEventListener('click', () => fileInput.click());
        fileUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUpload.classList.add('dragover');
        });
        fileUpload.addEventListener('dragleave', () => {
            fileUpload.classList.remove('dragover');
        });
        fileUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUpload.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ í•¨ìˆ˜
        async function handleFileUpload(file) {
            if (file.size > 10 * 1024 * 1024) {
                showAlert('íŒŒì¼ í¬ê¸°ê°€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);
            formData.append('mode', document.getElementById('processingMode').value);
            formData.append('outputFormat', document.getElementById('outputFormat').value);
            formData.append('costLimit', document.getElementById('costLimit').value);
            formData.append('accuracyThreshold', document.getElementById('accuracyThreshold').value);
            formData.append('realTime', document.getElementById('enableRealTime').checked);

            try {
                setProcessingState(true);
                showAlert(`íŒŒì¼ ì—…ë¡œë“œ ì¤‘: ${file.name}`, 'info');

                const response = await fetch('/api/intelligence/upload', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    currentJobId = result.jobId;
                    showAlert('íŒŒì¼ ì—…ë¡œë“œ ë° ì²˜ë¦¬ ì™„ë£Œ!', 'success');
                    displayResults(result);
                } else {
                    showAlert(`ì²˜ë¦¬ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Upload error:', error);
                showAlert(`ì—…ë¡œë“œ ì˜¤ë¥˜: ${error.message}`, 'error');
            } finally {
                setProcessingState(false);
            }
        }

        // ì²˜ë¦¬ ì‹œì‘
        processBtn.addEventListener('click', async () => {
            const text = inputText.value.trim();
            if (!text) {
                showAlert('ì²˜ë¦¬í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            const requestData = {
                text: text,
                mode: document.getElementById('processingMode').value,
                outputFormat: document.getElementById('outputFormat').value,
                costLimit: parseInt(document.getElementById('costLimit').value),
                accuracyThreshold: parseFloat(document.getElementById('accuracyThreshold').value),
                realTime: document.getElementById('enableRealTime').checked
            };

            try {
                setProcessingState(true);
                showAlert('ì§€ëŠ¥í˜• ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');

                const response = await fetch('/api/intelligence/process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                
                if (result.success) {
                    currentJobId = result.jobId;
                    showAlert('ë¶„ì„ ì™„ë£Œ!', 'success');
                    displayResults(result);
                } else {
                    showAlert(`ë¶„ì„ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Processing error:', error);
                showAlert(`ì²˜ë¦¬ ì˜¤ë¥˜: ${error.message}`, 'error');
            } finally {
                setProcessingState(false);
            }
        });

        // ë°ëª¨ ì‹¤í–‰
        demoBtn.addEventListener('click', async () => {
            try {
                setProcessingState(true);
                showAlert('ë°ëª¨ ì‹¤í–‰ ì¤‘...', 'info');

                const response = await fetch('/api/intelligence/demo');
                const result = await response.json();
                
                if (result.success) {
                    currentJobId = result.jobId;
                    showAlert('ë°ëª¨ ì‹¤í–‰ ì™„ë£Œ!', 'success');
                    displayResults(result);
                } else {
                    showAlert(`ë°ëª¨ ì‹¤í–‰ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Demo error:', error);
                showAlert(`ë°ëª¨ ì˜¤ë¥˜: ${error.message}`, 'error');
            } finally {
                setProcessingState(false);
            }
        });

        // ì´ˆê¸°í™”
        clearBtn.addEventListener('click', () => {
            inputText.value = '';
            currentJobId = null;
            clearResults();
            showAlert('ì´ˆê¸°í™” ì™„ë£Œ', 'success');
        });

        // ì²˜ë¦¬ ìƒíƒœ ì„¤ì •
        function setProcessingState(processing) {
            const statusIndicator = processBtn.querySelector('.status-indicator');
            
            if (processing) {
                processBtn.disabled = true;
                processBtn.innerHTML = '<span class="status-indicator status-processing"></span>ğŸ”„ ì²˜ë¦¬ ì¤‘...';
                progressSection.classList.remove('hidden');
                updateProgress(0, 'ì²˜ë¦¬ ì‹œì‘...');
                
                // ì§„í–‰ë¥  ì‹œë®¬ë ˆì´ì…˜
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += Math.random() * 10;
                    if (progress > 90) progress = 90;
                    updateProgress(progress, 'ë¶„ì„ ì§„í–‰ ì¤‘...');
                }, 500);
                
                setTimeout(() => {
                    clearInterval(progressInterval);
                    updateProgress(100, 'ì™„ë£Œ!');
                }, 3000);
            } else {
                processBtn.disabled = false;
                processBtn.innerHTML = '<span class="status-indicator status-ready"></span>ğŸš€ ì§€ëŠ¥í˜• ë¶„ì„ ì‹œì‘';
                setTimeout(() => {
                    progressSection.classList.add('hidden');
                }, 1000);
            }
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress(percent, text) {
            progressFill.style.width = `${percent}%`;
            progressText.textContent = text;
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            const overviewContent = document.getElementById('overviewContent');
            overviewContent.insertBefore(alertDiv, overviewContent.firstChild);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 5000);
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResults(result) {
            // ê°œìš” ì—…ë°ì´íŠ¸
            updateOverview(result);
            
            // RAW ë°ì´í„° í‘œì‹œ
            if (result.results.raw) {
                updateRawPanel(result.results.raw);
            }
            
            // THREAD ë°ì´í„° í‘œì‹œ
            if (result.results.thread) {
                updateThreadPanel(result.results.thread);
            }
            
            // FINAL ë°ì´í„° í‘œì‹œ
            if (result.results.final) {
                updateFinalPanel(result.results.final);
            }
            
            // ì„±ëŠ¥ ë°ì´í„° í‘œì‹œ
            updatePerformancePanel(result.performance, result.recommendations);
        }

        // ê°œìš” ì—…ë°ì´íŠ¸
        function updateOverview(result) {
            const content = document.getElementById('overviewContent');
            content.innerHTML = `
                <div class="result-card">
                    <h4>ğŸ“Š ì²˜ë¦¬ ê²°ê³¼ ìš”ì•½</h4>
                    <div class="metric">
                        <span class="metric-label">ì‘ì—… ID:</span>
                        <span class="metric-value">${result.jobId}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ì²˜ë¦¬ ì „ëµ:</span>
                        <span class="metric-value">${result.processingStrategy}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ì²˜ë¦¬ ì‹œê°„:</span>
                        <span class="metric-value">${(result.performance.totalTime / 1000).toFixed(2)}ì´ˆ</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">í’ˆì§ˆ ì ìˆ˜:</span>
                        <span class="metric-value">${(result.performance.qualityScore * 100).toFixed(1)}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">íš¨ìœ¨ì„±:</span>
                        <span class="metric-value">${(result.performance.efficiency * 100).toFixed(1)}%</span>
                    </div>
                </div>
                
                <div class="result-card">
                    <h4>ğŸ’¡ ì¶”ì²œì‚¬í•­</h4>
                    <p><strong>ë‹¤ìŒ ì²˜ë¦¬:</strong> ${result.recommendations.nextProcessing}</p>
                    ${result.recommendations.optimizations.length > 0 ? `
                        <p><strong>ìµœì í™”:</strong></p>
                        <ul>
                            ${result.recommendations.optimizations.map(opt => `<li>${opt}</li>`).join('')}
                        </ul>
                    ` : ''}
                    ${result.recommendations.costSavings.length > 0 ? `
                        <p><strong>ë¹„ìš© ì ˆì•½:</strong></p>
                        <ul>
                            ${result.recommendations.costSavings.map(saving => `<li>${saving}</li>`).join('')}
                        </ul>
                    ` : ''}
                </div>
            `;
        }

        // RAW íŒ¨ë„ ì—…ë°ì´íŠ¸
        function updateRawPanel(rawData) {
            const content = document.getElementById('rawContent');
            content.innerHTML = `
                <div class="result-card">
                    <h4>ğŸ“„ ì›ë³¸ í…ìŠ¤íŠ¸ í†µê³„</h4>
                    <div class="metric">
                        <span class="metric-label">ì´ ë¬¸ì ìˆ˜:</span>
                        <span class="metric-value">${rawData.statistics.totalCharacters.toLocaleString()}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ì²˜ë¦¬ëœ ì²­í¬:</span>
                        <span class="metric-value">${rawData.statistics.processedChunks}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ê´€ë ¨ ì²­í¬:</span>
                        <span class="metric-value">${rawData.statistics.relevantChunks}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">í‰ê·  ê´€ë ¨ë„:</span>
                        <span class="metric-value">${(rawData.statistics.averageRelevance * 100).toFixed(1)}%</span>
                    </div>
                </div>
                
                <div class="result-card">
                    <h4>ğŸ” ì²­í¬ ë¶„ì„</h4>
                    <div style="max-height: 300px; overflow-y: auto;">
                        ${rawData.chunks.slice(0, 5).map((chunk, index) => `
                            <div style="border-bottom: 1px solid #e2e8f0; padding: 10px 0;">
                                <strong>ì²­í¬ ${index + 1}</strong> (ê´€ë ¨ë„: ${(chunk.relevanceScore * 100).toFixed(1)}%)
                                <div style="font-size: 14px; color: #718096; margin-top: 5px;">
                                    ${chunk.text.substring(0, 200)}${chunk.text.length > 200 ? '...' : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // THREAD íŒ¨ë„ ì—…ë°ì´íŠ¸
        function updateThreadPanel(threadData) {
            const content = document.getElementById('threadContent');
            content.innerHTML = `
                <div class="result-card">
                    <h4>ğŸ§µ ì´ë²¤íŠ¸ ì¶”ì¶œ ê²°ê³¼</h4>
                    <div class="metric">
                        <span class="metric-label">ì´ ì´ë²¤íŠ¸:</span>
                        <span class="metric-value">${threadData.events.length}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ì¶”ì¶œ ì •í™•ë„:</span>
                        <span class="metric-value">${(threadData.qualityMetrics.extractionAccuracy * 100).toFixed(1)}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">í‰ê·  ì‹ ë¢°ë„:</span>
                        <span class="metric-value">${(threadData.qualityMetrics.eventConfidence * 100).toFixed(1)}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ì™„ì„±ë„:</span>
                        <span class="metric-value">${(threadData.qualityMetrics.completeness * 100).toFixed(1)}%</span>
                    </div>
                </div>
                
                <div class="result-card">
                    <h4>ğŸ“… ì´ë²¤íŠ¸ íƒ€ì„ë¼ì¸</h4>
                    <div style="max-height: 300px; overflow-y: auto;">
                        ${threadData.visualizations.eventTimeline.map(event => `
                            <div class="timeline-item">
                                <div class="timeline-date">${event.date}</div>
                                <div class="timeline-content">
                                    <strong>${event.type}</strong><br>
                                    ${event.description}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="result-card">
                    <h4>ğŸ“Š ì‹ ë¢°ë„ ë¶„í¬</h4>
                    <div style="display: flex; gap: 10px;">
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #48bb78;">${threadData.visualizations.confidenceDistribution.high}</div>
                            <div style="font-size: 12px; color: #718096;">ë†’ìŒ (80%+)</div>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #ed8936;">${threadData.visualizations.confidenceDistribution.medium}</div>
                            <div style="font-size: 12px; color: #718096;">ë³´í†µ (50-80%)</div>
                        </div>
                        <div style="flex: 1; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #f56565;">${threadData.visualizations.confidenceDistribution.low}</div>
                            <div style="font-size: 12px; color: #718096;">ë‚®ìŒ (<50%)</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // FINAL íŒ¨ë„ ì—…ë°ì´íŠ¸
        function updateFinalPanel(finalData) {
            const content = document.getElementById('finalContent');
            content.innerHTML = `
                <div class="result-card">
                    <h4>ğŸ“‹ ìµœì¢… ë¶„ì„ ìš”ì•½</h4>
                    ${finalData.report.executiveSummary ? `
                        <div style="white-space: pre-line; font-size: 14px; line-height: 1.6;">
                            ${finalData.report.executiveSummary}
                        </div>
                    ` : '<p>ìš”ì•½ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'}
                </div>
                
                <div class="result-card">
                    <h4>ğŸ’¡ ì£¼ìš” ë°œê²¬ì‚¬í•­</h4>
                    ${finalData.insights.keyFindings.length > 0 ? `
                        <ul>
                            ${finalData.insights.keyFindings.map(finding => `<li>${finding}</li>`).join('')}
                        </ul>
                    ` : '<p>ì£¼ìš” ë°œê²¬ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
                </div>
                
                <div class="result-card">
                    <h4>âš ï¸ ìœ„í—˜ ìš”ì†Œ</h4>
                    ${finalData.insights.riskFactors.length > 0 ? `
                        <ul>
                            ${finalData.insights.riskFactors.map(risk => `<li>${risk}</li>`).join('')}
                        </ul>
                    ` : '<p>ì‹ë³„ëœ ìœ„í—˜ ìš”ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>'}
                </div>
                
                <div class="result-card">
                    <h4>ğŸ“ ê¶Œì¥ì‚¬í•­</h4>
                    ${finalData.insights.recommendations.length > 0 ? `
                        <ul>
                            ${finalData.insights.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    ` : '<p>íŠ¹ë³„í•œ ê¶Œì¥ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
                </div>
            `;
        }

        // ì„±ëŠ¥ íŒ¨ë„ ì—…ë°ì´íŠ¸
        function updatePerformancePanel(performance, recommendations) {
            const content = document.getElementById('performanceContent');
            content.innerHTML = `
                <div class="result-card">
                    <h4>âš¡ ì„±ëŠ¥ ì§€í‘œ</h4>
                    <div class="metric">
                        <span class="metric-label">ì´ ì²˜ë¦¬ ì‹œê°„:</span>
                        <span class="metric-value">${(performance.totalTime / 1000).toFixed(2)}ì´ˆ</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ì´ ë¹„ìš©:</span>
                        <span class="metric-value">${performance.totalCost.toLocaleString()} í† í°</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">í’ˆì§ˆ ì ìˆ˜:</span>
                        <span class="metric-value">${(performance.qualityScore * 100).toFixed(1)}%</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">íš¨ìœ¨ì„± ì ìˆ˜:</span>
                        <span class="metric-value">${(performance.efficiency * 100).toFixed(1)}%</span>
                    </div>
                </div>
                
                <div class="result-card">
                    <h4>ğŸ¯ ìµœì í™” ì œì•ˆ</h4>
                    <p><strong>ë‹¤ìŒ ì²˜ë¦¬ ê¶Œì¥:</strong> ${recommendations.nextProcessing}</p>
                    
                    ${recommendations.optimizations.length > 0 ? `
                        <p><strong>ì„±ëŠ¥ ìµœì í™”:</strong></p>
                        <ul>
                            ${recommendations.optimizations.map(opt => `<li>${opt}</li>`).join('')}
                        </ul>
                    ` : ''}
                    
                    ${recommendations.costSavings.length > 0 ? `
                        <p><strong>ë¹„ìš© ì ˆì•½ ë°©ì•ˆ:</strong></p>
                        <ul>
                            ${recommendations.costSavings.map(saving => `<li>${saving}</li>`).join('')}
                        </ul>
                    ` : ''}
                </div>
                
                <div class="result-card">
                    <h4>ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ</h4>
                    <div class="metric">
                        <span class="metric-label">ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰:</span>
                        <span class="metric-value">${(process.memoryUsage?.().heapUsed / 1024 / 1024 || 0).toFixed(1)} MB</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">ê°€ë™ ì‹œê°„:</span>
                        <span class="metric-value">${Math.floor((process.uptime?.() || 0) / 60)} ë¶„</span>
                    </div>
                </div>
            `;
        }

        // ê²°ê³¼ ì´ˆê¸°í™”
        function clearResults() {
            document.getElementById('overviewContent').innerHTML = `
                <div class="alert alert-info">
                    ğŸ’¡ ì˜ë£Œë¬¸ì„œë¥¼ ì…ë ¥í•˜ê³  'ì§€ëŠ¥í˜• ë¶„ì„ ì‹œì‘' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
                    <br><br>
                    <strong>ì£¼ìš” ê¸°ëŠ¥:</strong>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>ğŸ§  AI ê¸°ë°˜ ì˜ë£Œì •ë³´ ì¶”ì¶œ</li>
                        <li>ğŸ“… ì‹œê°„ìˆœ ì´ë²¤íŠ¸ ë¶„ì„</li>
                        <li>âš ï¸ ìœ„í—˜ë„ í‰ê°€</li>
                        <li>ğŸ’° ë³´í—˜ ì‹¬ì‚¬ ìµœì í™”</li>
                        <li>ğŸ“Š ì‹¤ì‹œê°„ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</li>
                    </ul>
                </div>
            `;
            
            document.getElementById('rawContent').innerHTML = '<div class="loading">RAW ë°ì´í„° ëŒ€ê¸° ì¤‘</div>';
            document.getElementById('threadContent').innerHTML = '<div class="loading">THREAD ë¶„ì„ ëŒ€ê¸° ì¤‘</div>';
            document.getElementById('finalContent').innerHTML = '<div class="loading">FINAL ê²°ê³¼ ëŒ€ê¸° ì¤‘</div>';
            document.getElementById('performanceContent').innerHTML = '<div class="loading">ì„±ëŠ¥ ë°ì´í„° ëŒ€ê¸° ì¤‘</div>';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ§  Medical Intelligence Platform 2.0 ì´ˆê¸°í™” ì™„ë£Œ');
            
            // ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
            fetch('/api/intelligence/health')
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        console.log('âœ… ì‹œìŠ¤í…œ ìƒíƒœ ì •ìƒ:', result.health);
                        showAlert('ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤.', 'success');
                    } else {
                        console.warn('âš ï¸ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨');
                        showAlert('ì‹œìŠ¤í…œ ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    }
                })
                .catch(error => {
                    console.error('âŒ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:', error);
                    showAlert('ì‹œìŠ¤í…œ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.', 'error');
                });
        });
    </script>
</body>
</html>