# PDF OCR 백엔드 개발 지침

너는 지금부터 혼합형 PDF 문서에서 텍스트 페이지와 이미지 페이지를 자동으로 구분한 후, 이미지 페이지에 대해서만 AWS Textract OCR을 수행하고, 전체 결과를 병합하여 반환하는 Node.js 기반의 Express 백엔드 서버를 개발한다.

아래 사항은 **절대 누락하지 마라.**

==============================
[📌 프로젝트 기본 조건]
- Node.js + Express 기반
- 모든 파일은 메모리 기반으로 처리하고, 서버에 저장하지 않는다. (multer.memoryStorage)
- 사용자는 동시에 최대 8개 PDF를 업로드할 수 있으며, `/api/ocr/upload` 라우트를 통해 업로드된다.
- 각 PDF는 페이지 단위로 분석된다. 텍스트 페이지는 직접 텍스트 추출, 텍스트가 없는 페이지는 PNG로 변환 후 AWS Textract 비동기 OCR 요청.
- OCR 결과와 텍스트 추출 결과는 페이지 순서대로 병합하여 클라이언트에 JSON 형태로 반환한다.
- 처리 후에는 모든 임시 파일(temp 디렉토리 또는 메모리)은 삭제해야 한다.
==============================

==============================
[✅ 필수 구현 항목]
1. `app.js`에는 반드시 `express`, `dotenv`, `body-parser`, `multer`, `cors`, `routes` 등록을 포함하라.
2. `routes/ocrRoutes.js`에서 `/api/ocr/upload` 라우트를 등록하고 `ocrController.js`의 메서드와 연결한다.
3. `controllers/ocrController.js`는:
   - 다중 파일을 수신하고,
   - 각 PDF를 페이지별로 분석하고,
   - 이미지 페이지를 PNG로 변환 후 AWS Textract에 비동기 요청하고,
   - 결과를 기다린 뒤 모든 텍스트를 페이지 순서대로 병합하여 반환한다.
4. `services/textractService.js`는 Textract의 `StartDocumentTextDetection`과 `GetDocumentTextDetection` API를 비동기 방식으로 정확히 처리한다.
5. `services/pdfAnalyzer.js`는 페이지별 텍스트 여부를 분석하는 로직을 반드시 포함하고, 텍스트가 거의 없는 페이지만 이미지로 처리하도록 구현한다.
6. `utils/fileHandler.js`에서 임시 이미지 및 텍스트 데이터를 정리한다.
7. 응답은 반드시 JSON 객체 형태이며, 페이지별 결과 또는 전체 통합 텍스트를 포함한다.
8. 모든 코드에는 `try/catch` 구문과 상세 에러 메시지를 포함하라.
9. 누락된 의존성은 절대 없어야 하며, `package.json`은 정확하게 반영하라.
==============================

==============================
[🚫 꼭 금지할 것]
- "기존 포트 대신 다른 포트를 사용하시겠습니까?" 라고 묻지 마라.
- 포트는 반드시 `localhost:3000`으로 고정하고, 만약 기존 포트가 사용 중이면 기존 서버를 종료하고 새 인스턴스를 실행하는 것으로 간주하라.
- 경로 누락, 미등록 라우터, controller 연결 빠뜨리지 마라.
- 어떤 파일도 누락하지 말고, 모든 디렉토리 구조는 연결되도록 설계하라.
- 중간에 기존 명세(PRD)에서 벗어나는 기능을 임의로 추가하지 마라.
==============================

🧩 추가로, 코드 생성 전 반드시 전체 디렉토리 구조를 먼저 출력하고, 이어서 파일별로 하나씩 코드 블록으로 생성할 것.

너는 전문가급 백엔드 개발자이며, 이 프로젝트는 상용화까지 고려되어 있기 때문에 절대로 예시 수준의 코드가 아닌 실제 운영 가능한 수준으로 생성해야 한다. 