## 범위·원칙
- 대상: 날짜 바인딩·이벤트 패킹·10항목 보고서·가중치/연관성·RAG
- 비대상: 파일업로드·OCR 호출·텍스트추출·UI(변경 금지)
- 출력 형식 동등 보장: JSON/Markdown/HTML
- 판단 금지, 근거·확인요망 중심, 좌표 활용 우선 + 텍스트 Fallback

## 단계 1: 파이프라인 통합(비파괴)
- 어댑터 구성: 기존 후처리 결과 → DateBindingV3 입력(BBox·텍스트블록)
- 이벤트 패킹 결과 → 기존 nineItemReportGenerator와 호환 계층(10항목 변환 레이어)
- reportController에서는 새로운 10항목 생성기를 옵션 기반 병행(기본 유지, 신규 옵션 opt-in)
- 기능 플래그: dateBindingV3, tenItemReport, scoring, relations, ragLookup

## 단계 2: 정확도·안정성 검증
- 표준 테스트셋(≥30 문서) 구축: 입원/수술/조직검사/영상검사 핵심 이벤트 포함
- 측정 스크립트: 날짜 정규화 성공률, 바인딩 정확도(목표 95%+), 10항목 누락률(‘미기재’), 형식 일관성(JSON/MD/HTML)
- 골든 출력 저장 및 diff 자동 리포트 연결(scripts/report-diff.ts)
- 실패 케이스 라벨링(확인요망 자동 표기 규칙 점검)

## 단계 3: 가중치·연관성 운영화
- weights 외부화(shared/constants) 및 환경별 오버라이드
- score 계산(sigmoid·소수점 3자리) → Full Report optional meta에만 노출
- relEdges 산출: 동일 진단군/기관/검사 연쇄/시간 근접
- 모니터링: 점수 분포·엣지 밀도·처리시간 수집(핫 경로 튜닝)

## 단계 4: RAG 지속 확장
- 저장 구조(SQL + 벡터 인덱스 분리, 현재 파일 캐시 병행)
- 조회 우선순위: 로컬 → 웹 1회 → 적재(출처·날짜·신뢰도)
- 실패 재시도·로깅·검증(영문/한글 병기 충족 여부)

## 단계 5: 고급 옵션(선택 도입)
- 레이아웃 인지 NER(경량 LayoutLMv3/DocFormer)로 좌표-역할 태깅 강화
- 그래프 기반 연결(GNN·휴리스틱 혼합)로 연쇄 이벤트 정밀화
- Constrained decoding로 스키마 위배 방지(슬롯 채움)
- Confidence budget로 ‘확인요망’ 트리거 정교화

## 단계 6: 운영·문서·CI
- 테스트(유닛/통합/계약/E2E) 보강, 커버리지 80%+
- CI 게이트: typecheck/eslint/vitest/playwright/secretlint
- 문서 업데이트: SPEC/ARCHITECTURE/PR_CHECKLIST, “Vision only” 명시
- 실험 코드 /_archive 이동, Textract/Tesseract 분기 제거(현 파이프라인 영향 無)

## 산출물·지표
- 어댑터/서비스/생성기/상수/테스트/스크립트 일체
- KPI: 날짜 정규화 99%+, 바인딩 95%+, 10항목 출력 안정성, 처리시간·비용 메트릭

## 롤아웃
- 단계적 활성화(기능 플래그), 샘플 케이스 → 표준셋 → 전체
- 회귀 없을 때 기본 경로로 승격

## 위험·대응
- 좌표 품질 편차: 텍스트 Fallback·확률적 앵커 분산
- 성능 이슈: 반경/클러스터링 파라미터 튜닝·캐시
- 데이터 표준화 미흡: RAG 누적·사전 확장