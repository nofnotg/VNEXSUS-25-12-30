## 목표
- offline_ocr JSON의 다양한 스키마(라인/블록/페이지/텍스트)까지 정밀 매핑해 이벤트 생성률 개선
- 페이지·좌표가 누락된 케이스에도 합리적 기본값을 부여해 바인딩 가능 상태로 변환
- 배치 재실행으로 품질·성능 지표를 집계 및 비교

## 범위·원칙
- 업로드·OCR·텍스트추출·UI 불변
- 후처리(Date Binding v3→패킹→스코어/연관성→10항목)만 변경
- JSON/Markdown/HTML 결과 스키마 동등 유지

## 스키마 감지·매핑 규칙
- 지원 키 자동감지: items[], blocks[], lines[], pages[], text
- 라인/블록 공통 매핑: text|content → 텍스트, BoundingBox{Left,Top,Width,Height} → bbox, Confidence → 0~1 클램프
- 페이지 결정:
  - ln.page|b.page 존재 시 사용
  - pages[] 배열 존재 시 각 페이지 블록을 pages[i].page로 매핑
  - page가 없으면 1을 기본값으로 부여
- 기본 bbox 생성:
  - bbox가 없으면 page 중심(0.5,0.5, 0.1x0.1)
  - pages 길이를 이용해 y를 간단히 분포(행 인덱스 기반)로 부여하는 선택적 옵션
- 날짜 정규화:
  - 임의 구분자 포함 숫자열(YYYY??MM??DD 등) → ISO로 변환
  - 미래 날짜(오늘+30일 초과) 제외
  - dates 비어있을 때 blocks 텍스트에서 후보 추출 후 해당 block의 bbox/페이지로 앵커 생성

## 에러/라벨링
- 인코딩: UTF-8 실패 시 cp949/euc-kr 재디코딩 시도 후 실패 라벨링
- 누락 필드: page/bbox 누락 시 기본값 적용, 적용 여부 메타 기록
- 변환 실패: 케이스별 원인(파싱 실패/필드 누락/인코딩 실패) 수집

## 측정·리포트 확장
- offline_ocr 변환 성공률(입력→BindInput 변환 성공 케이스 비율)
- 이벤트 수·평균 score·blocks/dates 수·샘플 후보 수·Top-5 이벤트 미리보기
- 실패 사유별 카운트(파싱/인코딩/필드 누락)

## 실행 절차
1) 로더 매핑 보강(스키마 감지·페이지/좌표 기본값·날짜 정규화 반영)
2) 샘플 5건 스모크 → 전체 배치 재실행
3) summary.json에 확장 지표 작성 및 이전 대비 비교
4) 필요 시 바인딩 반경·키워드 가중치 튜닝

## 위험·대응
- 스키마 다양성: 자동감지·폴백·라벨링으로 완화
- 인코딩 혼재: iconv-lite 폴백 지속, 실패 라벨링
- 좌표 품질 편차: 기본 bbox·간단 y 분포 옵션으로 보정

## 산출물
- 로더 개선 코드 + 배치 요약 확장
- 변환 실패 사유 리포트 및 개선 체크리스트

## 롤아웃
- offline_ocr 전용 매핑 적용 후 품질 지표 공유 → 안정화 시 컨트롤러 경로 승격 준비