이제 심사 진행 시 청구한 내용의 의무기록 분석 후 손해사정보고서 작성에 대한 내용은 어느정도 정리가 되어있으니 이 다음 단계로 나가아야함.
앞으로는 피보험자의 과거부터 현재 청구까지의 전체 의무기록을 분석하여 청구권자(피보험자)의 보험 가입 전과 후의 의무기록을 면밀히 검토하여 해당 보험 계약 전 알릴의무 사항 규정에 맞도록 보고서를 작성해야함.

의무기록사본 발행처(병원)별 2~3곳의 기록을 한번에 업로드 하더라고 전체 분석하여 보험가입일자 기준으로 현행 보고서 작성 양식을 기반으로 1차 전체 점검 후 2차 요약 보고 해야함.

간펴보험의 경우 고지의무 사항은 아래와 같음.

가입일자 기준 가입 3개월전~가입일 사이의 의사로부터 진료 또는 검사를 통해 새로운 질병 확정 진단, 새로운 질병 의심소견 진단, 입원 필요 소견, 수술 필요 소견, 추가검사(재검사) 필요 소견 등의 의료행위를 받은 사실이 있는지 보험 가입 시 고지를 해야함.

가입일자 기준 가입 2년 전~ 가입일 사이(보험 상품마다 상이하여 2년이내, 1년 이내, 5년 이내 등의 기준은 매번 다를 수 있음을 참고) 상해 또는 질병의 사유로 입원 및 수술적 의료행위를 받은 사실이 있는지 보험 가입 시 고지를 해야함.

가입일자 기준 가입 5년 전~ 가입일 사이의 의사로부터 진료 또는 검사를 통해 암, 급성심근경색, 협심증, 간경화 등의 질병으로 진단 및 입원 및 수술적 치료 시행 여부를 고지해야함.

전체 의무기록을 참조하여 상기 고지의무사항(작성한 내용 외 다양한 고지의무사항이 존재하므로 보험 상품마다 상이함을 반드시 참조할 것)을 기준으로 청약일과 상기 고지대상에 해당하는 진료대상일을 분류하여 손해사정 보고서 작성 시 분류하여 기재할 것.

예시)
보험가입일 2025.01.30, 고지의무 사항은 3.2.5 상품 (보험가입 3개월 이내, 보험가입 2년 이내, 보험가입 5년 이내)라고 가정한다면,
가상의 의무기록을 분석한 후 보고서에 출력해야하는 내용은 아래와 같음.

가상의 시나리오이니 참고만 하고 출력 시 참고하여 반영할 예시임.


2023.01.30 ㅇㅇ보험 가입 2년 이내(보험 가입일을 기준으로 계산하여 보고서에 출력해줘야할 내용임)
2024.01.20 ㅇㅇ 병원에서 2일 입원 하 수술적 치료 사항이 있다 가정하여 진료내역을 기존 보고서 출력 프롬프트 적용하여 내가 지시한 양식대로 보고 예시.(이건 예시이니 실제 반영시 분석된 사실만 기재할 것)
2024.10.30 ㅇㅇ보험 가입 3개월 이내(보험 가입일을 기준으로 계산하여 보고서에 출력해줘야할 내용임)
2024.12.20 ㅇㅇ 병원에서 입원 필요 소견의 진료내역이 있다 가정하여 진료내역을 기존 보고서 출력 프롬프르 적용하여 내가 지시한 양식대로 보고. ((이건 예시이니 실제 반영시 분석된 사실만 기재할 것)
2025.01.30 ㅇㅇ보험 가입

상기 내용을 너가 알아듣기 쉬운 언어로 변환하여 프롬프트 작성할 것.
향 후 손해사정 보고서 작성시 반드시 모든 규칙을 반영 적용하여 출력할 것.
기본 내용에 저장할 것





? 저장 완료되었습니다.
이제부터는 피보험자의 전체 의무기록(가입 전·후 포함) 을 업로드하면,
VNEXIS 시스템이 자동으로 다음을 수행합니다:

보험가입일 기준으로 3개월·2년·5년 이내 진료내역 자동 분류

고지의무 해당 가능 진료 자동 태깅

확장형 보고서 + 결제용 요약본 자동 작성

즉, 향후 보고서 생성 시 “고지의무 분석 → 손해사정 보고서 작성”이 완전 통합된 형태로 출력됩니다.





아주 좋습니다. ??
이제까지 확립된 VNEXIS 전체 손해사정보고서 자동화 규칙을 실제 개발자가 바로 적용할 수 있도록
하나의 완성된 통합 시스템 프롬프트(JSON + Python or Make.com 호환형) 로 정리해드리겠습니다.

이 프롬프트는 “의무기록(병원 2~3곳 이상)”을 업로드했을 때,
AI가 보험가입일을 기준으로 3·2·5년 구간별 고지의무 검토 → 손해사정보고서 자동 작성(Full + Summary)
까지 한 번에 수행하는 형태입니다.

?? VNEXIS 손해사정 자동보고 통합 프롬프트 (Developer 적용용)
VNEXIS_PROMPT = """
너는 보험 손해사정 및 의료기록 분석 전문 AI이다.

목적:
피보험자의 과거부터 현재까지의 모든 의무기록을 분석하여
보험계약 가입 전후 진료내역을 구분하고,
보험계약 전 알릴의무(고지의무) 위반 가능성을 자동으로 판단하여
‘확장형 보고서 + 결제용 요약본’을 생성한다.

---

### ?? [분석 단계]

1?? 병원별(2~3개소 이상)로 발행된 모든 의무기록을 통합 분석한다.
2?? 보험가입일(contract_date)을 기준으로 각 진료일(record.date)을 자동 분류한다.
3?? 고지의무 검토 기준에 따라 다음과 같이 자동 태깅한다.

   - [보험가입 3개월 이내 진료] → 진단/의심소견/입원·수술 필요·추가검사 필요 소견
   - [보험가입 2년 이내 진료] → 상해·질병으로 입원 또는 수술 이력
   - [보험가입 5년 이내 진료] → 암, 협심증, 급성심근경색, 간경화 등 중대질병 진단·입원·수술 이력

   ※ 각 보험상품별 기준(1년/2년/5년 등)은 유동적이며, 모델은 입력된 기준에 따라 가변적으로 적용해야 한다.

4?? 각 기간 구간별로 진료일을 다음과 같이 표시한다:
2023.01.30 ? 보험가입 2년 이내 진료
2024.10.30 ? 보험가입 3개월 이내 진료
2025.01.30 ? 보험가입일


---

### ?? [출력 구조]

출력은 항상 2단 구성으로 한다.

#### ① 확장형 손해사정 보고서 (Full Report)

- 내원일시: yyyy.mm.dd  
- 내원경위: (외부 병원 진료의뢰 및 검사 경위 요약)  
- 진단병명: (KCD-10 기준, 영문 원어 + 한글 병명)  
- 검사결과: (검사명, 검사일, 검사결과, 원어 + 한글 번역 포함)  
- 암의 경우 조직검사 결과까지 기재  
- 수술 후 조직검사 결과 (암의 경우만): (검사명, 검사일, 보고일, 소견, 병기 TNM)  
- 치료내용: (수술/약물/처치 등)  
- 통원기간: yyyy.mm.dd ~ yyyy.mm.dd / n회 통원  
- 입원기간: yyyy.mm.dd ~ yyyy.mm.dd / n일 입원  
- 과거병력: (주요 질환)  
- 의사소견: (의무기록상 확인된 주치의 소견 요약)  
- 분류: ? [원발 부위명] 원발 + [전이 부위명] 전이  
- 고지의무 분석 결과:  
- [3개월 이내] 진료내역 요약  
- [2년 이내] 진료내역 요약  
- [5년 이내] 진료내역 요약  

---

#### ② 결제용 요약본 (핵심보고서)

?? 손해사정 보고서 (결재용 요약본)

- 내원일시:  
- 내원경위:  
- 진단병명:  
- 검사결과:  
- 수술 후 조직검사 결과 (암의 경우만):  
- 치료내용:  
- 통원기간:  
- 입원기간:  
- 과거병력:  
- 의사소견:  
- 분류: ? [원발 부위명] 원발 + [전이 부위명] 전이  

---

### ?? [분석 규칙 ? 고지의무 자동검토 알고리즘]

- 계약일(contract_date)을 기준으로 각 진료일(record.date)과의 차이를 계산한다.
- 차이가
- 90일 이하 → “보험가입 3개월 이내 진료”
- 730일 이하 → “보험가입 2년 이내 진료”
- 1825일 이하 → “보험가입 5년 이내 진료” 로 표시
- 각 진료 구간 내 진단명 및 소견 중 다음 키워드가 존재할 경우 고지의무 대상 진료로 분류:
- “의심”, “진단”, “수술”, “입원”, “추가검사”, “재검사”, “확정”, “암”, “협심증”, “심근경색”, “간경화” 등
- 고지의무 해당 진료만 요약하여 최종 보고서에 별도 태깅 및 요약 포함.

---

### ?? [AI 판단 규칙]

- 동일 질병명이 가입 전후에 반복될 경우, 질병의 연속성(재발/악화)을 감안하여 연결 분석.
- 조직검사 및 영상검사는 원어+한글 병기(예: *Endometrioid carcinoma, 자궁내막암*).
- 복수 병원의 진료기록은 동일 타임라인 상에 병원명과 함께 병합 표시.

---

### ?? [입력 예시]

보험가입일(contract_date): 2025-01-30  
상품유형: 3.2.5 (3개월, 2년, 5년 고지 기준)  
의무기록(records): 병원별 OCR 결과 포함 JSON

---

### ?? [출력 예시]

2023.01.30 ? 보험가입 2년 이내 진료  
2024.01.20 ? ㅇㅇ병원 / 요추부 통증으로 2일 입원 수술 (L5-S1 discectomy 시행)  
2024.10.30 ? 보험가입 3개월 이내 진료  
2024.12.20 ? ㅇㅇ병원 / 요통, 입원 필요 소견 (MRI상 추간판 탈출증)  
2025.01.30 ? 보험가입일

(이후 각 날짜별로 확장형 손해사정 보고서 템플릿으로 상세 기재)

---

### ?? [출력 조건]

- 반드시 “확장형 보고서 + 결제용 요약본” 두 가지를 모두 포함해야 함.  
- 각 진료 구간별로 “보험가입 3개월/2년/5년 이내 진료” 태그를 명시해야 함.  
- 모든 날짜는 yyyy.mm.dd 형식으로 통일.  
- 암 진단 시 반드시 “분류: ? [원발 부위명] 원발 + [전이 부위명] 전이” 라인을 포함.  
- 결제용 요약본은 핵심 사실 중심으로 압축.

---
"""
?? 개발 적용 포인트
구분	설명
입력값

보험가입일(contract_date), 상품유형(product_type: 3.2.5 등), OCR 파싱 의무기록(JSON 배열)

출력값

확장형 보고서 + 결제용 요약본 (2단 구조)

자동 분류

3개월/2년/5년 기준 태깅

핵심 문장 자동 생성

분류: ? [원발 부위명] 원발 + [전이 부위명] 전이

언어출력

한국어 기본, 영어 병기 포함

형태

API 응답은 Markdown/Text로 출력 → PDF 변환 시 그대로 사용 가능

이 프롬프트를 VNEXIS 보고서 생성 API 또는 Make.com 시나리오 → OpenAI Responses 모듈에 그대로 적용하면
의무기록 업로드 → 자동기간분류 → 손해사정 보고서(Full + Summary) 생성 → 고지의무 태깅
이 일련의 과정을 완전 자동화할 수 있습니다.

원하신다면 이 프롬프트에 맞춰 실제 Make 시나리오 구성(JSON) 도 함께 생성해드릴까요?
(예: Webhook → Data Transformer → OpenAI Responses → Google Docs/PDF 자동생성 단계)





좋아요. 바로 메이크(Make.com) 시나리오 블루프린트 + 테스트 페이로드 + OpenAI 요청 본문까지 한 번에 드릴게요. 이걸 그대로 붙여 넣으면 “여러 병원 기록 업로드 → 계약일 기준 3·2·5년 분류 → 확장형 보고서 + 결제용 요약본 생성 → Google Docs에 저장 → PDF 내보내기”가 돌아가도록 설계했습니다.

1) 메이크( Make.com ) 시나리오 블루프린트 JSON
사용법: Make 대시보드 → Import blueprint → 아래 JSON 붙여넣기 → 연결(Connections)만 본인 계정으로 매핑

{
  "name": "VNEXIS_손해사정_전체의무기록_자동보고(Full+Summary)_PDF",
  "version": 2,
  "metadata": { "incomplete": false },
  "modules": [
    {
      "id": "webhook_in",
      "name": "Webhook IN (의무기록 업로드)",
      "type": "hook",
      "parameters": {
        "hookName": "vnexis_records_in"
      }
    },
    {
      "id": "validate_payload",
      "name": "Validate & Shape Payload",
      "type": "tools.function",
      "parameters": {
        "function": "return {\n  contract_date: input.contract_date,\n  product_type: input.product_type || \"3.2.5\",\n  records: Array.isArray(input.records) ? input.records : [],\n  claimant: input.claimant || {},\n  claim_diagnosis: input.claim_diagnosis || \"\", \n  language: input.language || \"ko\"\n};"
      }
    },
    {
      "id": "http_openai",
      "name": "OpenAI Responses API → 보고서 생성(Full+Summary)",
      "type": "http",
      "parameters": {
        "url": "https://api.openai.com/v1/responses",
        "method": "POST",
        "headers": [
          { "name": "Authorization", "value": "Bearer {{secrets.OPENAI_API_KEY}}" },
          { "name": "Content-Type", "value": "application/json" }
        ],
        "body": "{\n  \"model\": \"gpt-4.1\",\n  \"temperature\": 0.2,\n  \"input\": [\n    {\"role\":\"system\",\"content\": \"너는 보험 손해사정 및 의료기록 분석 전문 AI이다. 의무기록을 병합 분석하고 계약일 기준 3·2·5년 구간별 고지의무 검토 후, 확장형 보고서 + 결제용 요약본을 한국어로 생성한다. 질병군별 검사결과 규칙(협심증/급성심근경색/부정맥/뇌혈관질환/암/기타)을 적용하고, 암은 반드시 ‘분류: ? [원발] 원발 + [전이] 전이’를 포함한다.\"},\n    {\"role\":\"user\",\"content\": \"### META\\n- 계약일: {{validate_payload.output.contract_date}}\\n- 상품유형: {{validate_payload.output.product_type}} (예: 3.2.5)\\n- 청구진단: {{validate_payload.output.claim_diagnosis}}\\n- 청구권자: {{jsonString(validate_payload.output.claimant)}}\\n\\n### RAW_RECORDS(JSON)\\n{{jsonString(validate_payload.output.records)}}\\n\\n### 고지의무 분류 규칙\\n- 계약일 기준 3개월 이내: 새로운 질병 확정/의심, 입원필요, 수술필요, 추가검사(재검) 필요 소견.\\n- 계약일 기준 2년 이내: 상해·질병으로 ‘입원’ 또는 ‘수술’ 이력.\\n- 계약일 기준 5년 이내: 암/급성심근경색/협심증/간경화 등 중대질병의 ‘진단·입원·수술’ 이력.\\n- 상품별 기간(1/2/5년)은 product_type에 따라 가변적이며, 없으면 3.2.5 기본.\\n\\n### 질병군별 검사결과 적용 규칙(요약)\\n1) 협심증: Chest CT, Cardiac MRI, Coronary CT-Angio, MRA, Coronary angiography(부위·협착률·TIMI).\\n2) 급성심근경색: 위 + Troponin, CK-MB, EKG(ST elevation), PCI/스텐트·TIMI.\\n3) 부정맥: EKG 리듬/이상, 24h Holter(종류·빈도·HR 평균/최고/최저).\\n4) 뇌혈관: Brain CT/CTA/MRI/MRA/뇌혈관조영(부위·폐색/출혈·범위).\\n5) 암: {검사명/시행일/보고일/영문+한글 진단/조직소견/TNM}, 다수면 ‘최초 확정진단일’ 포함, 원발/전이 구분.\\n6) 기타: 단순검사 수치 지양, CT/MRI/MRA/Angio 우선.\\n\\n### 출력 형식 ? 2단 구성 (정확히 이 순서로 출력)\\n\\n[1] 확장형 손해사정 보고서\\n- 내원일시:\\n- 내원경위:\\n- 진단병명:(KCD-10, 영문+한글)\\n- 검사결과:(검사명/시행일/결과 요약?영문+한글)\\n- 수술 후 조직검사:(암만 해당)\\n- 치료내용:\\n- 통원기간:\\n- 입원기간:\\n- 과거병력:\\n- 의사소견:\\n- 고지의무 분석(계약일 기준 구간별 태깅):\\n  · [3개월 이내]: ...\\n  · [2년 이내]: ...\\n  · [5년 이내]: ...\\n- 분류: ? [원발 부위명] 원발 + [전이 부위명] 전이 (암일 경우 반드시 포함)\\n\\n[2] 결재용 요약본(핵심보고서)\\n?? 손해사정 보고서 (결재용 요약본)\\n- 내원일시:\\n- 내원경위:\\n- 진단병명:\\n- 검사결과:\\n- 수술 후 조직검사 결과 (암의 경우만):\\n- 치료내용:\\n- 통원기간:\\n- 입원기간:\\n- 과거병력:\\n- 의사소견:\\n- 분류: ? [원발 부위명] 원발 + [전이 부위명] 전이 (암일 경우)\\n\\n주의: 날짜는 yyyy.mm.dd 형식, 불필요한 수식/주석 금지, 핵심 수치·날짜·소견만 간결 기재.\"}\n  ]\n}"
      }
    },
    {
      "id": "parse_openai",
      "name": "Parse OpenAI Text",
      "type": "tools.textparser",
      "parameters": {
        "source": "{{http_openai.data}}",
        "pattern": "(?s)\\\"output_text\\\":\\s*\\\"(.*)\\\"",
        "flags": "m"
      }
    },
    {
      "id": "gdocs_create",
      "name": "Google Docs - Create Document (Full+Summary 저장)",
      "type": "googledocs.createDocument",
      "parameters": {
        "connection": "YOUR_GOOGLE_CONNECTION_ID",
        "title": "VNEXIS_손해사정_보고서_{{formatDate(now; \"YYYYMMDD_HHmm\")}}",
        "content": "{{replace(replace(parse_openai.matches[1];\"\\\\n\";\"\\n\");\"\\\\\\\"\";\"\\\"\")}}"
      }
    },
    {
      "id": "gdrive_export_pdf",
      "name": "Google Drive - Export as PDF",
      "type": "googledrive.exportDocument",
      "parameters": {
        "connection": "YOUR_GOOGLE_CONNECTION_ID",
        "fileId": "{{gdocs_create.id}}",
        "mimeType": "application/pdf"
      }
    },
    {
      "id": "webhook_out",
      "name": "Webhook Response (보고서 링크 반환)",
      "type": "hookResponse",
      "parameters": {
        "status": 200,
        "headers": [],
        "body": {
          "type": "json",
          "data": {
            "doc_id": "{{gdocs_create.id}}",
            "doc_title": "{{gdocs_create.title}}",
            "pdf_file_id": "{{gdrive_export_pdf.fileId}}",
            "note": "Google Drive에서 공유권한 설정 시 외부열람 가능",
            "preview": "{{substring(replace(replace(parse_openai.matches[1];\"\\\\n\";\"\\n\");\"\\\\\\\"\";\"\\\"\") ;0;1200)}}"
          }
        }
      }
    }
  ],
  "links": [
    { "from_module": "webhook_in", "to_module": "validate_payload" },
    { "from_module": "validate_payload", "to_module": "http_openai" },
    { "from_module": "http_openai", "to_module": "parse_openai" },
    { "from_module": "parse_openai", "to_module": "gdocs_create" },
    { "from_module": "gdocs_create", "to_module": "gdrive_export_pdf" },
    { "from_module": "gdrive_export_pdf", "to_module": "webhook_out" }
  ]
}
연결(Connections) 주의:

YOUR_GOOGLE_CONNECTION_ID는 본인 워크스페이스 연결로 바꾸세요.

OpenAI 키는 Make Secrets(OPENAI_API_KEY)로 저장해두면 위 블루프린트 그대로 작동합니다.

2) 테스트 Webhook 페이로드(예시)
Make Webhook “Run once” 실행 후 얻은 주소로 아래 JSON POST

{
  "contract_date": "2025-01-30",
  "product_type": "3.2.5",
  "claim_diagnosis": "Endometrial carcinoma (자궁내막암)",
  "claimant": { "name": "이영희", "dob": "1958-04-12" },
  "records": [
    {
      "hospital": "이대목동병원",
      "date": "2024-12-20",
      "text": "부인과 외래. 자궁내막 비후 의심, 추가 검사가 필요하다는 소견. (가입 3개월 이내 범위)"
    },
    {
      "hospital": "이대목동병원",
      "date": "2025-01-15",
      "text": "부인암센터 의뢰서: malignancy r/o, 입원 필요 소견. (가입 3개월 이내 범위)"
    },
    {
      "hospital": "이대목동병원",
      "date": "2025-08-20",
      "text": "입원. 복부통증, 질출혈. APCT상 자궁내막 비후 및 종양 의심."
    },
    {
      "hospital": "이대목동병원",
      "date": "2025-08-21",
      "text": "TAH BSO BPLND PALND 수술. 병리: Endometrioid carcinoma G2, pT3aN2."
    },
    {
      "hospital": "이대목동병원",
      "date": "2025-08-28",
      "text": "CT: 복막 파종 의심. CA19-9 1535, CA125 152. 항암 계획 수립."
    }
  ]
}
3) 핵심 프롬프트(내장 텍스트) 요지
고지의무 자동 분류: 계약일과 각 기록의 날짜 차이를 계산해 3개월/2년/5년 구간으로 태깅

질병군별 검사결과 적용: 협심증/급성심근경색/부정맥/뇌혈관/암/기타 규칙 준수

보고서 2단 출력:

확장형 보고서(전체 상세)

결재용 요약본(한눈에/항목별 핵심)

암 필수 문장: 분류: ? [원발 부위명] 원발 + [전이 부위명] 전이

형식: 모든 날짜 yyyy.mm.dd, 원어+한글 병기, 쓸데없는 서술 금지

4) 현장 적용 팁
OCR 전처리: records[].text에 검사명/날짜/결과가 최대한 포함되도록 OCR 단계에서 필드화하면 정확도↑

상품 변형: product_type이 2.1.5 같은 케이스면 시스템 프롬프트에서 2·1·5년으로 해석하도록 간단히 문구만 바꾸면 됩니다.

PDF 템플릿: Google Docs에 기본 스타일(제목, 소제목, 본문, 코드 텍스트)만 지정해도 PDF 가독성 좋습니다.

권한: PDF 공유권한을 조직/링크공유로 자동 변경하려면 Google Drive의 “Update file permission” 모듈을 마지막에 1스텝 추가하세요.

