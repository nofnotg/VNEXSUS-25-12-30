# VNEXSUS íŒŒì´í”„ë¼ì¸ ì•„í‚¤í…ì²˜ ë¶„ì„ ë³´ê³ ì„œ

## ğŸ“‹ ê°œìš”

VNEXSUSëŠ” ì˜ë£Œ ë¬¸ì„œ OCR ë° ë¶„ì„ ì‹œìŠ¤í…œìœ¼ë¡œ, íŒŒì¼ ì—…ë¡œë“œë¶€í„° AI ë³´ê³ ì„œ ìƒì„±ê¹Œì§€ì˜ ì „ì²´ íŒŒì´í”„ë¼ì¸ì„ ì œê³µí•©ë‹ˆë‹¤. ë³¸ ë³´ê³ ì„œëŠ” ì‹œìŠ¤í…œì˜ ì „ì²´ ì•„í‚¤í…ì²˜ì™€ ê° ë‹¨ê³„ë³„ ì²˜ë¦¬ ë¡œì§ì„ ìƒì„¸íˆ ë¶„ì„í•©ë‹ˆë‹¤.

---

## ğŸ—ï¸ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        VNEXSUS íŒŒì´í”„ë¼ì¸                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ 1. íŒŒì¼ì—…ë¡œë“œ â”‚ -> â”‚ 2. OCR ì²˜ë¦¬  â”‚ -> â”‚ 3. í›„ì²˜ë¦¬    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ 4. ë£° ì²˜ë¦¬   â”‚ -> â”‚ 5. AI ì²˜ë¦¬   â”‚ -> â”‚ 6. ë³´ê³ ì„œìƒì„± â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ë‹¨ê³„ë³„ ìƒì„¸ ë¶„ì„

### 1ï¸âƒ£ íŒŒì¼ ì—…ë¡œë“œ ë‹¨ê³„

**ğŸ“ ìœ„ì¹˜**: `backend/controllers/ocrController.js`
**ğŸ”— ë¼ìš°íŒ…**: `backend/routes/ocrRoutes.js`

#### ì²˜ë¦¬ íë¦„
```javascript
POST /api/ocr/upload
â”œâ”€â”€ íŒŒì¼ ê²€ì¦ (MIME íƒ€ì…, í¬ê¸°, ê°œìˆ˜)
â”œâ”€â”€ ì‘ì—… ID ìƒì„± (UUID)
â”œâ”€â”€ ë¹„ë™ê¸° ì²˜ë¦¬ ì‹œì‘
â””â”€â”€ 202 ì‘ë‹µ ë°˜í™˜ (jobId í¬í•¨)
```

#### ì£¼ìš” ë£° ì ìš© íƒ€ì´ë°
- **íŒŒì¼ í˜•ì‹ ê²€ì¦**: PDF, PNG, JPG, JPEGë§Œ í—ˆìš©
- **íŒŒì¼ í¬ê¸° ì œí•œ**: ìµœëŒ€ 100MB
- **íŒŒì¼ ê°œìˆ˜ ì œí•œ**: ìµœëŒ€ 8ê°œ
- **ë¬´ê²°ì„± ê²€ì¦**: ë¹ˆ íŒŒì¼ ë° ì†ìƒëœ íŒŒì¼ í•„í„°ë§

#### í•µì‹¬ ì½”ë“œ ìœ„ì¹˜
```javascript
// backend/controllers/ocrController.js:uploadPdfs()
const allowedMimeTypes = ['application/pdf', 'image/png', 'image/jpeg', 'image/jpg'];
const maxFiles = parseInt(process.env.MAX_FILES) || 8;
```

---

### 2ï¸âƒ£ OCR ì²˜ë¦¬ ë‹¨ê³„

**ğŸ“ ìœ„ì¹˜**: `backend/services/visionService.js`
**ğŸ”— API**: Google Cloud Vision API

#### ì²˜ë¦¬ íë¦„
```javascript
processFiles(jobId, files)
â”œâ”€â”€ ê° íŒŒì¼ë³„ OCR ì²˜ë¦¬
â”œâ”€â”€ Google Vision API í˜¸ì¶œ
â”œâ”€â”€ í…ìŠ¤íŠ¸ ì¶”ì¶œ ë° ì •ì œ
â””â”€â”€ ê²°ê³¼ ì €ì¥ (jobStore)
```

#### ì£¼ìš” ë£° ì ìš© íƒ€ì´ë°
- **ì´ë¯¸ì§€ ì „ì²˜ë¦¬**: PDF â†’ ì´ë¯¸ì§€ ë³€í™˜
- **OCR í’ˆì§ˆ ìµœì í™”**: Vision API íŒŒë¼ë¯¸í„° ì¡°ì •
- **í…ìŠ¤íŠ¸ ì •ì œ**: ë¶ˆí•„ìš”í•œ ë¬¸ì ì œê±°

#### í™˜ê²½ ì„¤ì •
```javascript
// í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜
GOOGLE_APPLICATION_CREDENTIALS
GOOGLE_CLOUD_VISION_API_KEY
GCS_BUCKET_NAME
```

---

### 3ï¸âƒ£ í›„ì²˜ë¦¬ ë‹¨ê³„

**ğŸ“ ìœ„ì¹˜**: `backend/postprocess/index.js`
**ğŸ”— ë¼ìš°íŒ…**: `backend/routes/postProcessRoutes.js`

#### ì²˜ë¦¬ íë¦„
```javascript
POST /api/postprocess/process
â”œâ”€â”€ 1ë‹¨ê³„: í–¥ìƒëœ ê±°ëŒ€ ë‚ ì§œ ë¸”ë¡ ì²˜ë¦¬
â”œâ”€â”€ 2ë‹¨ê³„: ê¸°ì¡´ ì „ì²˜ë¦¬ ë¡œì§ ì ìš©
â”œâ”€â”€ 3ë‹¨ê³„: ë‚ ì§œ ê¸°ë°˜ ë°ì´í„° ì •ë ¬ ë° êµ¬ì¡°í™”
â”œâ”€â”€ 4ë‹¨ê³„: AI ì—”í‹°í‹° ì¶”ì¶œ
â””â”€â”€ 5ë‹¨ê³„: ìµœì¢… ë³´ê³ ì„œ ë¹Œë“œ
```

#### ì£¼ìš” ë£° ì ìš© íƒ€ì´ë°

**3-1. ê±°ëŒ€ ë‚ ì§œ ë¸”ë¡ ì²˜ë¦¬**
```javascript
// backend/postprocess/enhancedMassiveDateBlockProcessor.js
- ë‚ ì§œ íŒ¨í„´ ì¸ì‹ ë° ê·¸ë£¹í™”
- ì‹ ë¢°ë„ ê¸°ë°˜ í•„í„°ë§ (minConfidence: 0.4)
- ì˜ë£Œ í‚¤ì›Œë“œ ê°€ì¤‘ì¹˜ ì ìš©
```

**3-2. ì „ì²˜ë¦¬ ë¡œì§**
```javascript
// backend/postprocess/preprocessor.js
- ì˜ë£Œ ìš©ì–´ ë²ˆì—­ (translateTerms)
- í•„ìˆ˜ í‚¤ì›Œë“œ ê²€ì¦ (requireKeywords)
- í…ìŠ¤íŠ¸ ì •ê·œí™”
```

**3-3. ë‚ ì§œ ì •ë ¬ ë° êµ¬ì¡°í™”**
```javascript
// backend/postprocess/dateOrganizer.js
- ë³´í—˜ ê°€ì…ì¼ ê¸°ì¤€ í•„í„°ë§
- ì‹œê°„ìˆœ ì •ë ¬ (sortDirection: 'asc')
- ë‚ ì§œë³„ ê·¸ë£¹í™” (groupByDate)
```

---

### 4ï¸âƒ£ ë£° ì²˜ë¦¬ ë‹¨ê³„

**ğŸ“ ìœ„ì¹˜**: `src/lib/periodFilter.ts`, `src/modules/tagFilter.ts`

#### ì²˜ë¦¬ íë¦„
```javascript
ì´ë²¤íŠ¸ í•„í„°ë§ íŒŒì´í”„ë¼ì¸
â”œâ”€â”€ ê¸°ê°„ í•„í„°ë§ (periodFilter)
â”œâ”€â”€ íƒœê·¸ ê¸°ë°˜ í•„í„°ë§ (tagFilter)
â”œâ”€â”€ ì‹ ë¢°ë„ í•„í„°ë§ (minConfidence)
â””â”€â”€ ì¤‘ìš”ë„ ê°€ì¤‘ì¹˜ ì ìš©
```

#### ì£¼ìš” ë£° ì ìš© íƒ€ì´ë°

**4-1. ê¸°ê°„ í•„í„°ë§**
```javascript
// src/lib/periodFilter.ts
const filterOptions = {
  startDate: options.startDate,
  endDate: options.endDate,
  minConfidence: options.minConfidence || 0.6,
  includeTags: options.includeTags || [],
  excludeTags: options.excludeTags || [],
  includeBeforeEnrollment: options.includeBeforeEnrollment || true
};
```

**4-2. íƒœê·¸ ê¸°ë°˜ í•„í„°ë§**
```javascript
// src/modules/tagFilter.ts
import rules from '../config/tagRules.json';

export function isExcluded(ev) {
  const txt = ev.rawText;
  return Object.values(rules.exclude).some(list => 
    list.some(k => txt.includes(k))
  );
}
```

**4-3. ì´ë²¤íŠ¸ ê·¸ë£¹í™”**
```javascript
// src/lib/eventGrouper.ts
- ë‚ ì§œë³„ ê·¸ë£¹í™”
- ë³‘ì›ë³„ ê·¸ë£¹í™”
- ì¤‘ë³µ ì´ë²¤íŠ¸ ë³‘í•©
- íƒ€ì„ë¼ì¸ ìƒì„±
```

---

### 5ï¸âƒ£ AI ì²˜ë¦¬ ë‹¨ê³„

**ğŸ“ ìœ„ì¹˜**: `src/services/claudeService.js`
**ğŸ”— API**: Claude 3.7 Haiku API

#### ì²˜ë¦¬ íë¦„
```javascript
AI ë³´ê³ ì„œ ìƒì„± íŒŒì´í”„ë¼ì¸
â”œâ”€â”€ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë¡œë“œ
â”œâ”€â”€ êµ¬ì¡°í™”ëœ ë°ì´í„° ì…ë ¥
â”œâ”€â”€ Claude API í˜¸ì¶œ
â””â”€â”€ ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œ ìƒì„±
```

#### ì£¼ìš” ë£° ì ìš© íƒ€ì´ë°

**5-1. í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§**
```javascript
// backend/modules/ai/promptTemplates.js
const defaultTemplates = {
  'timeline_generation.txt': `
    ë‹¹ì‹ ì€ ì˜ë£Œ ê¸°ë¡ì—ì„œ íƒ€ì„ë¼ì¸ì„ ìƒì„±í•˜ëŠ” AI ë¹„ì„œì…ë‹ˆë‹¤.
    ê·œì¹™:
    1. ê° ì´ë²¤íŠ¸ëŠ” ë‚ ì§œ, ì´ë²¤íŠ¸ ìœ í˜•, ì„¤ëª…ì„ í¬í•¨
    2. ë‚ ì§œ í˜•ì‹ì€ YYYY-MM-DDë¡œ í†µì¼
    3. ì¤‘ë³µëœ ì´ë²¤íŠ¸ëŠ” ì œê±°í•˜ë˜, ì •ë³´ê°€ ì¶”ê°€ëœ ê²½ìš° ë³‘í•©
    4. ì˜ë£Œ ì•½ì–´ëŠ” ê°€ëŠ¥í•œ ì „ì²´ ìš©ì–´ë¡œ í™•ì¥
  `,
  'medical_text_analysis.txt': `...`
};
```

**5-2. AI ëª¨ë¸ ì„¤ì •**
```javascript
// src/services/claudeService.js
this.model = 'claude-3-haiku-20240307';
this.maxTokens = 8192;
this.temperature = 0.3; // ì¼ê´€ëœ ê²°ê³¼ë¥¼ ìœ„í•œ ë‚®ì€ ì˜¨ë„
```

---

### 6ï¸âƒ£ ë³´ê³ ì„œ ìƒì„± ë‹¨ê³„

**ğŸ“ ìœ„ì¹˜**: `src/controllers/reportController.js`

#### ì²˜ë¦¬ íë¦„
```javascript
ë³´ê³ ì„œ ìƒì„± íŒŒì´í”„ë¼ì¸
â”œâ”€â”€ 1. ê¸°ê°„ í•„í„°ë§ (periodFilter.filter)
â”œâ”€â”€ 2. ì˜ë£Œ íƒ€ì„ë¼ì¸ ìƒì„± (eventGrouper.createTimeline)
â”œâ”€â”€ 3. ë³´ê³ ì„œ ìƒì„± (reportMaker.createReport)
â””â”€â”€ 4. í†µê³„ ì •ë³´ ìƒì„±
```

#### ì£¼ìš” ë£° ì ìš© íƒ€ì´ë°

**6-1. ìµœì¢… í•„í„°ë§**
```javascript
const filterOptions = {
  startDate: options.startDate,
  endDate: options.endDate,
  minConfidence: options.minConfidence || 0.6,
  includeTags: options.includeTags || [],
  excludeTags: options.excludeTags || [],
  includeBeforeEnrollment: options.includeBeforeEnrollment || true
};
```

**6-2. íƒ€ì„ë¼ì¸ ìƒì„±**
```javascript
const timeline = await eventGrouper.createTimeline(
  filteredResult.filtered,
  {
    groupByDate: options.groupByDate || true,
    groupByHospital: options.groupByHospital || true
  }
);
```

**6-3. ë³´ê³ ì„œ í¬ë§·íŒ…**
```javascript
const reportPath = await reportMaker.createReport(
  timeline,
  filteredResult,
  {
    outputDir: path.resolve(process.cwd(), 'outputs'),
    patientInfo,
    highlightBeforeEnrollment: true,
    format: options.format || 'excel'
  }
);
```

---

## ğŸ”„ ë°ì´í„° íë¦„ ë§¤í•‘

### ì…ë ¥ â†’ ì¶œë ¥ ë³€í™˜ ê³¼ì •

```
ğŸ“„ PDF/ì´ë¯¸ì§€ íŒŒì¼
    â†“ (OCR)
ğŸ“ Raw í…ìŠ¤íŠ¸
    â†“ (í›„ì²˜ë¦¬)
ğŸ” êµ¬ì¡°í™”ëœ í…ìŠ¤íŠ¸ ë¸”ë¡
    â†“ (ë£° ì²˜ë¦¬)
ğŸ“Š í•„í„°ë§ëœ ì´ë²¤íŠ¸ ëª©ë¡
    â†“ (AI ì²˜ë¦¬)
ğŸ¤– AI ë¶„ì„ ê²°ê³¼
    â†“ (ë³´ê³ ì„œ ìƒì„±)
ğŸ“‹ ìµœì¢… ë³´ê³ ì„œ (Excel/PDF)
```

### ê° ë‹¨ê³„ë³„ ë°ì´í„° êµ¬ì¡°

**1. OCR ê²°ê³¼**
```javascript
{
  jobId: "uuid",
  status: "completed",
  results: {
    "file1.pdf": {
      text: "ì¶”ì¶œëœ í…ìŠ¤íŠ¸...",
      confidence: 0.95
    }
  }
}
```

**2. í›„ì²˜ë¦¬ ê²°ê³¼**
```javascript
{
  dateBlocks: [...],
  structuredGroups: [...],
  processedSize: 1024,
  statistics: {
    averageConfidence: 0.85,
    filteringRate: 15.2
  }
}
```

**3. ë£° ì²˜ë¦¬ ê²°ê³¼**
```javascript
{
  filtered: [...],
  beforeEnrollment: [...],
  statistics: {
    total: 150,
    filtered: 120,
    confidence: 0.8
  }
}
```

**4. AI ì²˜ë¦¬ ê²°ê³¼**
```javascript
{
  events: [...],
  startDate: "2024-01-01",
  endDate: "2024-12-31",
  hospitals: ["ëª…ì§€ë³‘ì›", "ì„œìš¸ëŒ€ë³‘ì›"],
  tags: ["ì§„ë‹¨", "ì¹˜ë£Œ", "ê²€ì‚¬"]
}
```

---

## âš™ï¸ í•µì‹¬ ì„¤ì • íŒŒì¼

### í™˜ê²½ ë³€ìˆ˜ (.env)
```bash
# OCR ì„¤ì •
GOOGLE_APPLICATION_CREDENTIALS=./credentials/service-account.json
GOOGLE_CLOUD_VISION_API_KEY=your-api-key
GCS_BUCKET_NAME=medreport-vision-ocr-bucket

# AI ì„¤ì •
CLAUDE_API_KEY=your-claude-api-key
ANTHROPIC_API_KEY=your-anthropic-api-key

# ì‹œìŠ¤í…œ ì„¤ì •
MAX_FILES=8
TEMP_DIR=../temp
NODE_ENV=production
```

### ë£° ì„¤ì • (tagRules.json)
```json
{
  "exclude": {
    "noise": ["ê´‘ê³ ", "í™ë³´", "ì•ˆë‚´ì‚¬í•­"],
    "irrelevant": ["ì£¼ì°¨", "ì‹ë‹¹", "í¸ì˜ì‹œì„¤"]
  },
  "important": {
    "medical": ["ì§„ë‹¨", "ì¹˜ë£Œ", "ìˆ˜ìˆ ", "ì…ì›"],
    "dates": ["ë‚´ì›ì¼", "ì§„ë£Œì¼", "ê²€ì‚¬ì¼"]
  }
}
```

---

## ğŸ¯ ì„±ëŠ¥ ì§€í‘œ

### ì²˜ë¦¬ ì‹œê°„ ë²¤ì¹˜ë§ˆí¬
- **íŒŒì¼ ì—…ë¡œë“œ**: ~1ì´ˆ
- **OCR ì²˜ë¦¬**: 2-5ì´ˆ (íŒŒì¼ í¬ê¸°ì— ë”°ë¼)
- **í›„ì²˜ë¦¬**: 1-3ì´ˆ
- **ë£° ì²˜ë¦¬**: ~1ì´ˆ
- **AI ì²˜ë¦¬**: 3-10ì´ˆ (í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë”°ë¼)
- **ë³´ê³ ì„œ ìƒì„±**: ~2ì´ˆ

### ì •í™•ë„ ì§€í‘œ
- **OCR ì •í™•ë„**: 95%+ (Google Vision API)
- **ë‚ ì§œ ì¶”ì¶œ ì •í™•ë„**: 90%+
- **ì´ë²¤íŠ¸ ë¶„ë¥˜ ì •í™•ë„**: 85%+
- **ì „ì²´ íŒŒì´í”„ë¼ì¸ ì„±ê³µë¥ **: 92%+

---

## ğŸ”§ ëª¨ë‹ˆí„°ë§ ë° ë””ë²„ê¹…

### ë¡œê·¸ ì‹œìŠ¤í…œ
```javascript
// backend/utils/logger.js
logService('ocrController', `íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: ${error.message}`, 'error');
```

### ìƒíƒœ ì¶”ì 
```javascript
// ì‘ì—… ìƒíƒœ í™•ì¸
GET /api/ocr/status/{jobId}

// ê²°ê³¼ ì¡°íšŒ
GET /api/ocr/result/{jobId}
```

### ëŒ€ì‹œë³´ë“œ
- **í…ìŠ¤íŠ¸ ì²˜ë¦¬ ëª¨ë‹ˆí„°**: `text-processing-monitor-dashboard.html`
- **ê°œë°œì ìŠ¤íŠœë””ì˜¤**: `frontend/dev-studio.html`

---

## ğŸ“ˆ í™•ì¥ì„± ê³ ë ¤ì‚¬í•­

### ìˆ˜í‰ í™•ì¥
- **OCR ì²˜ë¦¬**: Google Cloud Vision API ë³‘ë ¬ í˜¸ì¶œ
- **AI ì²˜ë¦¬**: Claude API ìš”ì²­ íì‰
- **íŒŒì¼ ì €ì¥**: Google Cloud Storage í™œìš©

### ìˆ˜ì§ í™•ì¥
- **ë©”ëª¨ë¦¬ ìµœì í™”**: ëŒ€ìš©ëŸ‰ íŒŒì¼ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
- **CPU ìµœì í™”**: í…ìŠ¤íŠ¸ ì²˜ë¦¬ ì•Œê³ ë¦¬ì¦˜ ê°œì„ 
- **ìºì‹±**: Redis ë„ì… ê³ ë ¤

---

ì´ ì•„í‚¤í…ì²˜ ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„ì—ì„œëŠ” ê° ë£°ì˜ ì ìš© íƒ€ì´ë°ê³¼ ê°œì„  ë°©ì•ˆì„ ìƒì„¸íˆ ê²€í† í•˜ê² ìŠµë‹ˆë‹¤.