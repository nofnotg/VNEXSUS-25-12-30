<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒŒì¼ ì—…ë¡œë“œ ìë™í™” í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .button:hover { background: #0056b3; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>íŒŒì¼ ì—…ë¡œë“œ ìë™í™” í…ŒìŠ¤íŠ¸</h1>
    
    <div class="status info">
        <strong>í…ŒìŠ¤íŠ¸ ëª©ì :</strong> í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ì˜ íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ì„ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ê³  ë””ë²„ê·¸ ë¡œê·¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
    </div>
    
    <button class="button" onclick="testFileUpload()">íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
    <button class="button" onclick="clearLogs()">ë¡œê·¸ ì§€ìš°ê¸°</button>
    
    <div id="logs"></div>
    
    <script>
        let logContainer = document.getElementById('logs');
        
        function log(message, type = 'info') {
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            logContainer.appendChild(logDiv);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function clearLogs() {
            logContainer.innerHTML = '';
        }
        
        async function testFileUpload() {
            log('ğŸš€ íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');
            
            try {
                // í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ë¥¼ iframeìœ¼ë¡œ ë¡œë“œ
                log('ğŸ“„ í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ ë¡œë“œ ì¤‘...', 'info');
                
                const iframe = document.createElement('iframe');
                iframe.src = 'http://localhost:8080/frontend/index.html';
                iframe.style.width = '100%';
                iframe.style.height = '600px';
                iframe.style.border = '1px solid #ccc';
                iframe.style.marginTop = '20px';
                
                iframe.onload = function() {
                    log('âœ… í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'success');
                    
                    // iframe ë‚´ë¶€ì˜ ë””ë²„ê·¸ ë¡œê·¸ë¥¼ ëª¨ë‹ˆí„°ë§
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        const debugLogDiv = iframeDoc.getElementById('debug-log');
                        
                        if (debugLogDiv) {
                            log('âœ… ë””ë²„ê·¸ ë¡œê·¸ ì˜ì—­ ë°œê²¬', 'success');
                            
                            // ë””ë²„ê·¸ ë¡œê·¸ ë³€í™” ëª¨ë‹ˆí„°ë§
                            const observer = new MutationObserver(function(mutations) {
                                mutations.forEach(function(mutation) {
                                    if (mutation.type === 'childList') {
                                        const newLogs = Array.from(mutation.addedNodes)
                                            .filter(node => node.nodeType === Node.TEXT_NODE || node.nodeType === Node.ELEMENT_NODE)
                                            .map(node => node.textContent || node.innerText)
                                            .filter(text => text.trim());
                                        
                                        newLogs.forEach(logText => {
                                            log(`ğŸ“‹ í”„ë¡ íŠ¸ì—”ë“œ ë¡œê·¸: ${logText}`, 'info');
                                        });
                                    }
                                });
                            });
                            
                            observer.observe(debugLogDiv, { childList: true, subtree: true });
                            log('ğŸ‘€ ë””ë²„ê·¸ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ì‹œì‘', 'info');
                            
                        } else {
                            log('âŒ ë””ë²„ê·¸ ë¡œê·¸ ì˜ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'error');
                        }
                        
                        // íŒŒì¼ ì…ë ¥ ìš”ì†Œ ì°¾ê¸°
                        const fileInput = iframeDoc.getElementById('fileInput');
                        if (fileInput) {
                            log('âœ… íŒŒì¼ ì…ë ¥ ìš”ì†Œ ë°œê²¬', 'success');
                            
                            // ê°€ìƒ íŒŒì¼ ìƒì„± ë° ì„ íƒ ì‹œë®¬ë ˆì´ì…˜
                            setTimeout(() => {
                                log('ğŸ“ ê°€ìƒ íŒŒì¼ ì„ íƒ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘', 'info');
                                
                                // ê°€ìƒ íŒŒì¼ ìƒì„±
                                const testContent = 'This is a test file for upload testing.';
                                const testFile = new File([testContent], 'test-upload.txt', { type: 'text/plain' });
                                
                                // FileList ê°ì²´ ìƒì„±
                                const dataTransfer = new DataTransfer();
                                dataTransfer.items.add(testFile);
                                
                                // íŒŒì¼ ì…ë ¥ì— íŒŒì¼ ì„¤ì •
                                fileInput.files = dataTransfer.files;
                                
                                // change ì´ë²¤íŠ¸ ë°œìƒ
                                const changeEvent = new Event('change', { bubbles: true });
                                fileInput.dispatchEvent(changeEvent);
                                
                                log('âœ… íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸ ë°œìƒì‹œí‚´', 'success');
                                
                                // ì—…ë¡œë“œ ë²„íŠ¼ ì°¾ê¸° ë° í´ë¦­
                                setTimeout(() => {
                                    const uploadBtn = iframeDoc.getElementById('uploadBtn');
                                    if (uploadBtn) {
                                        log('âœ… ì—…ë¡œë“œ ë²„íŠ¼ ë°œê²¬', 'success');
                                        log(`ğŸ”˜ ì—…ë¡œë“œ ë²„íŠ¼ ìƒíƒœ: ${uploadBtn.disabled ? 'ë¹„í™œì„±í™”' : 'í™œì„±í™”'}`, 'info');
                                        
                                        if (!uploadBtn.disabled) {
                                            log('ğŸš€ ì—…ë¡œë“œ ë²„íŠ¼ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜', 'info');
                                            uploadBtn.click();
                                        } else {
                                            log('âŒ ì—…ë¡œë“œ ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŒ', 'error');
                                        }
                                    } else {
                                        log('âŒ ì—…ë¡œë“œ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'error');
                                    }
                                }, 1000);
                                
                            }, 2000);
                            
                        } else {
                            log('âŒ íŒŒì¼ ì…ë ¥ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ', 'error');
                        }
                        
                    } catch (error) {
                        log('âŒ iframe ì ‘ê·¼ ì˜¤ë¥˜: ' + error.message, 'error');
                        log('â„¹ï¸ CORS ì •ì±…ìœ¼ë¡œ ì¸í•´ iframe ë‚´ë¶€ì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'info');
                    }
                };
                
                iframe.onerror = function() {
                    log('âŒ í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ ë¡œë“œ ì‹¤íŒ¨', 'error');
                };
                
                document.body.appendChild(iframe);
                
            } catch (error) {
                log('âŒ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', function() {
            log('ğŸ¯ ìë™í™” í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì¤€ë¹„ ì™„ë£Œ', 'success');
        });
    </script>
</body>
</html>