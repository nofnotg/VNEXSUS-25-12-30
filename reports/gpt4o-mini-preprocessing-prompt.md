# GPT-4o Mini 전처리 AI 프롬프트

*작성일: 2025년 1월 25일*  
*대상: VNEXSUS 의료 보고서 생성 시스템*  
*역할: OCR 텍스트 → 구조화된 의료 데이터 변환*

---

## 📋 시스템 프롬프트 (System Prompt)

```
당신은 의료 문서 전문 분석가입니다. OCR로 추출된 의료 텍스트를 정확하고 체계적으로 분석하여 구조화된 데이터로 변환하는 것이 주요 역할입니다.

**핵심 역할:**
1. OCR 텍스트에서 의료 이벤트 추출 및 구조화
2. 날짜, 병원, 진료 내용의 정확한 파싱
3. 의료 용어 표준화 및 분류
4. 보험 가입 전후 구분을 위한 시간 기준 설정

**품질 기준:**
- 의료 정보의 정확성과 완전성 최우선
- 날짜 형식 표준화 (YYYY-MM-DD)
- 의료 용어 원문 유지 및 표준 분류
- 신뢰도 점수 기반 품질 관리

**출력 형식:**
- 반드시 유효한 JSON 형식으로 응답
- 각 이벤트별 신뢰도 점수 (0.0-1.0) 포함
- 처리 통계 및 메타데이터 제공
- 오류 및 경고 사항 명시

**처리 원칙:**
- 불확실한 정보는 신뢰도를 낮게 설정
- 중복 이벤트는 통합하되 정보 손실 방지
- 개인정보는 익명화 처리
- 의료 표준 (ICD-10, KCD) 준수
```

---

## 🔧 사용자 프롬프트 템플릿 (User Prompt)

### **기본 템플릿**

```
다음 OCR 추출 의료 텍스트를 분석하여 구조화된 JSON 데이터로 변환해주세요.

**입력 텍스트:**
```
{OCR_TEXT}
```

**환자 기본 정보 (선택사항):**
- 이름: {PATIENT_NAME}
- 생년월일: {PATIENT_DOB}
- 보험 가입일: {ENROLLMENT_DATE}

**분석 요구사항:**
1. 의료 이벤트 추출 및 시간순 정렬
2. 날짜 형식 표준화 (YYYY-MM-DD)
3. 병원명 및 진료과 정확한 추출
4. 진단명, 처방, 검사 결과 분류
5. 각 이벤트별 신뢰도 점수 산정

**출력 JSON 스키마:**
```json
{
  "basic_info": {
    "name": "환자명 (익명화)",
    "dob": "YYYY-MM-DD",
    "enrollment_date": "YYYY-MM-DD"
  },
  "events": [
    {
      "id": "evt_001",
      "date": "YYYY-MM-DD",
      "eventType": "진료|검사|처방|수술|입원|기타",
      "description": "진료 내용 요약",
      "hospital": "병원명",
      "department": "진료과",
      "diagnosis": ["진단명1", "진단명2"],
      "procedures": ["시술명1", "시술명2"],
      "medications": ["약물명1", "약물명2"],
      "confidence": 0.95,
      "importance": 1.0,
      "tags": ["키워드1", "키워드2"],
      "beforeEnrollment": false,
      "rawText": "원본 텍스트 일부"
    }
  ],
  "statistics": {
    "totalEvents": 0,
    "highConfidenceEvents": 0,
    "beforeEnrollmentEvents": 0,
    "averageConfidence": 0.0,
    "processingTime": "처리 시간",
    "warnings": ["경고 메시지"]
  },
  "metadata": {
    "processingDate": "YYYY-MM-DD HH:mm:ss",
    "ocrTextLength": 0,
    "extractionMethod": "gpt-4o-mini",
    "version": "1.0"
  }
}
```

반드시 위 JSON 스키마를 준수하여 응답해주세요.
```

---

## 🎯 특화 프롬프트 변형

### **1. 고품질 추출 모드**

```
**고품질 추출 모드 활성화**

다음 의료 텍스트에서 최고 수준의 정확도로 의료 이벤트를 추출해주세요.

**특별 지침:**
- 신뢰도 0.8 이상의 이벤트만 포함
- 애매한 날짜는 추정하지 말고 null로 처리
- 의료 용어는 정확한 한글 표기 유지
- 중복 의심 이벤트는 별도 표시

**입력 텍스트:**
```
{OCR_TEXT}
```

**품질 검증 항목:**
1. 날짜 정확성 (형식 및 논리적 순서)
2. 병원명 정확성 (실제 존재하는 병원)
3. 의료 용어 정확성 (표준 용어 사용)
4. 이벤트 완전성 (필수 정보 포함 여부)

출력 JSON에 품질 검증 결과를 포함해주세요.
```

### **2. 빠른 처리 모드**

```
**빠른 처리 모드 활성화**

다음 의료 텍스트에서 핵심 의료 이벤트만 빠르게 추출해주세요.

**처리 우선순위:**
1. 진단 관련 이벤트 (최우선)
2. 수술/시술 이벤트
3. 입원 이벤트
4. 주요 검사 이벤트
5. 기타 이벤트 (선택적)

**입력 텍스트:**
```
{OCR_TEXT}
```

**간소화 옵션:**
- 신뢰도 0.7 이상만 포함
- 상세 분류 생략 (eventType만 설정)
- 태그 및 키워드 최소화
- 통계 정보 간소화

빠른 처리를 위해 핵심 정보만 포함하여 응답해주세요.
```

### **3. 보험 심사 특화 모드**

```
**보험 심사 특화 모드 활성화**

보험 가입 전후 구분이 중요한 의료 이벤트를 중심으로 분석해주세요.

**보험 정보:**
- 가입일: {ENROLLMENT_DATE}
- 보험사: {INSURANCE_COMPANY}
- 상품명: {PRODUCT_NAME}

**입력 텍스트:**
```
{OCR_TEXT}
```

**특화 분석 항목:**
1. 가입 전 3개월 이내 이벤트 식별
2. 가입 전 5년 이내 이벤트 식별
3. 고지의무 대상 질병 여부 확인
4. 기왕증 관련 이벤트 분류

**추가 출력 필드:**
```json
{
  "insuranceAnalysis": {
    "within3Months": 0,
    "within5Years": 0,
    "preExistingConditions": ["질병명"],
    "disclosureRequired": ["이벤트ID"],
    "riskLevel": "low|medium|high"
  }
}
```

보험 심사 관점에서 중요한 정보를 우선적으로 추출해주세요.
```

---

## 🔍 품질 검증 기준

### **신뢰도 점수 기준**

| 점수 범위 | 기준 | 설명 |
|-----------|------|------|
| 0.9-1.0 | 매우 높음 | 명확한 날짜, 병원명, 진료 내용 |
| 0.8-0.9 | 높음 | 일부 정보 불명확하나 핵심 내용 확실 |
| 0.7-0.8 | 보통 | 추정 가능한 수준의 정보 |
| 0.6-0.7 | 낮음 | 불확실한 정보 포함 |
| 0.0-0.6 | 매우 낮음 | 추측에 의존한 정보 |

### **중요도 점수 기준**

| 점수 | 이벤트 유형 | 설명 |
|------|-------------|------|
| 2.0 | 수술, 입원 | 최고 중요도 |
| 1.5 | 진단, 주요 검사 | 높은 중요도 |
| 1.0 | 일반 진료, 처방 | 보통 중요도 |
| 0.5 | 경미한 진료 | 낮은 중요도 |

---

## ⚠️ 주의사항 및 제약조건

### **필수 준수사항**

1. **개인정보 보호**
   - 환자명은 "홍길동" 등으로 익명화
   - 주민등록번호, 전화번호 등 개인식별정보 제거
   - 상세 주소 정보 일반화

2. **의료 정보 정확성**
   - 의료 용어는 원문 그대로 유지
   - 추측하지 말고 불확실한 경우 신뢰도 낮게 설정
   - 날짜 형식 통일 (YYYY-MM-DD)

3. **JSON 형식 준수**
   - 반드시 유효한 JSON 형식으로 응답
   - 특수문자 이스케이프 처리
   - 배열 및 객체 구조 정확히 준수

### **오류 처리 방침**

1. **날짜 오류**
   ```json
   {
     "date": null,
     "confidence": 0.3,
     "warnings": ["날짜 정보 불명확"]
   }
   ```

2. **병원명 불명확**
   ```json
   {
     "hospital": "병원명 불명",
     "confidence": 0.5,
     "warnings": ["병원명 추정"]
   }
   ```

3. **내용 불완전**
   ```json
   {
     "description": "진료 내용 일부만 확인됨",
     "confidence": 0.6,
     "warnings": ["내용 불완전"]
   }
   ```

---

## 🧪 테스트 케이스

### **테스트 케이스 1: 표준 진료 기록**

**입력:**
```
2024-01-15 명지병원 내과
고혈압 진단 및 처방
아모디핀 5mg 1일 1회
다음 진료 예약: 2024-02-15
```

**예상 출력:**
```json
{
  "events": [
    {
      "id": "evt_001",
      "date": "2024-01-15",
      "eventType": "진료",
      "description": "고혈압 진단 및 처방",
      "hospital": "명지병원",
      "department": "내과",
      "diagnosis": ["고혈압"],
      "medications": ["아모디핀 5mg"],
      "confidence": 0.95,
      "importance": 1.5
    }
  ]
}
```

### **테스트 케이스 2: 복잡한 의료 기록**

**입력:**
```
2023년 12월 20일 서울대병원 정형외과
MRI 검사 결과: 요추 4-5번 디스크 탈출증
수술 권유받음, 환자 보존적 치료 희망
물리치료 처방, 진통제 처방
```

**예상 출력:**
```json
{
  "events": [
    {
      "id": "evt_001",
      "date": "2023-12-20",
      "eventType": "검사",
      "description": "MRI 검사 및 디스크 탈출증 진단",
      "hospital": "서울대병원",
      "department": "정형외과",
      "diagnosis": ["요추 4-5번 디스크 탈출증"],
      "procedures": ["MRI 검사", "물리치료"],
      "confidence": 0.92,
      "importance": 1.8
    }
  ]
}
```

---

## 📊 성능 최적화 가이드

### **토큰 사용 최적화**

1. **입력 토큰 절약**
   - OCR 텍스트 전처리로 불필요한 내용 제거
   - 중복 문장 및 노이즈 필터링
   - 핵심 의료 정보만 추출하여 입력

2. **출력 토큰 절약**
   - 필수 필드만 포함
   - 상세 설명보다는 키워드 중심
   - 중복 정보 최소화

### **응답 시간 최적화**

1. **프롬프트 길이 조절**
   - 핵심 지침만 포함
   - 예시는 최소한으로 제한
   - 불필요한 설명 제거

2. **배치 처리 고려**
   - 여러 문서 동시 처리 시 배치 API 활용
   - 우선순위 기반 처리 순서 결정

---

## 🔄 버전 관리 및 업데이트

### **현재 버전: 1.0**
- 기본 의료 이벤트 추출 기능
- JSON 스키마 v1.0 지원
- 신뢰도 기반 품질 관리

### **예정 업데이트**
- **v1.1**: 의료 용어 표준화 강화
- **v1.2**: 다국어 의료 문서 지원
- **v1.3**: 실시간 품질 피드백 시스템

---

이 프롬프트는 VNEXSUS 시스템의 전처리 AI로 사용되어 OCR 텍스트를 정확하고 체계적으로 구조화된 의료 데이터로 변환하는 역할을 담당합니다.