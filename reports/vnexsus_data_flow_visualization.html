<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VNEXSUS 엔드투엔드 데이터 플로우 시각화</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.8;
            font-size: 1.1em;
        }
        
        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            text-align: center;
        }
        
        .control-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .control-btn.active {
            background: #e74c3c;
        }
        
        .control-btn.success {
            background: #27ae60;
        }
        
        .visualization-container {
            padding: 30px;
            background: #f8f9fa;
        }
        
        #data-flow-svg {
            width: 100%;
            height: 900px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: linear-gradient(45deg, #f8f9fa 0%, #ffffff 100%);
        }
        
        .step-info {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }
        
        .step-info h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        
        .metrics-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .metric-label {
            font-size: 12px;
            color: #7f8c8d;
            text-transform: uppercase;
        }
        
        /* SVG 애니메이션 스타일 */
        .process-step {
            fill: #ecf0f1;
            stroke: #bdc3c7;
            stroke-width: 2;
            rx: 10;
            ry: 10;
            transition: all 0.5s ease;
        }
        
        .process-step.active {
            fill: #3498db;
            stroke: #2980b9;
            stroke-width: 3;
            filter: drop-shadow(0 0 10px rgba(52, 152, 219, 0.5));
        }
        
        .process-step.completed {
            fill: #27ae60;
            stroke: #229954;
        }
        
        .process-step.ai-processing {
            fill: #e74c3c;
            stroke: #c0392b;
        }
        
        .step-text {
            fill: #2c3e50;
            font-family: 'Segoe UI', sans-serif;
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            dominant-baseline: middle;
        }
        
        .step-text.active {
            fill: white;
        }
        
        .data-packet {
            fill: #f39c12;
            stroke: #e67e22;
            stroke-width: 2;
            r: 8;
        }
        
        .flow-line {
            stroke: #95a5a6;
            stroke-width: 3;
            fill: none;
            stroke-dasharray: 10,5;
            opacity: 0.3;
        }
        
        .flow-line.active {
            stroke: #3498db;
            opacity: 1;
            animation: flow 2s linear infinite;
        }
        
        @keyframes flow {
            0% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: -15; }
        }
        
        .ai-glow {
            animation: aiGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes aiGlow {
            0% { filter: drop-shadow(0 0 5px rgba(231, 76, 60, 0.5)); }
            100% { filter: drop-shadow(0 0 20px rgba(231, 76, 60, 0.8)); }
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>VNEXSUS 엔드투엔드 데이터 플로우</h1>
            <p>의료 문서에서 최종 보고서까지의 완전한 데이터 처리 과정</p>
        </div>
        
        <div class="controls">
            <button class="control-btn" onclick="startAnimation()">플로우 시작</button>
            <button class="control-btn" onclick="pauseAnimation()">일시정지</button>
            <button class="control-btn" onclick="resetAnimation()">초기화</button>
            <button class="control-btn" onclick="showMetrics()">성능 메트릭</button>
            <button class="control-btn" onclick="stepByStep()">단계별 실행</button>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        
        <div class="visualization-container">
            <svg id="data-flow-svg" viewBox="0 0 1400 800">
                <!-- 배경 그리드 -->
                <defs>
                    <pattern id="grid" width="30" height="30" patternUnits="userSpaceOnUse">
                        <path d="M 30 0 L 0 0 0 30" fill="none" stroke="#f0f0f0" stroke-width="1"/>
                    </pattern>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                            refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#3498db" />
                    </marker>
                </defs>
                <rect width="100%" height="100%" fill="url(#grid)" />
                
                <!-- 단계별 프로세스 박스들 -->
                <!-- 1. 파일 업로드 -->
                <rect class="process-step" id="step-1" x="50" y="100" width="120" height="80" 
                      data-tooltip="사용자가 의료 문서 파일을 업로드합니다. 지원 형식: PDF, JPG, PNG"/>
                <text class="step-text" x="110" y="130">파일 업로드</text>
                <text class="step-text" x="110" y="150" font-size="10">PDF/이미지</text>
                
                <!-- 2. OCR 처리 -->
                <rect class="process-step" id="step-2" x="220" y="100" width="120" height="80" 
                      data-tooltip="OCR 엔진이 이미지에서 텍스트를 추출합니다. 정확도: 95%+"/>
                <text class="step-text" x="280" y="130">OCR 처리</text>
                <text class="step-text" x="280" y="150" font-size="10">텍스트 추출</text>
                
                <!-- 3. GPT-4o Mini 전처리 -->
                <rect class="process-step ai-processing" id="step-3" x="390" y="100" width="140" height="80" 
                      data-tooltip="GPT-4o Mini가 추출된 텍스트를 구조화된 JSON으로 변환합니다. 토큰 절약: 35%"/>
                <text class="step-text" x="460" y="125">GPT-4o Mini</text>
                <text class="step-text" x="460" y="140" font-size="10">전처리 AI</text>
                <text class="step-text" x="460" y="155" font-size="10">구조화</text>
                
                <!-- 4. 데이터 검증 -->
                <rect class="process-step" id="step-4" x="580" y="100" width="120" height="80" 
                      data-tooltip="추출된 데이터의 무결성과 완성도를 검증합니다"/>
                <text class="step-text" x="640" y="130">데이터 검증</text>
                <text class="step-text" x="640" y="150" font-size="10">품질 확인</text>
                
                <!-- 5. 시간순 정렬 -->
                <rect class="process-step" id="step-5" x="750" y="100" width="120" height="80" 
                      data-tooltip="의료 이벤트를 시간순으로 정렬하고 분류합니다"/>
                <text class="step-text" x="810" y="130">시간순 정렬</text>
                <text class="step-text" x="810" y="150" font-size="10">이벤트 분류</text>
                
                <!-- 6. GPT-4o Mini 보고서 생성 -->
                <rect class="process-step ai-processing" id="step-6" x="920" y="100" width="140" height="80" 
                      data-tooltip="GPT-4o Mini가 구조화된 데이터로 전문 의료 보고서를 생성합니다"/>
                <text class="step-text" x="990" y="125">GPT-4o Mini</text>
                <text class="step-text" x="990" y="140" font-size="10">보고서 생성</text>
                <text class="step-text" x="990" y="155" font-size="10">AI</text>
                
                <!-- 7. Claude 3 Haiku 보완 -->
                <rect class="process-step ai-processing" id="step-7" x="1110" y="100" width="120" height="80" 
                      data-tooltip="Claude 3 Haiku가 보고서를 보완하고 개선합니다"/>
                <text class="step-text" x="1170" y="125">Claude 3</text>
                <text class="step-text" x="1170" y="140" font-size="10">Haiku</text>
                <text class="step-text" x="1170" y="155" font-size="10">보완</text>
                
                <!-- 8. GPT-4o 최종 검증 -->
                <rect class="process-step ai-processing" id="step-8" x="920" y="250" width="140" height="80" 
                      data-tooltip="GPT-4o가 최종 품질 검증을 수행합니다"/>
                <text class="step-text" x="990" y="275">GPT-4o</text>
                <text class="step-text" x="990" y="290" font-size="10">최종 검증</text>
                <text class="step-text" x="990" y="305" font-size="10">품질 관리</text>
                
                <!-- 9. O1-Mini 품질 체크 -->
                <rect class="process-step ai-processing" id="step-9" x="750" y="250" width="120" height="80" 
                      data-tooltip="O1-Mini가 추가 품질 검증을 수행합니다"/>
                <text class="step-text" x="810" y="275">O1-Mini</text>
                <text class="step-text" x="810" y="290" font-size="10">품질 체크</text>
                <text class="step-text" x="810" y="305" font-size="10">검증</text>
                
                <!-- 10. 보고서 포맷팅 -->
                <rect class="process-step" id="step-10" x="580" y="250" width="120" height="80" 
                      data-tooltip="최종 보고서를 마크다운 및 HTML 형식으로 포맷팅합니다"/>
                <text class="step-text" x="640" y="275">보고서</text>
                <text class="step-text" x="640" y="290" font-size="10">포맷팅</text>
                <text class="step-text" x="640" y="305" font-size="10">MD/HTML</text>
                
                <!-- 11. 최종 출력 -->
                <rect class="process-step" id="step-11" x="390" y="250" width="140" height="80" 
                      data-tooltip="완성된 보고서를 사용자에게 제공합니다"/>
                <text class="step-text" x="460" y="275">최종 출력</text>
                <text class="step-text" x="460" y="290" font-size="10">보고서 완성</text>
                <text class="step-text" x="460" y="305" font-size="10">다운로드</text>
                
                <!-- 데이터 플로우 라인들 -->
                <line class="flow-line" id="flow-1-2" x1="170" y1="140" x2="220" y2="140" marker-end="url(#arrowhead)"/>
                <line class="flow-line" id="flow-2-3" x1="340" y1="140" x2="390" y2="140" marker-end="url(#arrowhead)"/>
                <line class="flow-line" id="flow-3-4" x1="530" y1="140" x2="580" y2="140" marker-end="url(#arrowhead)"/>
                <line class="flow-line" id="flow-4-5" x1="700" y1="140" x2="750" y2="140" marker-end="url(#arrowhead)"/>
                <line class="flow-line" id="flow-5-6" x1="870" y1="140" x2="920" y2="140" marker-end="url(#arrowhead)"/>
                <line class="flow-line" id="flow-6-7" x1="1060" y1="140" x2="1110" y2="140" marker-end="url(#arrowhead)"/>
                <line class="flow-line" id="flow-7-8" x1="1170" y1="180" x2="990" y2="250" marker-end="url(#arrowhead)"/>
                <line class="flow-line" id="flow-8-9" x1="920" y1="290" x2="870" y2="290" marker-end="url(#arrowhead)"/>
                <line class="flow-line" id="flow-9-10" x1="750" y1="290" x2="700" y2="290" marker-end="url(#arrowhead)"/>
                <line class="flow-line" id="flow-10-11" x1="580" y1="290" x2="530" y2="290" marker-end="url(#arrowhead)"/>
                
                <!-- 데이터 패킷 (애니메이션용) -->
                <circle class="data-packet" id="data-packet" cx="110" cy="140" r="8" style="display: none;"/>
                
                <!-- 성능 메트릭 표시 영역 -->
                <g id="metrics-display" style="display: none;">
                    <rect x="50" y="400" width="300" height="200" fill="white" stroke="#3498db" stroke-width="2" rx="10"/>
                    <text x="70" y="430" fill="#2c3e50" font-size="16" font-weight="bold">실시간 성능 메트릭</text>
                    
                    <text x="70" y="460" fill="#27ae60" font-size="14">처리 시간: 2.3초</text>
                    <text x="70" y="480" fill="#27ae60" font-size="14">토큰 사용량: 3,247</text>
                    <text x="70" y="500" fill="#27ae60" font-size="14">정확도: 97.8%</text>
                    <text x="70" y="520" fill="#27ae60" font-size="14">API 호출: 4회</text>
                    <text x="70" y="540" fill="#e74c3c" font-size="14">메모리 사용: 45MB</text>
                    <text x="70" y="560" fill="#f39c12" font-size="14">비용: $0.023</text>
                </g>
                
                <!-- 프로세스 상태 표시 -->
                <g id="status-indicators">
                    <circle cx="1300" cy="140" r="8" fill="#95a5a6" id="status-1"/>
                    <circle cx="1300" cy="160" r="8" fill="#95a5a6" id="status-2"/>
                    <circle cx="1300" cy="180" r="8" fill="#95a5a6" id="status-3"/>
                    <circle cx="1300" cy="200" r="8" fill="#95a5a6" id="status-4"/>
                    <circle cx="1300" cy="220" r="8" fill="#95a5a6" id="status-5"/>
                    <circle cx="1300" cy="240" r="8" fill="#95a5a6" id="status-6"/>
                    <circle cx="1300" cy="260" r="8" fill="#95a5a6" id="status-7"/>
                    <circle cx="1300" cy="280" r="8" fill="#95a5a6" id="status-8"/>
                    <circle cx="1300" cy="300" r="8" fill="#95a5a6" id="status-9"/>
                    <circle cx="1300" cy="320" r="8" fill="#95a5a6" id="status-10"/>
                    <circle cx="1300" cy="340" r="8" fill="#95a5a6" id="status-11"/>
                </g>
            </svg>
            
            <div class="step-info" id="step-info">
                <h3>데이터 플로우 시각화</h3>
                <p>위의 '플로우 시작' 버튼을 클릭하여 VNEXSUS 시스템의 완전한 데이터 처리 과정을 확인하세요.</p>
            </div>
            
            <div class="metrics-panel" id="metrics-panel" style="display: none;">
                <div class="metric-card">
                    <div class="metric-value">2.3초</div>
                    <div class="metric-label">평균 처리 시간</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">35%</div>
                    <div class="metric-label">토큰 절약률</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">97.8%</div>
                    <div class="metric-label">정확도</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">4회</div>
                    <div class="metric-label">API 호출 수</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">$0.023</div>
                    <div class="metric-label">처리 비용</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">45MB</div>
                    <div class="metric-label">메모리 사용량</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        let currentStep = 0;
        let animationRunning = false;
        let animationPaused = false;
        let stepByStepMode = false;
        
        const steps = [
            { id: 'step-1', name: '파일 업로드', description: '사용자가 의료 문서를 업로드합니다.', duration: 500 },
            { id: 'step-2', name: 'OCR 처리', description: 'OCR 엔진이 이미지에서 텍스트를 추출합니다.', duration: 1000 },
            { id: 'step-3', name: 'GPT-4o Mini 전처리', description: 'AI가 텍스트를 구조화된 데이터로 변환합니다.', duration: 1500 },
            { id: 'step-4', name: '데이터 검증', description: '추출된 데이터의 품질을 검증합니다.', duration: 800 },
            { id: 'step-5', name: '시간순 정렬', description: '의료 이벤트를 시간순으로 정렬합니다.', duration: 600 },
            { id: 'step-6', name: 'GPT-4o Mini 보고서 생성', description: 'AI가 전문 의료 보고서를 생성합니다.', duration: 2000 },
            { id: 'step-7', name: 'Claude 3 Haiku 보완', description: 'Claude AI가 보고서를 보완합니다.', duration: 1200 },
            { id: 'step-8', name: 'GPT-4o 최종 검증', description: 'GPT-4o가 최종 품질 검증을 수행합니다.', duration: 1000 },
            { id: 'step-9', name: 'O1-Mini 품질 체크', description: 'O1-Mini가 추가 검증을 수행합니다.', duration: 800 },
            { id: 'step-10', name: '보고서 포맷팅', description: '보고서를 최종 형식으로 포맷팅합니다.', duration: 500 },
            { id: 'step-11', name: '최종 출력', description: '완성된 보고서를 사용자에게 제공합니다.', duration: 300 }
        ];
        
        // 툴팁 기능
        const tooltip = document.getElementById('tooltip');
        const elements = document.querySelectorAll('[data-tooltip]');
        
        elements.forEach(element => {
            element.addEventListener('mouseenter', (e) => {
                const tooltipText = e.target.getAttribute('data-tooltip');
                tooltip.innerHTML = tooltipText;
                tooltip.style.opacity = '1';
            });
            
            element.addEventListener('mousemove', (e) => {
                tooltip.style.left = e.pageX + 10 + 'px';
                tooltip.style.top = e.pageY - 30 + 'px';
            });
            
            element.addEventListener('mouseleave', () => {
                tooltip.style.opacity = '0';
            });
        });
        
        function updateStepInfo(stepIndex) {
            const stepInfo = document.getElementById('step-info');
            const step = steps[stepIndex];
            stepInfo.innerHTML = `
                <h3>단계 ${stepIndex + 1}: ${step.name}</h3>
                <p>${step.description}</p>
                <p><strong>예상 처리 시간:</strong> ${step.duration}ms</p>
            `;
        }
        
        function updateProgress(percentage) {
            const progressFill = document.getElementById('progress-fill');
            progressFill.style.width = percentage + '%';
        }
        
        function activateStep(stepIndex) {
            // 이전 단계들을 완료 상태로 변경
            for (let i = 0; i < stepIndex; i++) {
                const stepElement = document.getElementById(steps[i].id);
                const statusElement = document.getElementById(`status-${i + 1}`);
                stepElement.classList.remove('active');
                stepElement.classList.add('completed');
                statusElement.setAttribute('fill', '#27ae60');
            }
            
            // 현재 단계를 활성화
            if (stepIndex < steps.length) {
                const stepElement = document.getElementById(steps[stepIndex].id);
                const statusElement = document.getElementById(`status-${stepIndex + 1}`);
                stepElement.classList.add('active');
                statusElement.setAttribute('fill', '#3498db');
                
                // AI 모듈인 경우 글로우 효과 추가
                if (stepElement.classList.contains('ai-processing')) {
                    stepElement.classList.add('ai-glow');
                }
                
                // 플로우 라인 활성화
                if (stepIndex > 0) {
                    const flowLine = document.getElementById(`flow-${stepIndex}-${stepIndex + 1}`);
                    if (flowLine) {
                        flowLine.classList.add('active');
                    }
                }
                
                updateStepInfo(stepIndex);
                updateProgress((stepIndex + 1) / steps.length * 100);
            }
        }
        
        function deactivateStep(stepIndex) {
            if (stepIndex < steps.length) {
                const stepElement = document.getElementById(steps[stepIndex].id);
                stepElement.classList.remove('active', 'ai-glow');
            }
        }
        
        async function runAnimation() {
            if (animationPaused) return;
            
            for (let i = 0; i < steps.length; i++) {
                if (!animationRunning) break;
                if (animationPaused) return;
                
                currentStep = i;
                activateStep(i);
                
                if (stepByStepMode) {
                    return; // 단계별 모드에서는 여기서 중단
                }
                
                await new Promise(resolve => setTimeout(resolve, steps[i].duration));
                deactivateStep(i);
            }
            
            if (animationRunning) {
                // 애니메이션 완료
                animationRunning = false;
                updateStepInfo(steps.length - 1);
                document.getElementById('step-info').innerHTML += '<p><strong>✅ 모든 단계가 완료되었습니다!</strong></p>';
            }
        }
        
        function startAnimation() {
            if (animationRunning && !animationPaused) return;
            
            if (animationPaused) {
                animationPaused = false;
                runAnimation();
            } else {
                resetAnimation();
                animationRunning = true;
                stepByStepMode = false;
                runAnimation();
            }
        }
        
        function pauseAnimation() {
            animationPaused = true;
        }
        
        function resetAnimation() {
            animationRunning = false;
            animationPaused = false;
            stepByStepMode = false;
            currentStep = 0;
            
            // 모든 단계 초기화
            steps.forEach((step, index) => {
                const stepElement = document.getElementById(step.id);
                const statusElement = document.getElementById(`status-${index + 1}`);
                stepElement.classList.remove('active', 'completed', 'ai-glow');
                statusElement.setAttribute('fill', '#95a5a6');
            });
            
            // 플로우 라인 초기화
            document.querySelectorAll('.flow-line').forEach(line => {
                line.classList.remove('active');
            });
            
            updateProgress(0);
            document.getElementById('step-info').innerHTML = `
                <h3>데이터 플로우 시각화</h3>
                <p>위의 '플로우 시작' 버튼을 클릭하여 VNEXSUS 시스템의 완전한 데이터 처리 과정을 확인하세요.</p>
            `;
        }
        
        function showMetrics() {
            const metricsPanel = document.getElementById('metrics-panel');
            const metricsDisplay = document.getElementById('metrics-display');
            
            if (metricsPanel.style.display === 'none') {
                metricsPanel.style.display = 'grid';
                metricsDisplay.style.display = 'block';
            } else {
                metricsPanel.style.display = 'none';
                metricsDisplay.style.display = 'none';
            }
        }
        
        function stepByStep() {
            if (!stepByStepMode) {
                stepByStepMode = true;
                resetAnimation();
                animationRunning = true;
                currentStep = 0;
                activateStep(0);
            } else {
                // 다음 단계로 진행
                if (currentStep < steps.length - 1) {
                    deactivateStep(currentStep);
                    currentStep++;
                    activateStep(currentStep);
                } else {
                    // 마지막 단계 완료
                    stepByStepMode = false;
                    animationRunning = false;
                    document.getElementById('step-info').innerHTML += '<p><strong>✅ 모든 단계가 완료되었습니다!</strong></p>';
                }
            }
        }
        
        // 단계 클릭 이벤트
        steps.forEach((step, index) => {
            const stepElement = document.getElementById(step.id);
            stepElement.addEventListener('click', () => {
                if (!animationRunning) {
                    resetAnimation();
                    activateStep(index);
                }
            });
        });
    </script>
</body>
</html>