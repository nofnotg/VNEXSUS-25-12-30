# OCR ê¸°ë°˜ ì˜ë£Œ ë¬¸ì„œ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ ì¢…í•© ê°œì„  ê³„íš

## ğŸ“‹ ê°œìš”

**ì‘ì„±ì¼**: 2026-01-31
**ëª©ì **: ì‚¬ìš©ì í”¼ë“œë°± ê¸°ë°˜ OCR íŒŒì´í”„ë¼ì¸ ê°œì„  ë° Cycle 5 ê¸ì •ì  ìš”ì†Œ í¡ìˆ˜
**ëª©í‘œ**: ë‚ ì§œ ì •í™•ë„ 99.9%, ê°ê´€ì  ì •ë³´ ì œê³µ, íš¨ìœ¨ì  ì‚¬ìš©ì ê²½í—˜

---

## ğŸ¯ í”¼ë“œë°± ìš”ì•½ ë° ê°œì„  ë°©í–¥

### 1. ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ì–‘ì‹ ì¸ì‹ í‚¤ì›Œë“œ í™•ì¥

**í”¼ë“œë°±**:
- ë¬¸ì„œë§ˆë‹¤ í‘œí˜„ ë°©ì‹ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë©° ë‚ ì§œ ì–‘ì‹ë„ ë‹¤ì–‘í•¨
- Keywordsë¥¼ ê´€ìš©ì ìœ¼ë¡œ í™•ì¥í•˜ì—¬ ì´í•´ í•„ìš”

**í˜„ì¬ ë¬¸ì œ**:
- ê³ ì •ëœ í‚¤ì›Œë“œ ë§¤ì¹­ìœ¼ë¡œ ì¸í•œ ë‚®ì€ ì»¤ë²„ë¦¬ì§€
- ë‚ ì§œ í˜•ì‹ì˜ ë‹¤ì–‘ì„± ë¯¸ì²˜ë¦¬

**ê°œì„  ë°©í–¥**:
- í‚¤ì›Œë“œ ì‹œì†ŒëŸ¬ìŠ¤(Thesaurus) ì‹œìŠ¤í…œ êµ¬ì¶•
- ë‚ ì§œ í˜•ì‹ ì •ê·œí™” ê°•í™”
- ë™ì˜ì–´/ìœ ì‚¬ì–´ ìë™ í™•ì¥

**ì˜ˆì‹œ**:
```
ê¸°ì¡´: "ì§„ë£Œì¼" ë§¤ì¹­ë§Œ ìˆ˜í–‰
ê°œì„ : "ì§„ë£Œì¼", "ë‚´ì›ì¼", "ë°©ë¬¸ì¼", "ì§„ì°°ì¼", "ê²€ì‚¬ì¼", "ìˆ˜ì§„ì¼" ë“± ëª¨ë‘ ë§¤ì¹­

ê¸°ì¡´: "YYYY-MM-DD" í˜•ì‹ë§Œ ì¸ì‹
ê°œì„ : "YYYY.MM.DD", "YYYY/MM/DD", "YYYYë…„ MMì›” DDì¼", "YY.M.D" ë“± ëª¨ë‘ ì •ê·œí™”
```

---

### 2. ë³´í—˜ ì‹¬ì‚¬ ì—­í•  ë°°ì œ - ê°ê´€ì  ì •ë³´ ì œê³µ

**í”¼ë“œë°±**:
- ì‹œìŠ¤í…œì€ ë³´í—˜ ì‹¬ì‚¬ íŒë‹¨ì„ í•˜ì§€ ì•ŠìŒ
- ë³´í—˜íšŒì‚¬ê°€ íŒë‹¨í•  ìˆ˜ ìˆë„ë¡ ê°ê´€ì  ì •ë³´ë¥¼ ì •í™•íˆ ì •ë¦¬í•´ì„œ ì œì‹œ
- ì˜ê²¬ ì „ë‹¬ ì—­í• ì´ì§€ íŒë‹¨ ì—­í• ì´ ì•„ë‹˜

**ì œê±° ì‚¬í•­**:
- "ë³´í—˜ ì²­êµ¬ ìŠ¹ì¸/ê±°ë¶€ ì¶”ì²œ" ë¡œì§
- "ê³ ìœ„í—˜/ì €ìœ„í—˜" íŒì • ì‹œìŠ¤í…œ
- "ì‚¬ì „ì§ˆë³‘ í™•ì •" ë¬¸êµ¬

**ìœ ì§€ ì‚¬í•­**:
- ê°ê´€ì  ì‚¬ì‹¤ ë‚˜ì—´ (ë‚ ì§œ, ì§„ë‹¨ëª…, ê²€ì‚¬ ê²°ê³¼)
- ì‹œê°„ìˆœ ì •ë³´ ì •ë¦¬
- ì˜ë£Œ ê¸°ë¡ ìš”ì•½

**ë³´ê³ ì„œ í†¤ ë³€ê²½**:
```
ê¸°ì¡´: "ì´ í™˜ìëŠ” ì‚¬ì „ì§ˆë³‘ì— í•´ë‹¹í•˜ë¯€ë¡œ ë³´í—˜ ì²­êµ¬ê°€ ê±°ë¶€ë  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤."
ê°œì„ : "ë³´í—˜ ê°€ì…ì¼(YYYY-MM-DD) 3ê°œì›” ì´ë‚´ì¸ YYYY-MM-DDì— í•´ë‹¹ ì§ˆí™˜ìœ¼ë¡œ ì§„ë£Œ ê¸°ë¡ì´ í™•ì¸ë©ë‹ˆë‹¤."
```

---

### 3. Cycle 5 ê°œì„  ë¡œì§ í¡ìˆ˜ ë°œì „

**í”¼ë“œë°±**:
- Cycle 5ì˜ ê¸ì •ì  ì ‘ê·¼ë²•ê³¼ ë¡œì§ì„ íê¸°í•˜ì§€ ë§ê³  í¡ìˆ˜ ë°œì „
- LLM â†’ OCR ì „í™˜ì— ë§ì¶° ë°ì´í„° ì²˜ë¦¬ ê³¼ì • ì¬ì„¤ê³„
- í˜ì‹ ì„±, ë°œì „ì„±, í˜„ì‹¤ì„±, ì¬í˜„ì„±, ì•ˆì •ì„± ê³ ë ¤

**Cycle 5ì˜ ê¸ì •ì  ìš”ì†Œ**:
1. **7-Phase íŒŒì´í”„ë¼ì¸**: ë‹¨ê³„ë³„ ëª…í™•í•œ ì±…ì„ ë¶„ë¦¬
2. **Type-Based Scoring**: ë„ë©”ì¸ íŠ¹í™” ê°€ì¤‘ì¹˜ ì‹œìŠ¤í…œ
3. **Recency Scoring**: ì‹œê°„ ê¸°ë°˜ ìš°ì„ ìˆœìœ„
4. **Insurance Period Parser**: ë³´í—˜ ê¸°ê°„ íŒŒì‹±
5. **Document Metadata Filter**: ë©”íƒ€ë°ì´í„° í•„í„°ë§
6. **Context Analysis**: ì£¼ë³€ ì»¨í…ìŠ¤íŠ¸ ë¶„ì„
7. **Noise Reduction**: 59% ë…¸ì´ì¦ˆ ê°ì†Œ ì„±ê³µ

**OCR ì „í™˜ ì‹œ í¡ìˆ˜ ë°©ì•ˆ**:

#### 3.1 Phase 1: Date Range Validation (OCR ì ì‘)
```javascript
// Cycle 5 ë¡œì§ ìœ ì§€
function validateDateRange(date, referenceDate) {
  const age = calculateAge(date, referenceDate);
  if (age > 100) return { valid: false, reason: 'TOO_OLD' };
  if (age < -30) return { valid: false, reason: 'FUTURE_DATE' };
  return { valid: true };
}

// OCR ì¶”ê°€: BBox ê¸°ë°˜ ì‹ ë¢°ë„
function validateWithOCR(date, ocrBlock) {
  const baseValidation = validateDateRange(date, new Date());
  if (!baseValidation.valid) return baseValidation;

  // OCR ì‹ ë¢°ë„ ì¶”ê°€ ê²€ì¦
  if (ocrBlock.confidence < 0.7) {
    return { valid: false, reason: 'LOW_OCR_CONFIDENCE' };
  }

  return { valid: true, confidence: ocrBlock.confidence };
}
```

#### 3.2 Phase 2-7: Type-Based Scoring + OCR Context
```javascript
// Cycle 5ì˜ ìŠ¤ì½”ì–´ë§ ì‹œìŠ¤í…œ ìœ ì§€ + OCR BBox ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€
function calculateScore(date, ocrBlock, surroundingBlocks) {
  let score = 0;

  // Cycle 5 ë¡œì§ í¡ìˆ˜
  score += getTypeScore(date.type);           // 60-100ì 
  score += getRecencyScore(date.value);       // 20-50ì 
  score += getFrequencyBonus(date.value);     // 10-20ì 

  // OCR ì‹ ë¢°ë„ ë°˜ì˜
  score += ocrBlock.confidence * 10;          // 0-10ì 

  // BBox ê¸°ë°˜ ì»¨í…ìŠ¤íŠ¸ ë¶„ì„ (ë“±ê³ ì„  ê°œë… ì ìš©)
  score += analyzeProximityContext(ocrBlock, surroundingBlocks); // -25 ~ +25ì 

  return score;
}
```

**ì¬í˜„ì„± ë³´ì¥**:
- ë™ì¼ ì…ë ¥ â†’ ë™ì¼ ì¶œë ¥ ë³´ì¥
- OCR ì—”ì§„ ë²„ì „ ê³ ì •
- ë‚œìˆ˜ ì œê±°, ê²°ì •ë¡ ì  ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©

**ì•ˆì •ì„± ê°•í™”**:
- OCR ì‹¤íŒ¨ ì‹œ í´ë°± ë©”ì»¤ë‹ˆì¦˜
- ë‹¨ê³„ë³„ ì—ëŸ¬ í•¸ë“¤ë§
- ë¶€ë¶„ ì‹¤íŒ¨ í—ˆìš© (ì¼ë¶€ ë‚ ì§œ ì¶”ì¶œ ì‹¤íŒ¨í•´ë„ ì „ì²´ í”„ë¡œì„¸ìŠ¤ ê³„ì†)

---

### 4. GT Coverage ì¬í‰ê°€ - ì˜ë£Œ ë°ì´í„° ì¤‘ì‹¬

**í”¼ë“œë°±**:
- ë³´í—˜ ì •ë³´ëŠ” ê²€ì¦ íŒŒì¼ì— ì—†ì—ˆìœ¼ë‚˜ ì™„ë£Œë³´ê³ ì„œì— í¬í•¨ë¨
- ì˜ë£Œ ë°ì´í„°ì— í•œì •í•˜ì—¬ Coverage ì¬í‰ê°€
- ë³´í—˜ ê°€ì… ë‚´ìš©ì€ ì‚¬ìš©ì ì…ë ¥ìœ¼ë¡œ ì²˜ë¦¬
- ì…ë ¥ ì¼ì ê¸°ì¤€ 3ê°œì›”/5ë…„ ì´ë‚´ í•„í„°ë§
- ë‚ ì§œ ë°ì´í„° ì •í™•ë„ ëª©í‘œ: 99.9%

**êµ¬í˜„ ê³„íš**:

#### 4.1 GT Coverage ì¬ê³„ì‚° ë¡œì§
```javascript
class MedicalGTCoverageEvaluator {
  constructor() {
    this.excludeCategories = ['ë³´í—˜ì •ë³´', 'ë³´í—˜ê¸°ê°„', 'ë³´í—˜ê°€ì…ì¼'];
  }

  evaluateCoverage(extractedDates, groundTruth, userInputDate) {
    // 1. ë³´í—˜ ì •ë³´ ì œì™¸
    const medicalGT = groundTruth.filter(
      item => !this.excludeCategories.includes(item.category)
    );

    // 2. ë‚ ì§œ ë²”ìœ„ í•„í„°ë§ (3ê°œì›”/5ë…„)
    const filteredDates = this.filterByDateRange(
      extractedDates,
      userInputDate
    );

    // 3. Coverage ê³„ì‚°
    const matched = this.findMatches(filteredDates, medicalGT);
    const coverage = (matched.length / medicalGT.length) * 100;

    // 4. 99.9% ëª©í‘œ ê²€ì¦
    return {
      coverage: coverage,
      target: 99.9,
      achieved: coverage >= 99.9,
      medicalGTCount: medicalGT.length,
      matchedCount: matched.length,
      missedDates: this.findMissed(filteredDates, medicalGT)
    };
  }

  filterByDateRange(dates, referenceDate) {
    const threeMonthsAgo = new Date(referenceDate);
    threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);

    const fiveYearsAgo = new Date(referenceDate);
    fiveYearsAgo.setFullYear(fiveYearsAgo.getFullYear() - 5);

    return dates.map(date => ({
      ...date,
      within3Months: date.value >= threeMonthsAgo,
      within5Years: date.value >= fiveYearsAgo
    }));
  }
}
```

#### 4.2 ì‚¬ìš©ì ì…ë ¥ ë³´í—˜ ì •ë³´ í†µí•©
```javascript
class InsuranceInputHandler {
  processUserInput(insuranceData) {
    return {
      policyNumber: insuranceData.policyNumber,
      startDate: insuranceData.startDate,
      endDate: insuranceData.endDate,
      coverageType: insuranceData.coverageType,
      // 3ê°œì›”/5ë…„ ê¸°ì¤€ ê³„ì‚°
      threeMonthsThreshold: this.addMonths(insuranceData.startDate, 3),
      fiveYearsThreshold: this.addYears(insuranceData.startDate, 5)
    };
  }

  highlightRelevantDates(medicalDates, insuranceInput) {
    return medicalDates.map(date => ({
      ...date,
      relevance: {
        within3Months: date.value < insuranceInput.threeMonthsThreshold,
        within5Years: date.value < insuranceInput.fiveYearsThreshold,
        priority: this.calculatePriority(date, insuranceInput)
      }
    }));
  }
}
```

**íš¨ìœ¨ì„± ì œê³µ**:
- ìˆ˜ì‹­~ë°± ì¥ ì˜ë£Œ ë¬¸ì„œë¥¼ 5ë¶„ ë‚´ ì²˜ë¦¬
- ë‚ ì§œ ì¤‘ì‹¬ ì •ë ¬ë¡œ ë¹ ë¥¸ ê²€í†  ê°€ëŠ¥
- ê´€ë ¨ ë‚ ì§œ í•˜ì´ë¼ì´íŠ¸ ì œê³µ

---

### 5. DNA ë¶„ì„ ê²°ê³¼ ë³´ë¥˜

**í”¼ë“œë°±**:
- DNA ì‹œí€€ì‹±ì€ ë³´ë¥˜ëœ ë¡œì§
- í•­ëª©ë³´ê³ ì„œì—ì„œ DNA ë¶„ì„ ì œì™¸

**êµ¬í˜„**:
```javascript
class ItemCategoryClassifier {
  constructor() {
    this.excludedCategories = [
      'DNA_SEQUENCING',
      'GENETIC_ANALYSIS'
    ];

    this.activeCategories = [
      'VISIT_DATE',           // ë‚´ì›ì¼
      'DIAGNOSIS',            // ì§„ë‹¨ëª…
      'PRESCRIPTION',         // ì²˜ë°©
      'LAB_TEST',            // ê²€ì‚¬
      'IMAGING',             // ì˜ìƒ
      'PROCEDURE',           // ì‹œìˆ /ìˆ˜ìˆ 
      'ADMISSION',           // ì…ì›
      'DISCHARGE',           // í‡´ì›
      'EMERGENCY',           // ì‘ê¸‰
      // 'DNA_ANALYSIS' - ì œì™¸
    ];
  }

  classifyItem(item) {
    // DNA ê´€ë ¨ í‚¤ì›Œë“œ ë°œê²¬ ì‹œ ë¬´ì‹œ
    if (this.isDNARelated(item.text)) {
      return null;
    }

    return this.findCategory(item);
  }

  isDNARelated(text) {
    const dnaKeywords = [
      'DNA', 'DNAì‹œí€€ì‹±', 'ìœ ì „ìë¶„ì„', 'Genetic sequencing',
      'ì—¼ê¸°ì„œì—´ë¶„ì„', 'NGS', 'Next Generation Sequencing'
    ];

    return dnaKeywords.some(keyword =>
      text.toLowerCase().includes(keyword.toLowerCase())
    );
  }
}
```

---

### 6. ë‚ ì§œ ë°ì´í„° ì •ë ¬ ë° í‘œê¸° í˜•ì‹ ê°œì„ 

**í”¼ë“œë°±**:
- ë‚ ì§œ ë°ì´í„° ì˜¤ë¦„ì°¨ìˆœ ì •ë¦¬
- ë‚´ì›ì¼ì‹œ ì¤‘ë³µ í‘œê¸° ì œê±°
- ìƒˆë¡œìš´ í‘œê¸° í˜•ì‹: "1. yyyy.mm.dd: ë‚´ì›ì¼"
- í•­ëª©ë³´ê³ ì„œëŠ” ë‚´ì›ê²½ìœ„ë¶€í„° ì •ëˆ

**êµ¬í˜„**:

#### 6.1 ë‚ ì§œ ì •ë ¬ ë° ë„˜ë²„ë§
```javascript
class DateReportFormatter {
  formatDateTimeline(medicalEvents) {
    // 1. ë‚ ì§œ ê¸°ì¤€ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
    const sorted = medicalEvents.sort((a, b) =>
      new Date(a.visitDate) - new Date(b.visitDate)
    );

    // 2. ì¤‘ë³µ ë‚ ì§œ ê·¸ë£¹í•‘
    const grouped = this.groupByDate(sorted);

    // 3. í¬ë§·íŒ…
    return grouped.map((group, index) =>
      this.formatDateGroup(group, index + 1)
    );
  }

  formatDateGroup(group, index) {
    const date = this.formatDate(group.date); // "yyyy.mm.dd"

    return {
      number: index,
      dateLabel: `${index}. ${date}: ë‚´ì›ì¼`,
      events: group.events.map(event =>
        this.formatEvent(event) // ë‚´ì›ì¼ì‹œ ì œì™¸, ë‚´ì›ê²½ìœ„ë¶€í„° ì‹œì‘
      )
    };
  }

  formatEvent(event) {
    // ë‚´ì›ì¼ì‹œëŠ” ë‚ ì§œ ë ˆì´ë¸”ì— í¬í•¨ë˜ì—ˆìœ¼ë¯€ë¡œ ì œì™¸
    return {
      // visitDateTime: event.visitDateTime,  // ì œê±°
      visitReason: event.visitReason,         // ë‚´ì›ê²½ìœ„ (ì‹œì‘)
      chiefComplaint: event.chiefComplaint,   // ì£¼ì†Œ
      diagnosis: event.diagnosis,             // ì§„ë‹¨
      treatment: event.treatment,             // ì²˜ì¹˜
      prescription: event.prescription        // ì²˜ë°©
    };
  }

  formatDate(dateString) {
    const date = new Date(dateString);
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');

    return `${year}.${month}.${day}`;
  }

  groupByDate(events) {
    const groups = {};

    events.forEach(event => {
      const dateKey = event.visitDate.split('T')[0]; // ISO dateë§Œ ì¶”ì¶œ

      if (!groups[dateKey]) {
        groups[dateKey] = {
          date: dateKey,
          events: []
        };
      }

      groups[dateKey].events.push(event);
    });

    return Object.values(groups);
  }
}
```

#### 6.2 ë³´ê³ ì„œ ì˜ˆì‹œ
```markdown
## ë‚ ì§œë³„ ì˜ë£Œ ì´ë ¥

1. 2023.01.15: ë‚´ì›ì¼
   - ë‚´ì›ê²½ìœ„: ë‘í†µ ë° ì–´ì§€ëŸ¬ì›€ ì¦ìƒìœ¼ë¡œ ë‚´ì›
   - ì£¼ì†Œ: ë‘í†µ, ì–´ì§€ëŸ¬ì›€
   - ì§„ë‹¨: R51 ë‘í†µ, R42 ì–´ì§€ëŸ¬ì›€
   - ì²˜ì¹˜: í˜ˆì•• ì¸¡ì •, ì‹ ê²½í•™ì  ê²€ì‚¬
   - ì²˜ë°©: ì§„í†µì œ (ì•„ì„¸íŠ¸ì•„ë¯¸ë…¸íœ 500mg)

2. 2023.02.20: ë‚´ì›ì¼
   - ë‚´ì›ê²½ìœ„: ì¦ìƒ ì§€ì†ìœ¼ë¡œ ì¬ë‚´ì›
   - ì£¼ì†Œ: ë‘í†µ ì§€ì†
   - ì§„ë‹¨: G43.9 í¸ë‘í†µ
   - ì²˜ì¹˜: MRI ê²€ì‚¬
   - ì²˜ë°©: í¸ë‘í†µ ì¹˜ë£Œì œ (ìˆ˜ë§ˆíŠ¸ë¦½íƒ„ 50mg)

3. 2023.02.20: ë‚´ì›ì¼
   - ë‚´ì›ê²½ìœ„: MRI ê²€ì‚¬ ê²°ê³¼ í™•ì¸
   - ì£¼ì†Œ: ê²€ì‚¬ ê²°ê³¼ ìƒë‹´
   - ì§„ë‹¨: ì´ìƒ ì†Œê²¬ ì—†ìŒ
   - ì²˜ì¹˜: ê²°ê³¼ ì„¤ëª…
   - ì²˜ë°©: ê¸°ì¡´ ì²˜ë°© ìœ ì§€
```

---

### 7. ì§„ë‹¨ë³‘ëª… í‘œê¸° í˜•ì‹ í†µì¼

**í”¼ë“œë°±**:
- "ICD/KCDì½”ë“œ í•œê¸€ ì˜ë¬¸" ìˆœì„œë¡œ ë³‘ê¸°
- í•œê¸€ì„ ë¨¼ì € ë°°ì¹˜

**êµ¬í˜„**:
```javascript
class DiagnosisFormatter {
  formatDiagnosis(diagnosisData) {
    // 1. ICD/KCD ì½”ë“œ ì¶”ì¶œ
    const code = diagnosisData.code; // ì˜ˆ: "M54.5"

    // 2. í•œê¸€ëª… ì¶”ì¶œ
    const korean = diagnosisData.nameKorean; // ì˜ˆ: "ìš”í†µ"

    // 3. ì˜ë¬¸ëª… ì¶”ì¶œ
    const english = diagnosisData.nameEnglish; // ì˜ˆ: "Low back pain"

    // 4. í˜•ì‹ í†µì¼: "ì½”ë“œ í•œê¸€ ì˜ë¬¸"
    return `${code} ${korean} ${english}`;
  }

  formatMultipleDiagnoses(diagnoses) {
    return diagnoses.map((dx, index) => ({
      order: index + 1,
      formatted: this.formatDiagnosis(dx),
      // ì˜ˆì‹œ: "M54.5 ìš”í†µ Low back pain"
    }));
  }

  // ì˜ˆì™¸ ì²˜ë¦¬: í•œê¸€ ë˜ëŠ” ì˜ë¬¸ ëˆ„ë½ ì‹œ
  formatWithFallback(diagnosisData) {
    const code = diagnosisData.code;
    const korean = diagnosisData.nameKorean || '-';
    const english = diagnosisData.nameEnglish || '-';

    return `${code} ${korean} ${english}`;
  }
}
```

**ì˜ˆì‹œ**:
```
ê¸°ì¡´: "Low back pain (M54.5, ìš”í†µ)"
ê°œì„ : "M54.5 ìš”í†µ Low back pain"

ê¸°ì¡´: "J06.9, Acute upper respiratory infection, ê¸‰ì„± ìƒê¸°ë„ ê°ì—¼"
ê°œì„ : "J06.9 ê¸‰ì„± ìƒê¸°ë„ ê°ì—¼ Acute upper respiratory infection"
```

---

### 8. ì¢…í•© ê²°ë¡  - ì˜ê²¬ ì œì‹œ, íŒë‹¨ ê¸ˆì§€

**í”¼ë“œë°±**:
- ì¢…í•© ê²°ë¡ ì€ ì˜ê²¬ ì œì‹œ
- íŒë‹¨ì€ ì ˆëŒ€ ê¸ˆì§€

**ê°œì„  ì‚¬í•­**:

#### 8.1 ê¸ˆì§€ í‘œí˜„
```javascript
const PROHIBITED_JUDGMENTS = [
  'ìŠ¹ì¸/ê±°ë¶€ ì¶”ì²œ',
  'ê³ ìœ„í—˜/ì €ìœ„í—˜ íŒì •',
  'ì‚¬ì „ì§ˆë³‘ í™•ì •',
  'ë³´í—˜ê¸ˆ ì§€ê¸‰ ê°€ëŠ¥/ë¶ˆê°€',
  'ì²­êµ¬ íƒ€ë‹¹ì„± í‰ê°€',
  'ë³´ìƒ ë²”ìœ„ ê²°ì •'
];
```

#### 8.2 í—ˆìš© í‘œí˜„
```javascript
const ALLOWED_OPINIONS = [
  'ì‹œê°„ìˆœ ì •ë¦¬',
  'ë‚ ì§œ ê´€ê³„ ëª…ì‹œ',
  'ì˜ë£Œ ê¸°ë¡ ìš”ì•½',
  'ê°ê´€ì  ì‚¬ì‹¤ ë‚˜ì—´',
  'ì •ë³´ ì œì‹œ',
  'ì°¸ê³  ì‚¬í•­ ì•ˆë‚´'
];
```

#### 8.3 ê²°ë¡  ìƒì„± í…œí”Œë¦¿
```javascript
class ConclusionGenerator {
  generateObjectiveConclusion(medicalData, insuranceInput) {
    return {
      summary: this.summarizeFacts(medicalData),
      timeline: this.createTimeline(medicalData),
      dateRelationship: this.analyzeDateRelationship(
        medicalData,
        insuranceInput
      ),
      // íŒë‹¨ ì œì™¸
      // recommendation: this.makeJudgment()  // ì‚­ì œ
    };
  }

  summarizeFacts(data) {
    return {
      totalVisits: data.visits.length,
      dateRange: {
        earliest: data.visits[0].date,
        latest: data.visits[data.visits.length - 1].date
      },
      diagnoses: data.diagnoses.map(d => this.formatDiagnosis(d)),
      procedures: data.procedures.map(p => p.name)
    };
  }

  analyzeDateRelationship(medicalData, insuranceInput) {
    const startDate = new Date(insuranceInput.startDate);

    return medicalData.visits.map(visit => {
      const visitDate = new Date(visit.date);
      const daysDiff = Math.floor(
        (visitDate - startDate) / (1000 * 60 * 60 * 24)
      );

      return {
        visitDate: visit.date,
        relationToInsurance: {
          daysFromStart: daysDiff,
          within3Months: daysDiff <= 90,
          within5Years: daysDiff <= 1825
        },
        // íŒë‹¨ ì—†ì´ ì‚¬ì‹¤ë§Œ ì œì‹œ
        note: daysDiff <= 90
          ? 'ë³´í—˜ ê°€ì… í›„ 3ê°œì›” ì´ë‚´ ë‚´ì› ê¸°ë¡'
          : 'ë³´í—˜ ê°€ì… í›„ 3ê°œì›” ì´í›„ ë‚´ì› ê¸°ë¡'
        // ì œê±°: recommendation: "ì²­êµ¬ ë¶ˆê°€" ê°™ì€ íŒë‹¨
      };
    });
  }
}
```

#### 8.4 ê²°ë¡  ì˜ˆì‹œ
```markdown
# ì¢…í•© ì •ë³´

## ì˜ë£Œ ì´ë ¥ ìš”ì•½
- ì´ ë‚´ì› íšŸìˆ˜: 15íšŒ
- ìµœì´ˆ ë‚´ì›ì¼: 2022.03.15
- ìµœê·¼ ë‚´ì›ì¼: 2023.11.20
- ì£¼ìš” ì§„ë‹¨ëª…: M54.5 ìš”í†µ Low back pain, J06.9 ê¸‰ì„± ìƒê¸°ë„ ê°ì—¼ Acute upper respiratory infection

## ë³´í—˜ ê°€ì…ì¼ ê¸°ì¤€ ë‚ ì§œ ê´€ê³„
- ë³´í—˜ ê°€ì…ì¼: 2023.01.01

### 3ê°œì›” ì´ë‚´ (2023.01.01 ~ 2023.04.01)
- 2023.01.15: ë‚´ì› (ê°€ì… í›„ 14ì¼)
- 2023.02.20: ë‚´ì› (ê°€ì… í›„ 50ì¼)
- 2023.03.10: ë‚´ì› (ê°€ì… í›„ 68ì¼)

### 5ë…„ ì´ë‚´ (2018.01.01 ~ 2023.01.01)
- 2022.03.15: ë‚´ì› (ê°€ì… ì „ 291ì¼)
- 2022.07.20: ë‚´ì› (ê°€ì… ì „ 165ì¼)
- 2022.11.05: ë‚´ì› (ê°€ì… ì „ 57ì¼)

## ì°¸ê³ ì‚¬í•­
- ë³´í—˜ ê°€ì… ì „í›„ ì§„ë‹¨ëª… ë³€í™” ì—†ìŒ
- ì§€ì†ì  ì¹˜ë£Œ ê¸°ë¡ í™•ì¸ë¨
- ëª¨ë“  ë‚ ì§œ ì •ë³´ëŠ” ì˜ë£Œ ë¬¸ì„œì—ì„œ ì¶”ì¶œëœ ê°ê´€ì  ê¸°ë¡ì„

(íŒë‹¨ì´ë‚˜ ì¶”ì²œ ë‚´ìš© ì—†ìŒ)
```

---

### 9. í•­ëª© ë¶„ë¥˜ê¸° ë“±ê³ ì„  ê°œë… ë„ì…

**í”¼ë“œë°±**:
- 3D ì§€ë„ì˜ ë´‰ìš°ë¦¬ ì°¾ê¸° ë¹„ìœ 
- í‚¤ì›Œë“œ í¬ì¸íŠ¸ë¥¼ ì°¾ìœ¼ë©´ ì£¼ë³€ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´í•´í•˜ì—¬ flow í™•ì¸
- ë“±ê³ ì„  ê°œë…: ê°€ì¤‘ì¹˜/ì—°ê´€ì„± ê¸°ì¤€ìœ¼ë¡œ ì£¼ë³€ í™•ì¥

**ê°œë… ì„¤ëª…**:
```
ì‚° ì •ìƒ (í‚¤ì›Œë“œ ì •í™• ë§¤ì¹­)          â† ê°€ì¤‘ì¹˜ 1.0
  â†“
ì¤‘í„± (ìœ ì‚¬ í‚¤ì›Œë“œ, ê·¼ì ‘ ì»¨í…ìŠ¤íŠ¸)   â† ê°€ì¤‘ì¹˜ 0.7
  â†“
ì‚°ê¸°ìŠ­ (ê´€ë ¨ ì˜ì—­, ë™ì¼ ì„¹ì…˜)       â† ê°€ì¤‘ì¹˜ 0.4
  â†“
í‰ì§€ (ë¬´ê´€í•œ ì˜ì—­)                  â† ê°€ì¤‘ì¹˜ 0.0
```

**êµ¬í˜„**:

#### 9.1 ë“±ê³ ì„  ê°€ì¤‘ì¹˜ ì‹œìŠ¤í…œ
```javascript
class ContourWeightClassifier {
  constructor() {
    // ë“±ê³ ì„  ë ˆë²¨ ì •ì˜
    this.contourLevels = {
      PEAK: { weight: 1.0, color: '#FF0000', name: 'ì •ìƒ' },      // ì •í™• ë§¤ì¹­
      HIGH: { weight: 0.8, color: '#FF8800', name: 'ê³ ì§€' },      // ê°•í•œ ì—°ê´€
      MID: { weight: 0.6, color: '#FFFF00', name: 'ì¤‘í„±' },       // ì¤‘ê°„ ì—°ê´€
      LOW: { weight: 0.4, color: '#88FF88', name: 'ê¸°ìŠ­' },       // ì•½í•œ ì—°ê´€
      PLAIN: { weight: 0.2, color: '#0088FF', name: 'í‰ì§€' }      // ë¬´ê´€
    };

    // í‚¤ì›Œë“œ ê³„ì¸µ êµ¬ì¡°
    this.keywordHierarchy = {
      'ë‚´ì›ì¼': {
        peak: ['ë‚´ì›ì¼', 'ë‚´ì›ì¼ì‹œ'],
        high: ['ë°©ë¬¸ì¼', 'ì§„ë£Œì¼', 'ì§„ì°°ì¼'],
        mid: ['ê²€ì‚¬ì¼', 'ìˆ˜ì§„ì¼', 'ì ‘ìˆ˜ì¼'],
        low: ['ì˜ˆì•½ì¼', 'ë“±ë¡ì¼']
      },
      'ì§„ë‹¨ëª…': {
        peak: ['ì§„ë‹¨ëª…', 'ì§„ë‹¨'],
        high: ['ì§ˆë³‘ëª…', 'ë³‘ëª…', 'ìƒë³‘ëª…'],
        mid: ['ì†Œê²¬', 'íŒì •'],
        low: ['ì¦ìƒ', 'ì£¼ì†Œ']
      }
    };
  }

  findKeywordPeak(ocrBlocks, category) {
    const hierarchy = this.keywordHierarchy[category];

    // 1. ì •ìƒ(Peak) ì°¾ê¸°
    const peaks = this.findBlocks(ocrBlocks, hierarchy.peak);

    if (peaks.length > 0) {
      // 2. ì •ìƒ ì£¼ë³€ ë“±ê³ ì„  ë”°ë¼ ë‚´ë ¤ê°€ê¸°
      return peaks.map(peak =>
        this.expandFromPeak(peak, ocrBlocks, hierarchy)
      );
    }

    // 3. ì •ìƒ ì—†ìœ¼ë©´ ê³ ì§€ëŒ€ë¶€í„° íƒìƒ‰
    return this.searchFromHighlands(ocrBlocks, hierarchy);
  }

  expandFromPeak(peakBlock, allBlocks, hierarchy) {
    const contours = {
      peak: [peakBlock],
      high: [],
      mid: [],
      low: [],
      plain: []
    };

    // BBox ê¸°ë°˜ ê·¼ì ‘ë„ ê³„ì‚°
    const nearbyBlocks = this.findNearbyBlocks(
      peakBlock,
      allBlocks,
      maxDistance: 100  // í”½ì…€
    );

    // ê° ë¸”ë¡ì„ ë“±ê³ ì„  ë ˆë²¨ë¡œ ë¶„ë¥˜
    nearbyBlocks.forEach(block => {
      const level = this.classifyContourLevel(
        block,
        peakBlock,
        hierarchy
      );
      contours[level].push(block);
    });

    return contours;
  }

  classifyContourLevel(block, peakBlock, hierarchy) {
    // 1. í‚¤ì›Œë“œ ë§¤ì¹­ ë ˆë²¨
    const keywordLevel = this.getKeywordLevel(block.text, hierarchy);

    // 2. ê±°ë¦¬ ê¸°ë°˜ ë ˆë²¨
    const distanceLevel = this.getDistanceLevel(block, peakBlock);

    // 3. ì»¨í…ìŠ¤íŠ¸ ì¼ì¹˜ë„
    const contextLevel = this.getContextLevel(block, peakBlock);

    // 4. ì¢…í•© ì ìˆ˜ë¡œ ë ˆë²¨ ê²°ì •
    const avgWeight = (
      keywordLevel.weight +
      distanceLevel.weight +
      contextLevel.weight
    ) / 3;

    return this.weightToLevel(avgWeight);
  }

  getKeywordLevel(text, hierarchy) {
    if (hierarchy.peak.some(kw => text.includes(kw))) {
      return this.contourLevels.PEAK;
    }
    if (hierarchy.high.some(kw => text.includes(kw))) {
      return this.contourLevels.HIGH;
    }
    if (hierarchy.mid.some(kw => text.includes(kw))) {
      return this.contourLevels.MID;
    }
    if (hierarchy.low.some(kw => text.includes(kw))) {
      return this.contourLevels.LOW;
    }
    return this.contourLevels.PLAIN;
  }

  getDistanceLevel(block, peakBlock) {
    const distance = this.calculateBBoxDistance(block.bbox, peakBlock.bbox);

    // ê±°ë¦¬ì— ë”°ë¥¸ ê°€ì¤‘ì¹˜ ê°ì†Œ (ë“±ê³ ì„ ì²˜ëŸ¼)
    if (distance < 20) return this.contourLevels.PEAK;
    if (distance < 50) return this.contourLevels.HIGH;
    if (distance < 100) return this.contourLevels.MID;
    if (distance < 200) return this.contourLevels.LOW;
    return this.contourLevels.PLAIN;
  }

  getContextLevel(block, peakBlock) {
    // ê°™ì€ ë¼ì¸/ë‹¨ë½ì— ìˆìœ¼ë©´ ë†’ì€ ê°€ì¤‘ì¹˜
    if (this.isSameLine(block, peakBlock)) {
      return this.contourLevels.HIGH;
    }
    if (this.isSameParagraph(block, peakBlock)) {
      return this.contourLevels.MID;
    }
    if (this.isSameSection(block, peakBlock)) {
      return this.contourLevels.LOW;
    }
    return this.contourLevels.PLAIN;
  }

  calculateBBoxDistance(bbox1, bbox2) {
    // ë‘ BBox ì¤‘ì‹¬ì  ê°„ ìœ í´ë¦¬ë“œ ê±°ë¦¬
    const center1 = {
      x: bbox1.Left + bbox1.Width / 2,
      y: bbox1.Top + bbox1.Height / 2
    };
    const center2 = {
      x: bbox2.Left + bbox2.Width / 2,
      y: bbox2.Top + bbox2.Height / 2
    };

    return Math.sqrt(
      Math.pow(center1.x - center2.x, 2) +
      Math.pow(center1.y - center2.y, 2)
    );
  }

  findNearbyBlocks(centerBlock, allBlocks, maxDistance) {
    return allBlocks.filter(block => {
      if (block === centerBlock) return false;

      const distance = this.calculateBBoxDistance(
        centerBlock.bbox,
        block.bbox
      );

      return distance <= maxDistance;
    });
  }
}
```

#### 9.2 Flow í™•ì¸ ì‹œìŠ¤í…œ
```javascript
class ContextFlowAnalyzer {
  analyzeFlow(contours, category) {
    // ë“±ê³ ì„  ë ˆë²¨ë³„ë¡œ ì •ë³´ ì¶”ì¶œ
    const flow = {
      anchor: this.extractFromContour(contours.peak, category),
      supporting: this.extractFromContour(contours.high, category),
      related: this.extractFromContour(contours.mid, category),
      peripheral: this.extractFromContour(contours.low, category)
    };

    // Flow ê²€ì¦: ì •ìƒ â†’ ê¸°ìŠ­ìœ¼ë¡œ ê°ˆìˆ˜ë¡ ì¼ê´€ì„± í™•ì¸
    const isConsistent = this.validateFlowConsistency(flow);

    return {
      flow,
      consistent: isConsistent,
      confidence: this.calculateFlowConfidence(flow)
    };
  }

  extractFromContour(blocks, category) {
    // ì¹´í…Œê³ ë¦¬ë³„ ì¶”ì¶œ ë¡œì§
    switch(category) {
      case 'ë‚´ì›ì¼':
        return this.extractVisitInfo(blocks);
      case 'ì§„ë‹¨ëª…':
        return this.extractDiagnosis(blocks);
      case 'ì²˜ë°©':
        return this.extractPrescription(blocks);
      default:
        return this.extractGeneric(blocks);
    }
  }

  validateFlowConsistency(flow) {
    // ì˜ˆ: ë‚´ì›ì¼ flowì—ì„œ ë‚ ì§œ ì¼ê´€ì„± í™•ì¸
    // peakì—ì„œ "2023-01-15" ë°œê²¬
    // â†’ high/midì—ì„œë„ ê°™ì€ ë‚ ì§œ ë˜ëŠ” ê´€ë ¨ ì‹œê°„ ì •ë³´ ìˆì–´ì•¼ í•¨

    const anchorDate = flow.anchor.date;
    if (!anchorDate) return false;

    const supportingMentions = flow.supporting.filter(item =>
      this.mentionsDate(item, anchorDate)
    );

    return supportingMentions.length > 0;
  }
}
```

#### 9.3 ì‹œê°í™” (ì„ íƒì‚¬í•­)
```javascript
class ContourVisualizer {
  visualizeContours(contours) {
    return {
      type: 'heatmap',
      data: contours.map(c => ({
        x: c.block.bbox.Left,
        y: c.block.bbox.Top,
        weight: c.level.weight,
        color: c.level.color,
        label: c.level.name
      })),
      // ë“±ê³ ì„  ì‹œê°í™”: ë¹¨ê°•(ì •ìƒ) â†’ íŒŒë‘(í‰ì§€)
    };
  }
}
```

**íš¨ê³¼**:
1. **ì •í™•ë„ í–¥ìƒ**: í‚¤ì›Œë“œ ì •í™• ë§¤ì¹­ ì‹¤íŒ¨í•´ë„ ì£¼ë³€ ì»¨í…ìŠ¤íŠ¸ë¡œ ë³µêµ¬
2. **ìœ ì—°ì„±**: ë¬¸ì„œ í˜•ì‹ ë³€í™”ì— ê°•ê±´í•¨
3. **ì‹ ë¢°ë„ ì •ëŸ‰í™”**: ê°€ì¤‘ì¹˜ë¡œ ì‹ ë¢°ë„ ëª…í™•íˆ í‘œí˜„
4. **ë””ë²„ê¹… ìš©ì´**: ë“±ê³ ì„  ì‹œê°í™”ë¡œ ë¶„ë¥˜ ê³¼ì • ì´í•´ ì‰¬ì›€

---

### 10. ì›ë¬¸ ë³´ì¡´ - ì ‘ê¸°/í´ê¸° ì˜µì…˜

**í”¼ë“œë°±**:
- ë³´ê³ ì„œ ì œê³µ + ì›ë¬¸ ë³´ê¸° ì˜µì…˜ ì¶”ê°€
- ì ‘ê¸°/í´ê¸° ë˜ëŠ” ì˜µì…˜ ë²„íŠ¼
- ì›ë¬¸ í˜ì´ì§€ ë„ìš°ê¸° ë“±ì˜ ì£¼ì„/ë§í¬ ì˜µì…˜

**êµ¬í˜„**:

#### 10.1 ë°ì´í„° êµ¬ì¡°
```javascript
class ReportWithSourceReference {
  constructor() {
    this.report = {
      summary: {},
      events: [],
      conclusions: []
    };

    this.sourceReferences = {
      // ê° í•­ëª©ì— ì›ë¬¸ ì°¸ì¡° ì •ë³´ ì¶”ê°€
    };
  }

  addEventWithSource(event, sourceInfo) {
    const eventId = this.generateEventId();

    // ë³´ê³ ì„œ ì´ë²¤íŠ¸ ì¶”ê°€
    this.report.events.push({
      id: eventId,
      ...event
    });

    // ì›ë¬¸ ì°¸ì¡° ì •ë³´ ì¶”ê°€
    this.sourceReferences[eventId] = {
      pdfPage: sourceInfo.page,
      pdfFile: sourceInfo.filename,
      ocrBlocks: sourceInfo.blocks,
      boundingBoxes: sourceInfo.bboxes,
      confidence: sourceInfo.confidence,
      rawText: sourceInfo.rawText
    };
  }

  getSourceReference(eventId) {
    return this.sourceReferences[eventId];
  }
}
```

#### 10.2 UI ì»´í¬ë„ŒíŠ¸ (Markdown í˜•ì‹)
```markdown
## 1. 2023.01.15: ë‚´ì›ì¼

**ë‚´ì›ê²½ìœ„**: ë‘í†µ ë° ì–´ì§€ëŸ¬ì›€ ì¦ìƒìœ¼ë¡œ ë‚´ì›

<details>
<summary>ğŸ“„ ì›ë¬¸ ë³´ê¸°</summary>

### ì›ë¬¸ ì •ë³´
- **ë¬¸ì„œ**: ì§„ë£Œê¸°ë¡ë¶€_20230115.pdf
- **í˜ì´ì§€**: 3
- **ì‹ ë¢°ë„**: 95.2%

### ì¶”ì¶œëœ ì›ë¬¸
```
2023ë…„ 01ì›” 15ì¼

ã€ ë‚´ì› ê²½ìœ„ ã€‘
í™˜ìëŠ” 3ì¼ ì „ë¶€í„° ì§€ì†ë˜ëŠ” ë‘í†µê³¼ ì–´ì§€ëŸ¬ì›€ì„ ì£¼ì†Œë¡œ ë‚´ì›í•˜ì˜€ìŒ.
íŠ¹íˆ ì•„ì¹¨ì— ì¦ìƒì´ ì‹¬í•˜ë©°, êµ¬í† ëŠ” ë™ë°˜í•˜ì§€ ì•ŠìŒ.
```

[ğŸ“ PDF í˜ì´ì§€ ë³´ê¸°](link://page=3)
[ğŸ” OCR ìƒì„¸ ë³´ê¸°](link://ocr-detail&event=evt_001)

</details>

---

**ì£¼ì†Œ**: ë‘í†µ, ì–´ì§€ëŸ¬ì›€

<details>
<summary>ğŸ“„ ì›ë¬¸ ë³´ê¸°</summary>

### ì›ë¬¸ ì •ë³´
- **ë¬¸ì„œ**: ì§„ë£Œê¸°ë¡ë¶€_20230115.pdf
- **í˜ì´ì§€**: 3
- **ì‹ ë¢°ë„**: 92.8%

### ì¶”ì¶œëœ ì›ë¬¸
```
ã€ ì£¼ì†Œ (Chief Complaint) ã€‘
- ë‘í†µ (Headache)
- ì–´ì§€ëŸ¬ì›€ (Dizziness)
```

[ğŸ“ PDF í˜ì´ì§€ ë³´ê¸°](link://page=3)

</details>

---

**ì§„ë‹¨**: M54.5 ìš”í†µ Low back pain

<details>
<summary>ğŸ“„ ì›ë¬¸ ë³´ê¸°</summary>

### ì›ë¬¸ ì •ë³´
- **ë¬¸ì„œ**: ì§„ë£Œê¸°ë¡ë¶€_20230115.pdf
- **í˜ì´ì§€**: 4
- **ì‹ ë¢°ë„**: 98.1%

### ì¶”ì¶œëœ ì›ë¬¸
```
ã€ ì§„ë‹¨ëª… ã€‘
ìƒë³‘ì½”ë“œ: M54.5
ìƒë³‘ëª…: ìš”í†µ (Low back pain)
```

[ğŸ“ PDF í˜ì´ì§€ ë³´ê¸°](link://page=4)

</details>
```

#### 10.3 HTML êµ¬í˜„ ì˜ˆì‹œ
```html
<!DOCTYPE html>
<html>
<head>
  <style>
    .event-item {
      margin: 20px 0;
      padding: 15px;
      border-left: 3px solid #4CAF50;
      background: #f9f9f9;
    }

    .source-toggle {
      margin-top: 10px;
      cursor: pointer;
      color: #2196F3;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .source-toggle:hover {
      text-decoration: underline;
    }

    .source-content {
      display: none;
      margin-top: 10px;
      padding: 10px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .source-content.expanded {
      display: block;
    }

    .confidence-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.9em;
      font-weight: bold;
    }

    .confidence-high {
      background: #4CAF50;
      color: white;
    }

    .confidence-medium {
      background: #FF9800;
      color: white;
    }

    .source-actions {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 5px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-primary {
      background: #2196F3;
      color: white;
    }

    .btn-secondary {
      background: #9E9E9E;
      color: white;
    }
  </style>
</head>
<body>
  <div class="event-item">
    <h3>1. 2023.01.15: ë‚´ì›ì¼</h3>

    <div>
      <strong>ë‚´ì›ê²½ìœ„:</strong> ë‘í†µ ë° ì–´ì§€ëŸ¬ì›€ ì¦ìƒìœ¼ë¡œ ë‚´ì›

      <div class="source-toggle" onclick="toggleSource('source-1')">
        <span class="icon">ğŸ“„</span>
        <span class="text">ì›ë¬¸ ë³´ê¸°</span>
        <span class="confidence-badge confidence-high">ì‹ ë¢°ë„ 95.2%</span>
      </div>

      <div id="source-1" class="source-content">
        <h4>ì›ë¬¸ ì •ë³´</h4>
        <ul>
          <li><strong>ë¬¸ì„œ:</strong> ì§„ë£Œê¸°ë¡ë¶€_20230115.pdf</li>
          <li><strong>í˜ì´ì§€:</strong> 3</li>
          <li><strong>ì¢Œí‘œ:</strong> x: 120, y: 450</li>
        </ul>

        <h4>ì¶”ì¶œëœ ì›ë¬¸</h4>
        <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px;">
2023ë…„ 01ì›” 15ì¼

ã€ ë‚´ì› ê²½ìœ„ ã€‘
í™˜ìëŠ” 3ì¼ ì „ë¶€í„° ì§€ì†ë˜ëŠ” ë‘í†µê³¼ ì–´ì§€ëŸ¬ì›€ì„ ì£¼ì†Œë¡œ ë‚´ì›í•˜ì˜€ìŒ.
íŠ¹íˆ ì•„ì¹¨ì— ì¦ìƒì´ ì‹¬í•˜ë©°, êµ¬í† ëŠ” ë™ë°˜í•˜ì§€ ì•ŠìŒ.
        </pre>

        <div class="source-actions">
          <button class="btn btn-primary" onclick="openPdfPage(3)">
            ğŸ“ PDF í˜ì´ì§€ ì—´ê¸°
          </button>
          <button class="btn btn-secondary" onclick="showOcrDetail('evt_001')">
            ğŸ” OCR ìƒì„¸ ë³´ê¸°
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    function toggleSource(id) {
      const element = document.getElementById(id);
      element.classList.toggle('expanded');
    }

    function openPdfPage(pageNumber) {
      // PDF ë·°ì–´ë¡œ í•´ë‹¹ í˜ì´ì§€ ì—´ê¸°
      window.open(`/pdf-viewer?page=${pageNumber}`, '_blank');
    }

    function showOcrDetail(eventId) {
      // OCR ìƒì„¸ ì •ë³´ ëª¨ë‹¬ í‘œì‹œ
      window.open(`/ocr-detail?event=${eventId}`, '_blank');
    }
  </script>
</body>
</html>
```

#### 10.4 API ì—”ë“œí¬ì¸íŠ¸
```javascript
// Express.js ë¼ìš°í„°
router.get('/api/report/:reportId/source/:eventId', async (req, res) => {
  const { reportId, eventId } = req.params;

  try {
    const sourceRef = await reportService.getSourceReference(
      reportId,
      eventId
    );

    res.json({
      success: true,
      data: {
        pdfFile: sourceRef.pdfFile,
        page: sourceRef.pdfPage,
        boundingBoxes: sourceRef.boundingBoxes,
        rawText: sourceRef.rawText,
        confidence: sourceRef.confidence,
        ocrBlocks: sourceRef.ocrBlocks
      }
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

router.get('/api/pdf/:filename/page/:pageNum', async (req, res) => {
  const { filename, pageNum } = req.params;

  // PDF í˜ì´ì§€ ì´ë¯¸ì§€ ìƒì„± ë° ë°˜í™˜
  const pageImage = await pdfService.renderPage(filename, pageNum);

  res.setHeader('Content-Type', 'image/png');
  res.send(pageImage);
});
```

**íš¨ê³¼**:
1. **ì‹ ë¢°ì„±**: ì‚¬ìš©ìê°€ ì›ë¬¸ ì§ì ‘ í™•ì¸ ê°€ëŠ¥
2. **íˆ¬ëª…ì„±**: ì¶”ì¶œ ê³¼ì • ê³µê°œ
3. **ê²€ì¦ ìš©ì´**: ì˜¤ë¥˜ ë°œê²¬ ì‹œ ë¹ ë¥¸ ìˆ˜ì •
4. **ì‚¬ìš©ì ê²½í—˜**: í•„ìš”í•  ë•Œë§Œ ì›ë¬¸ í™•ì¸ (ì ‘ê¸° ìƒíƒœê°€ ê¸°ë³¸)

---

## ğŸ“Š ê°œì„  íš¨ê³¼ ì˜ˆì¸¡

### ì •ëŸ‰ì  ëª©í‘œ

| í•­ëª© | í˜„ì¬ (Cycle 5) | ëª©í‘œ (ê°œì„  í›„) | ê°œì„ ìœ¨ |
|------|---------------|---------------|--------|
| GT Coverage (ì˜ë£Œ ë°ì´í„°) | 57% | **99.9%** | +75% |
| Precision | 24% | **95%** | +296% |
| Date Accuracy | - | **99.9%** | - |
| ì²˜ë¦¬ ì‹œê°„ (100í˜ì´ì§€) | - | **5ë¶„ ì´ë‚´** | - |
| ì‚¬ìš©ì ë§Œì¡±ë„ | - | **4.5/5.0** | - |

### ì •ì„±ì  íš¨ê³¼

1. **ì‹ ë¢°ì„± í–¥ìƒ**: 99.9% ë‚ ì§œ ì •í™•ë„ë¡œ ì˜ë£Œ ê¸°ë¡ ì‹ ë¢° ê°€ëŠ¥
2. **íš¨ìœ¨ì„± ì¦ëŒ€**: ìˆ˜ì‹­~ë°± ì¥ ë¬¸ì„œë¥¼ 5ë¶„ ë‚´ ê²€í† 
3. **ê°ê´€ì„± í™•ë³´**: íŒë‹¨ ì œê±°ë¡œ ê³µì •í•œ ì •ë³´ ì œê³µ
4. **ìœ ì—°ì„± í™•ë³´**: ë‹¤ì–‘í•œ ë¬¸ì„œ í˜•ì‹ ëŒ€ì‘
5. **íˆ¬ëª…ì„± ê°•í™”**: ì›ë¬¸ ì°¸ì¡°ë¡œ ê²€ì¦ ê°€ëŠ¥

---

## ğŸ—“ï¸ êµ¬í˜„ ë¡œë“œë§µ

### Phase 1: í•µì‹¬ ê°œì„  (2ì£¼)

**ëª©í‘œ**: ë‚ ì§œ ì •í™•ë„ ë° ë³´ê³ ì„œ í˜•ì‹ ê°œì„ 

1. **ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ì–‘ì‹ ì¸ì‹ í‚¤ì›Œë“œ í™•ì¥** (3ì¼)
   - í‚¤ì›Œë“œ ì‹œì†ŒëŸ¬ìŠ¤ êµ¬ì¶•
   - ë‚ ì§œ í˜•ì‹ ì •ê·œí™” ê°•í™”

2. **ë³´ê³ ì„œ í˜•ì‹ ê°œì„ ** (4ì¼)
   - ë‚ ì§œ ì •ë ¬ ë° ë„˜ë²„ë§
   - ì§„ë‹¨ë³‘ëª… í‘œê¸° í†µì¼
   - ë‚´ì›ì¼ì‹œ ì¤‘ë³µ ì œê±°

3. **ë³´í—˜ ì‹¬ì‚¬ ì—­í•  ë°°ì œ** (2ì¼)
   - íŒë‹¨ ë¡œì§ ì œê±°
   - ê°ê´€ì  ê²°ë¡  í…œí”Œë¦¿ ì ìš©

4. **DNA ë¶„ì„ ì œì™¸** (1ì¼)
   - DNA ê´€ë ¨ ì¹´í…Œê³ ë¦¬ ë¹„í™œì„±í™”

**ì™„ë£Œ ê¸°ì¤€**:
- ë‚ ì§œ ì •í™•ë„ 90% ì´ìƒ
- ë³´ê³ ì„œ í˜•ì‹ 100% ì ìš©
- íŒë‹¨ ë¬¸êµ¬ 0ê±´

---

### Phase 2: ê³ ê¸‰ ê¸°ëŠ¥ (4ì£¼)

**ëª©í‘œ**: ë“±ê³ ì„  ê°œë… ë° OCR ìµœì í™”

1. **í•­ëª© ë¶„ë¥˜ê¸° ë“±ê³ ì„  ì‹œìŠ¤í…œ** (2ì£¼)
   - ContourWeightClassifier êµ¬í˜„
   - ContextFlowAnalyzer êµ¬í˜„
   - ê°€ì¤‘ì¹˜ íŠœë‹

2. **GT Coverage ì¬í‰ê°€ ì‹œìŠ¤í…œ** (1ì£¼)
   - ë³´í—˜ ì •ë³´ ì œì™¸ ë¡œì§
   - 3ê°œì›”/5ë…„ í•„í„°ë§
   - ì¬í‰ê°€ ë©”íŠ¸ë¦­

3. **Cycle 5 ë¡œì§ í¡ìˆ˜** (1ì£¼)
   - 7-Phase íŒŒì´í”„ë¼ì¸ OCR ì ì‘
   - Type-Based Scoring + OCR ì‹ ë¢°ë„
   - Noise Reduction í†µí•©

**ì™„ë£Œ ê¸°ì¤€**:
- GT Coverage 95% ì´ìƒ (ì˜ë£Œ ë°ì´í„°)
- ë“±ê³ ì„  ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™
- Cycle 5 ê¸ì • ìš”ì†Œ 100% í¡ìˆ˜

---

### Phase 3: ì‚¬ìš©ì ê²½í—˜ (2ì£¼)

**ëª©í‘œ**: ì›ë¬¸ ì°¸ì¡° ë° ìµœì¢… ë§ˆë¬´ë¦¬

1. **ì›ë¬¸ ë³´ê¸° ê¸°ëŠ¥** (1ì£¼)
   - ì ‘ê¸°/í´ê¸° UI êµ¬í˜„
   - PDF í˜ì´ì§€ ë§í¬
   - OCR ìƒì„¸ ë³´ê¸°

2. **ì¢…í•© í…ŒìŠ¤íŠ¸ ë° íŠœë‹** (1ì£¼)
   - ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸
   - ì„±ëŠ¥ ìµœì í™”
   - ì‚¬ìš©ì í”¼ë“œë°± ë°˜ì˜

**ì™„ë£Œ ê¸°ì¤€**:
- ì›ë¬¸ ì°¸ì¡° ê¸°ëŠ¥ 100% ì‘ë™
- ì „ì²´ ëª©í‘œ ë‹¬ì„± (99.9% ë‚ ì§œ ì •í™•ë„)
- ì‚¬ìš©ì ë§Œì¡±ë„ 4.5/5.0 ì´ìƒ

---

## ğŸ“ ì‚°ì¶œë¬¼

### ë¬¸ì„œ
1. `feedback-driven-improvement-plan.md` (ë³¸ ë¬¸ì„œ)
2. `contour-weight-system-design.md` - ë“±ê³ ì„  ì‹œìŠ¤í…œ ìƒì„¸ ì„¤ê³„
3. `date-accuracy-evaluation-report.md` - ë‚ ì§œ ì •í™•ë„ í‰ê°€ ë³´ê³ ì„œ
4. `api-documentation.md` - API ë¬¸ì„œ ì—…ë°ì´íŠ¸

### ì½”ë“œ
1. `KeywordThesaurus.js` - í‚¤ì›Œë“œ ì‹œì†ŒëŸ¬ìŠ¤
2. `DateReportFormatter.js` - ë‚ ì§œ ë³´ê³ ì„œ í¬ë§·í„°
3. `DiagnosisFormatter.js` - ì§„ë‹¨ë³‘ëª… í¬ë§·í„°
4. `ConclusionGenerator.js` - ê°ê´€ì  ê²°ë¡  ìƒì„±ê¸°
5. `ContourWeightClassifier.js` - ë“±ê³ ì„  ê°€ì¤‘ì¹˜ ë¶„ë¥˜ê¸°
6. `ContextFlowAnalyzer.js` - ì»¨í…ìŠ¤íŠ¸ íë¦„ ë¶„ì„ê¸°
7. `MedicalGTCoverageEvaluator.js` - GT Coverage ì¬í‰ê°€ê¸°
8. `ReportWithSourceReference.js` - ì›ë¬¸ ì°¸ì¡° ë³´ê³ ì„œ
9. `InsuranceInputHandler.js` - ë³´í—˜ ì…ë ¥ ì²˜ë¦¬ê¸°

### í…ŒìŠ¤íŠ¸
1. `keyword-expansion.test.js` - í‚¤ì›Œë“œ í™•ì¥ í…ŒìŠ¤íŠ¸
2. `date-formatting.test.js` - ë‚ ì§œ í¬ë§· í…ŒìŠ¤íŠ¸
3. `contour-classifier.test.js` - ë“±ê³ ì„  ë¶„ë¥˜ê¸° í…ŒìŠ¤íŠ¸
4. `gt-coverage.test.js` - GT Coverage í…ŒìŠ¤íŠ¸
5. `source-reference.test.js` - ì›ë¬¸ ì°¸ì¡° í…ŒìŠ¤íŠ¸

---

## âœ… ê²€ì¦ ê¸°ì¤€

### ìë™ ê²€ì¦
```javascript
class FeedbackImprovementValidator {
  validate(system) {
    const results = {
      feedback1: this.validateKeywordExpansion(system),
      feedback2: this.validateNoJudgment(system),
      feedback3: this.validateCycle5Absorption(system),
      feedback4: this.validateGTCoverage(system),
      feedback5: this.validateNoDNA(system),
      feedback6: this.validateDateFormat(system),
      feedback7: this.validateDiagnosisFormat(system),
      feedback8: this.validateObjectiveConclusion(system),
      feedback9: this.validateContourSystem(system),
      feedback10: this.validateSourceReference(system)
    };

    const passCount = Object.values(results).filter(r => r.passed).length;
    const totalCount = Object.keys(results).length;

    return {
      passed: passCount === totalCount,
      score: (passCount / totalCount) * 100,
      details: results
    };
  }

  validateKeywordExpansion(system) {
    const testCases = [
      { input: 'ì§„ë£Œì¼', expected: ['ì§„ë£Œì¼', 'ë‚´ì›ì¼', 'ë°©ë¬¸ì¼'] },
      { input: '2023-01-15', expected: ['2023.01.15', '2023/01/15'] }
    ];

    const results = testCases.map(tc =>
      system.expandKeyword(tc.input).length >= tc.expected.length
    );

    return {
      passed: results.every(r => r),
      details: 'Keyword expansion working correctly'
    };
  }

  validateNoJudgment(system) {
    const prohibitedTerms = [
      'ìŠ¹ì¸', 'ê±°ë¶€', 'ì¶”ì²œ', 'íŒì •', 'í™•ì •', 'ë¶ˆê°€', 'íƒ€ë‹¹'
    ];

    const conclusion = system.generateConclusion();
    const hasProhibited = prohibitedTerms.some(term =>
      conclusion.includes(term)
    );

    return {
      passed: !hasProhibited,
      details: hasProhibited
        ? `Found prohibited judgment terms`
        : 'No judgment terms found'
    };
  }

  validateGTCoverage(system) {
    const coverage = system.evaluateGTCoverage();

    return {
      passed: coverage.medicalOnly && coverage.value >= 99.0,
      details: `GT Coverage: ${coverage.value}% (Medical data only: ${coverage.medicalOnly})`
    };
  }

  validateContourSystem(system) {
    const testBlock = { text: 'ì§„ë£Œì¼', bbox: { Left: 0, Top: 0 } };
    const contours = system.findContours(testBlock);

    return {
      passed: contours.peak.length > 0 && contours.high.length >= 0,
      details: `Contour levels: ${Object.keys(contours).length}`
    };
  }

  validateSourceReference(system) {
    const report = system.generateReport();
    const hasSourceRefs = report.events.every(event =>
      event.sourceReference !== undefined
    );

    return {
      passed: hasSourceRefs,
      details: `All events have source references: ${hasSourceRefs}`
    };
  }
}
```

---

## ğŸ¯ ì„±ê³µ ì§€í‘œ

### í•„ìˆ˜ ë‹¬ì„± (Must Have)
- âœ… ë‚ ì§œ ì •í™•ë„ 99.9% ì´ìƒ
- âœ… ë³´í—˜ ì‹¬ì‚¬ íŒë‹¨ ë¬¸êµ¬ 0ê±´
- âœ… GT Coverage 99% ì´ìƒ (ì˜ë£Œ ë°ì´í„°ë§Œ)
- âœ… DNA ë¶„ì„ í•­ëª© ì œì™¸
- âœ… ë‚ ì§œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
- âœ… ì§„ë‹¨ë³‘ëª… í‘œê¸° í˜•ì‹ í†µì¼
- âœ… ì›ë¬¸ ì°¸ì¡° ê¸°ëŠ¥ ì œê³µ

### ê¶Œì¥ ë‹¬ì„± (Should Have)
- âœ… ë“±ê³ ì„  ê°€ì¤‘ì¹˜ ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™
- âœ… Cycle 5 ê¸ì • ìš”ì†Œ 80% ì´ìƒ í¡ìˆ˜
- âœ… ì²˜ë¦¬ ì‹œê°„ 5ë¶„ ì´ë‚´
- âœ… ì‚¬ìš©ì ë§Œì¡±ë„ 4.0/5.0 ì´ìƒ

### ì„ íƒ ë‹¬ì„± (Nice to Have)
- âœ… ë“±ê³ ì„  ì‹œê°í™”
- âœ… ì‹¤ì‹œê°„ ì‹ ë¢°ë„ í‘œì‹œ
- âœ… ë‹¤êµ­ì–´ ì§€ì› (ì˜ë¬¸ ë³´ê³ ì„œ)

---

## ğŸ”„ ì§€ì†ì  ê°œì„ 

### í”¼ë“œë°± ìˆ˜ì§‘
1. **ì‚¬ìš©ì ì¸í„°ë·°**: ì›” 1íšŒ
2. **ì‚¬ìš© ë¡œê·¸ ë¶„ì„**: ì£¼ 1íšŒ
3. **ì˜¤ë¥˜ ë¦¬í¬íŠ¸**: ì‹¤ì‹œê°„ ìˆ˜ì§‘

### ê°œì„  ì‚¬ì´í´
1. **í”¼ë“œë°± ìˆ˜ì§‘** â†’ **ë¶„ì„** â†’ **ìš°ì„ ìˆœìœ„** â†’ **êµ¬í˜„** â†’ **ë°°í¬** â†’ **ê²€ì¦**
2. ì£¼ê¸°: 2ì£¼ ìŠ¤í”„ë¦°íŠ¸

### ë©”íŠ¸ë¦­ ëª¨ë‹ˆí„°ë§
- ë‚ ì§œ ì •í™•ë„: ì¼ì¼ ì¸¡ì •
- GT Coverage: ì£¼ê°„ ì¸¡ì •
- ì‚¬ìš©ì ë§Œì¡±ë„: ì›”ê°„ ì¸¡ì •
- ì²˜ë¦¬ ì‹œê°„: ì‹¤ì‹œê°„ ì¸¡ì •

---

## ğŸ“ ì—°ë½ì²˜ ë° ì°¸ê³ ìë£Œ

### ê´€ë ¨ ë¬¸ì„œ
- [Cycle 5 Summary](../backend/eval/output/cycle5_postprocessing/CYCLE5_SUMMARY.md)
- [OCR í¬ë§· ë§¤í•‘ ê³„íš](../.trae/documents/offline_ocr%20í¬ë§·%20ì •ë°€%20ë§¤í•‘Â·ì¬ê²€ì¦%20v1.5%20ê³„íš.md)
- [Date Classification Analysis](../date-classification-analysis-report.md)

### ì°¸ê³  ì½”ë“œ
- Cycle 5 íŒŒì´í”„ë¼ì¸: `backend/eval/cycle5PostProcessing.js`
- OCR ë¡œë”: `backend/services/offline_ocr/loader.js`
- ë³´ê³ ì„œ ìƒì„±ê¸°: `backend/services/report/generator.js`

---

**ë‹¤ìŒ ë‹¨ê³„**: Phase 1 êµ¬í˜„ ì°©ìˆ˜

*ì‘ì„±: 2026-01-31*
*ë²„ì „: 1.0*
*ìƒíƒœ: ì¤€ë¹„ ì™„ë£Œ*
