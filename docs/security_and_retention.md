# VNEXSUS 보안 및 저장정책 문서

## Phase 5: Hardening (운영성/감사성)

**문서 버전**: 1.0.0
**최종 업데이트**: 2026-02-07
**담당**: VNEXSUS 개발팀

---

## 📋 목차

1. [개요](#개요)
2. [개인정보 보호 정책](#개인정보-보호-정책)
3. [데이터 마스킹 규칙](#데이터-마스킹-규칙)
4. [데이터 저장 정책](#데이터-저장-정책)
5. [데이터 보관 및 파기](#데이터-보관-및-파기)
6. [로깅 및 감사](#로깅-및-감사)
7. [운영 가이드](#운영-가이드)
8. [규정 준수](#규정-준수)

---

## 개요

### 목적

VNEXSUS 시스템은 의료 및 보험 문서를 처리하는 시스템으로, 개인정보 보호법 및 의료법에 따라 민감한 개인정보(PII, Personal Identifiable Information)를 안전하게 처리해야 합니다.

본 문서는 다음을 정의합니다:

- 개인정보 마스킹 규칙 및 방법
- 데이터 저장, 보관, 파기 정책
- 로그 및 감사 기록 관리 방안
- 운영 단계에서의 보안 가이드라인

### 적용 범위

- VNEXSUS 시스템의 모든 모듈 (OCR, 후처리, 보고서 생성 등)
- 시스템이 처리하는 모든 의료/보험 문서
- 시스템 로그 및 디버그 출력

---

## 개인정보 보호 정책

### 처리하는 개인정보 유형

VNEXSUS 시스템이 처리하는 개인정보는 다음과 같습니다:

#### 1. 고유 식별 정보
- **주민등록번호**: \`YYMMDD-NNNNNNN\` 형식
- **외국인등록번호**: 해당 시
- **운전면허번호**: 해당 시

#### 2. 연락처 정보
- **전화번호**: 휴대폰, 일반전화
- **이메일 주소**
- **주소**: 도로명/지번 주소

#### 3. 의료 정보 (민감정보)
- **환자명**
- **병원 방문 기록**
- **진단명 및 ICD/KCD 코드**
- **처방 및 치료 내역**

### 보호 원칙

1. **최소 수집 원칙**: 필요 최소한의 개인정보만 수집
2. **목적 제한 원칙**: 수집 목적 범위 내에서만 사용
3. **보안 조치**: 암호화, 마스킹, 접근 제어
4. **투명성**: 개인정보 처리 내역 기록 및 추적 가능

---

## 데이터 마스킹 규칙

### 마스킹 대상

개인정보 마스킹은 다음 상황에서 적용됩니다:

1. **로그 출력**: 디버깅 및 오류 로그
2. **보고서 미리보기**: 웹 UI에서 보고서 미리보기 표시
3. **API 응답**: 외부 시스템 연동 시
4. **개발/테스트 환경**: 실제 데이터 사용 시

### 마스킹 패턴

#### 1. 주민등록번호
\`\`\`
입력: 900101-1234567
출력: 900101-*******
\`\`\`

#### 2. 전화번호
\`\`\`
입력: 010-1234-5678
출력: 010-****-5678
\`\`\`

#### 3. 이메일
\`\`\`
입력: user@example.com
출력: us***@example.com
\`\`\`

#### 4. 이름 (한글)
\`\`\`
2글자: 김철 → 김*
3글자: 김철수 → 김*수
4글자 이상: 김철수영 → 김**영
\`\`\`

### 사용 방법

\`\`\`javascript
import piiMasker from './backend/postprocess/piiMasker.js';

// 텍스트 마스킹
const maskedText = piiMasker.maskAll(originalText);

// 환자 정보 객체 마스킹
const maskedPatientInfo = piiMasker.maskPatientInfo(patientInfo, {
  maskName: true,
  maskSSN: true,
  maskPhone: true,
  maskEmail: true
});
\`\`\`

---

## 데이터 저장 정책

### 저장 데이터 분류

#### 1. 원본 문서 (PDF, 이미지)
- **저장 위치**: \`backend/uploads/\`
- **보존 기간**: 처리 완료 후 7일
- **접근 제어**: 서버 프로세스만 접근 가능

#### 2. OCR 결과 (텍스트)
- **저장 위치**: \`backend/cache/ocr/\`
- **보존 기간**: 30일
- **접근 제어**: 서버 프로세스만 접근 가능

#### 3. 분석 결과 (JSON, TXT)
- **저장 위치**: \`backend/temp/reports/\`
- **보존 기간**: 90일
- **마스킹**: 옵션 (고객사 요구에 따라)
- **접근 제어**: 인증된 사용자만 다운로드 가능

#### 4. 시스템 로그
- **저장 위치**: \`backend/logs/\`
- **보존 기간**: 180일
- **마스킹**: **필수** (개인정보 포함 금지)
- **접근 제어**: 관리자만 접근 가능

---

## 데이터 보관 및 파기

### 자동 파기 스케줄

파일 기반 파기 스크립트 예시:

\`\`\`bash
#!/bin/bash
# VNEXSUS 자동 파일 정리

# 7일 이상 된 원본 문서 삭제
find backend/uploads -type f -mtime +7 -delete

# 30일 이상 된 OCR 결과 삭제
find backend/cache/ocr -type f -mtime +30 -delete

# 90일 이상 된 보고서 삭제
find backend/temp/reports -type f -mtime +90 -delete

# 180일 이상 된 로그 삭제
find backend/logs -type f -mtime +180 -delete
\`\`\`

---

## 로깅 및 감사

### 로그 출력 규칙

#### ✅ 허용되는 로그

\`\`\`javascript
// 이벤트 ID만 기록
logger.info('이벤트 처리 완료', { eventId: 'evt_12345' });

// 마스킹된 정보
logger.debug('환자 정보 로드', { patientName: piiMasker.maskName(name) });
\`\`\`

#### ❌ 금지되는 로그

\`\`\`javascript
// 원문 전체 출력
logger.debug('OCR 결과:', fullText); // ❌ 금지

// 마스킹되지 않은 개인정보
logger.info('환자 처리:', patientInfo); // ❌ 금지
\`\`\`

---

## 운영 가이드

### 운영 환경 체크리스트

배포 전 확인사항:

- [ ] \`ENABLE_PII_MASKING=true\` 설정 확인
- [ ] 로그 레벨 \`LOG_LEVEL=warn\` 설정
- [ ] 파일 시스템 권한 확인
- [ ] 자동 파기 cron 작업 등록
- [ ] HTTPS 적용
- [ ] 방화벽 규칙 확인

---

## 규정 준수

### 준수 법령

1. **개인정보 보호법**: 개인정보의 수집, 이용, 제공, 파기
2. **의료법**: 의료 정보 보호
3. **생명윤리법**: 민감정보 처리

### 규정 준수 확인

| 항목 | 준수 여부 | 비고 |
|------|-----------|------|
| 개인정보 암호화 | ✅ 준수 | 파일 시스템 암호화 |
| 접근 제어 | ✅ 준수 | 서버 프로세스만 접근 |
| 로그 마스킹 | ✅ 준수 | piiMasker 적용 |
| 데이터 파기 | ✅ 준수 | 자동 파기 스케줄 |
| 감사 로그 | ✅ 준수 | 모든 중요 작업 기록 |

---

**문서 버전 히스토리**

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 1.0.0 | 2026-02-07 | VNEXSUS 팀 | Phase 5 초안 작성 |
