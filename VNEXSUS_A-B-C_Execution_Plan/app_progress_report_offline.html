<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>개선·개발공정 공정율 리포트(오프라인)</title>
  <style>
    :root {
      --bg: #0f172a; --panel: #111827; --card: #0b1220; --text: #e5e7eb; --muted: #94a3b8; --accent: #60a5fa;
      --ok: #22c55e; --warn: #f59e0b; --bad: #ef4444; --border: #1f2937;
    }
    html, body { height: 100%; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif; background: radial-gradient(1200px 800px at 10% 0%, #0a0f1d 0%, #0f172a 40%, #0b1220 100%); color: var(--text); }
    .container { max-width: 1200px; margin: 36px auto; padding: 0 20px; }
    .header { position: sticky; top: 0; z-index: 10; background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%); border: 1px solid var(--border); border-radius: 14px; padding: 18px; backdrop-filter: blur(6px); }
    .row { display: grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 960px){ .row { grid-template-columns: 1fr 1fr; } }
    h1 { margin: 0 0 8px; font-size: 22px; letter-spacing: 0.2px; }
    h2 { margin: 0 0 10px; font-size: 18px; color: var(--accent); }
    h3 { margin: 12px 0 8px; font-size: 16px; color: #cbd5e1; }
    p, li, small { color: var(--text); }
    .meta { display: flex; gap: 10px; flex-wrap: wrap; font-size: 12px; color: var(--muted); }
    .panel { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border: 1px solid var(--border); border-radius: 14px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.03); }
    .kpi { display: grid; grid-template-columns: repeat(4,1fr); gap: 10px; margin-top: 8px; }
    .kpi .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 12px; text-align: center; }
    .kpi .label { font-size: 12px; color: var(--muted); }
    .kpi .value { margin-top: 6px; font-size: 18px; font-weight: 700; }
    .value.ok { color: var(--ok); } .value.warn { color: var(--warn); } .value.bad { color: var(--bad); }
    .progress { width: 100%; height: 10px; background: rgba(148,163,184,0.18); border-radius: 6px; overflow: hidden; margin: 8px 0; }
    .fill { height: 100%; background: linear-gradient(90deg, #60a5fa, #22c55e); transition: width .3s ease; }
    .badge { display: inline-block; padding: 5px 10px; border-radius: 999px; font-size: 12px; font-weight: 700; border: 1px solid var(--border); }
    .status-in_progress { background: rgba(96,165,250,0.15); color: #93c5fd; }
    .status-pending { background: rgba(245,158,11,0.15); color: #fbbf24; }
    .status-blocked { background: rgba(239,68,68,0.15); color: #fca5a5; }
    .status-not_applied { background: rgba(148,163,184,0.15); color: #cbd5e1; }
    .status-completed { background: rgba(34,197,94,0.15); color: #86efac; }
    .group-card { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border: 1px solid var(--border); border-radius: 14px; padding: 16px; }
    .task { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; padding: 10px; border: 1px solid var(--border); border-radius: 10px; background: rgba(11,18,32,0.5); }
    .task + .task { margin-top: 10px; }
    .task-title { font-weight: 700; }
    .reason { font-size: 12px; color: var(--muted); }
    .section { margin-top: 18px; }
    .footer { margin-top: 24px; color: var(--muted); font-size: 12px; text-align: right; }
    a { color: #93c5fd; text-decoration: none; } a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="container">
    <section class="header">
      <h1>개선·개발공정 공정율 리포트</h1>
      <div class="meta">
        <span id="generatedAt"></span>
        <span>문서 모드: 오프라인</span>
      </div>
      <div class="section">
        <h2>목적</h2>
        <p>본 문서는 개선·개발공정의 목적과 전체 공정율을 상단에 고정해 제공하고, 이하 섹션에서 공정들을 task별로 묶어 정리합니다. 진행 중 항목은 상단에 우선 배치하며, 각 항목의 원인과 이유를 함께 표기해 의사결정과 우선순위 정렬에 활용합니다. 미반영 목록은 별도 섹션으로 분리하고, 완료 목록은 하단에 배치합니다.</p>
      </div>
      <div class="section">
        <h2>전체 공정율</h2>
        <div class="progress"><div id="overallFill" class="fill" style="width:0%"></div></div>
        <div id="overallPct" class="badge status-in_progress">0%</div>
        <div class="kpi">
          <div class="card"><div class="label">진행 중</div><div id="kpiInProgress" class="value ok">0</div></div>
          <div class="card"><div class="label">대기</div><div id="kpiPending" class="value warn">0</div></div>
          <div class="card"><div class="label">미반영</div><div id="kpiNotApplied" class="value">0</div></div>
          <div class="card"><div class="label">완료</div><div id="kpiCompleted" class="value ok">0</div></div>
        </div>
      </div>
    </section>

    <section class="panel section">
      <h2>공정 그룹(진행 우선 정렬)</h2>
      <div id="groups" class="row"></div>
    </section>

    <section class="panel section">
      <h2>미반영 목록</h2>
      <div id="notApplied"></div>
    </section>

    <section class="panel section">
      <h2>완료 목록</h2>
      <div id="completed"></div>
    </section>

    <div class="footer">오프라인 리포트 · 수동 편집 가능</div>
  </div>

  <script>
    const data = {
      groups: [
        {
          name: "파이프라인 안정화·검증",
          tasks: [
            { title: "룰 기반 전처리 통합", status: "in_progress", progress: 65, cause: "모듈간 의존성 조정 필요", reason: "전처리 결과 표준화·병합 로직 개선 중" },
            { title: "NaN/유효성 전역 가드 강화", status: "pending", progress: 40, cause: "입력 포맷 불안정", reason: "스키마 검증·가드 추가 작업 대기" },
            { title: "결과 형식 100% 표준화", status: "in_progress", progress: 55, cause: "리포트 포맷 불일치", reason: "CSV·HTML 스키마 동기화 진행 중" },
            { title: "Zod 계약 스키마 도입", status: "not_applied", progress: 0, cause: "우선순위 하향", reason: "단기 검증은 룰 기반으로 처리" }
          ]
        },
        {
          name: "좌표→의료 이벤트 추출",
          tasks: [
            { title: "좌표→DateBinder 통합", status: "in_progress", progress: 50, cause: "OCR 좌표 품질 변동", reason: "앵커·매칭 파라미터 튜닝 중" },
            { title: "키워드 매칭 강화", status: "pending", progress: 30, cause: "도메인 용어 다양성", reason: "사전 업데이트·룰 보강 예정" },
            { title: "의료 용어 DB 확장", status: "not_applied", progress: 0, cause: "비용·리소스 고려", reason: "외부 도메인 리뷰 완료 후 진행" }
          ]
        },
        {
          name: "보고서·모니터링",
          tasks: [
            { title: "공정율 템플릿 딥블루 복구", status: "completed", progress: 100, cause: "롤백 필요", reason: "디자인·필드 복원 완료" },
            { title: "Static Reports Server 구성", status: "completed", progress: 100, cause: "표시 오류 대응", reason: "5500 포트 정적 라우팅 적용" },
            { title: "종합 케이스 리포트 자동 갱신", status: "pending", progress: 40, cause: "출력 경로 상이", reason: "temp/reports vs reports 동기화" }
          ]
        },
        {
          name: "성능·비용",
          tasks: [
            { title: "배치 검증 자동화", status: "in_progress", progress: 60, cause: "표본 부족", reason: "파이프라인 안정화 선행 필요" },
            { title: "서킷브레이커·재시도", status: "not_applied", progress: 0, cause: "호출 비용·설계 검토", reason: "하위 단계 준비 이후 적용" }
          ]
        }
      ]
    };

    const now = new Date();
    const z = n => String(n).padStart(2,'0');
    document.getElementById('generatedAt').textContent = `${now.getFullYear()}-${z(now.getMonth()+1)}-${z(now.getDate())} ${z(now.getHours())}:${z(now.getMinutes())}`;

    const allTasks = data.groups.flatMap(g => g.tasks);
    const overall = Math.round(allTasks.reduce((a,t)=>a+t.progress,0)/allTasks.length);
    document.getElementById('overallFill').style.width = `${overall}%`;
    document.getElementById('overallPct').textContent = `${overall}%`;

    const cnt = s => allTasks.filter(t=>t.status===s).length;
    document.getElementById('kpiInProgress').textContent = cnt('in_progress');
    document.getElementById('kpiPending').textContent = cnt('pending');
    document.getElementById('kpiNotApplied').textContent = cnt('not_applied');
    document.getElementById('kpiCompleted').textContent = cnt('completed');

    const statusOrder = { in_progress: 5, pending: 4, blocked: 3, not_applied: 2, completed: 1 };
    const groupScore = g => {
      const s = g.tasks.reduce((acc,t)=>acc+statusOrder[t.status],0);
      const hasCompleted = g.tasks.every(t=>t.status==='completed');
      return hasCompleted ? -999 : s;
    };
    const orderedGroups = [...data.groups].sort((a,b)=>groupScore(b)-groupScore(a));

    const groupsEl = document.getElementById('groups');
    orderedGroups.forEach(g => {
      const gp = Math.round(g.tasks.reduce((a,t)=>a+t.progress,0)/g.tasks.length);
      const card = document.createElement('div');
      card.className = 'group-card';
      const title = document.createElement('div');
      title.innerHTML = `<h3>${g.name}</h3><div class="progress"><div class="fill" style="width:${gp}%"></div></div><div class="badge">${gp}%</div>`;
      card.appendChild(title);
      const list = document.createElement('div');
      g.tasks.sort((a,b)=>statusOrder[b.status]-statusOrder[a.status] || b.progress - a.progress).forEach(t => {
        const item = document.createElement('div');
        item.className = 'task';
        const left = document.createElement('div');
        left.innerHTML = `<div class="task-title">${t.title}</div><div class="progress"><div class="fill" style="width:${t.progress}%"></div></div><div class="reason">원인: ${t.cause}</div><div class="reason">이유: ${t.reason}</div>`;
        const right = document.createElement('div');
        right.innerHTML = `<span class="badge status-${t.status}">${t.status.replace('_',' ')}</span>`;
        item.appendChild(left);
        item.appendChild(right);
        list.appendChild(item);
      });
      card.appendChild(list);
      groupsEl.appendChild(card);
    });

    const renderList = (elId, tasks) => {
      const wrap = document.getElementById(elId);
      if (!tasks.length) { wrap.innerHTML = `<div class="reason">항목 없음</div>`; return; }
      const frag = document.createElement('div');
      tasks.forEach(t => {
        const item = document.createElement('div');
        item.className = 'task';
        item.innerHTML = `<div><div class="task-title">${t.title}</div><div class="progress"><div class="fill" style="width:${t.progress}%"></div></div><div class="reason">원인: ${t.cause}</div><div class="reason">이유: ${t.reason}</div></div><div><span class="badge status-${t.status}">${t.status.replace('_',' ')}</span></div>`;
        frag.appendChild(item);
      });
      wrap.appendChild(frag);
    };

    const notAppliedTasks = allTasks.filter(t=>t.status==='not_applied');
    const completedTasks = allTasks.filter(t=>t.status==='completed');
    renderList('notApplied', notAppliedTasks);
    renderList('completed', completedTasks);
  </script>
</body>
</html>
