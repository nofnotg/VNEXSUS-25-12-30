# VNEXSUS PRD (A/B/C 품질 목표 기준)

## 1. 제품 비전

비정형 의료문서를 기반으로 보험조사/손해사정에 필요한 **시계열 의료 이벤트 타임라인**과
**고지·심사 관점의 핵심 이벤트 집합**을 자동 산출하여,
조사자의 분석 시간을 단축하고 누락/실수 리스크를 줄이는 도구.

### 현재 버전(11-23)의 위치

- OCR → 텍스트 분해 → 날짜/병원/진단 인식 → DNA 시퀀싱(이벤트/인과관계) 엔진까지 구현 완료
- Phase 기반 검증(Phase1~4) 및 HTML 리포트 구조 존재
- 다만,
  - 사람 report와의 정량적 일치도(recall/precision)는 아직 낮음
  - report ⊆ vnexsus 구조를 보장하는 검증 루프는 부재
  - 고지·심사 질문 맵 & 룰 엔진은 설계 수준에 머묾

## 2. 품질 목표 정의 (A/B/C)

### A. report 이벤트 recall

- 정의: `case_sample` 기준, 사람이 작성한 report에 등장하는 의료 이벤트(날짜+병원+진단/코드)가
  VNEXSUS event table에 포함되는 비율(recall).
- 목표:
  - 단기: 70% 이상
  - 중기: 85% 이상
- 제약:
  - precision(과잉 포함)은 일단 2순위. 우선은 누락 최소화가 목표.

### B. 고위험 이벤트 recall (Critical Risk Recall)

- 타겟 집합(초기 v1):
  - 가입 전 5년 내 **입원/수술**
  - 가입 전 5년 내 **종양/암 코드(C*, D0*, 일부 D1*) 관련 진단/검사**
  - 가입 전 5년 내 **심혈관(I20~I25) + CAG/스텐트/PCI**
  - 가입 전 5년 내 **뇌혈관(I60~I69) + CT/MRI**
  - 가입 전 3개월 내 **어떤 계통이든 CT/MRI/조직검사 등 중대검사**
- 목표:
  - 이 집합에 속하는 이벤트의 recall 95%+
- 전략:
  - 점수함수와 무관하게, 위 조건에 해당하는 이벤트는 **항상 Core 레이어에 포함**하는 룰 도입.

### C. 복붙 가능한 보고서 품질

- 정의:
  - VNEXSUS 결과를 조사자가 받아서,
    - 섹션 구조를 크게 바꾸지 않고,
    - 문장 일부/몇 줄만 수정/삭제/추가하면
    - 실제 실무 report로 제출 가능한 수준.
- 정성적 지표:
  - “평균 수정 시간 5분 이내”를 목표로 가정.
- 정량적 측정(후기 단계):
  - 일부 케이스에 대해 조사자가 평가한 C-등급 이상 비율.

## 3. 주요 기능 요구사항

1. **단일 이벤트 테이블(SSOT)**
   - 모든 출력(텍스트/엑셀/요약/질문맵)은 `MedicalEvent[]`에서만 생성
   - LLM/후처리가 원문에서 새로운 이벤트를 생성하지 못하도록 구조적으로 제약

2. **report ⊆ vnexsus Teacher & Validator**
   - `case_sample` 케이스를 활용하여
     - 이벤트 레벨 라벨링(label=report에 포함 여부)
     - A/B 지표 계산 및 점수함수/룰 튜닝
   - 자동 검증기(report 이벤트 누락 탐지)를 구축하여,
     - 코드 변경 시마다 A/B를 재측정.

3. **고위험 절대규칙 레이어**
   - B에 해당하는 고위험 패턴에 대해
     - 별도 룰 집합을 정의하고
     - Core 이벤트에서 절대 빠지지 않도록 보장.

4. **조사자 시각 점수함수**
   - 이벤트별 점수 =
     - severity(수술/입원/중대검사/응급/외래)
     + 기간 가중치(가입 전 3M/5Y 여부)
     + organSystem/청구병명 관련도
     + 반복/빈도
   - 상위 Top-K 이벤트는 기본 Core 후보로 선정.

5. **고지·심사 Question Map & 룰 엔진**
   - 보험사 질문지 구조를 질문 ID 집합으로 정의
   - 각 이벤트에 적중한 질문 ID와 룰 정보(ruleHits)를 부여
   - 보고서 상단에 질문별 이벤트 리스트 출력.

6. **Episode(사건) 클러스터링**
   - 동일 병원·질환 클러스터를 기간/횟수로 묶어 Episode로 요약
   - “통원기간 / n회 / 핵심 검사·수술” 형식 문장 생성.

7. **Self-Confidence & 안전모드**
   - 엔진 스스로 “이 케이스는 분석 신뢰도가 낮다”를 감지
   - 신뢰도 낮을 시,
     - Core 선정 기준을 완화하거나
     - Full Timeline 위주의 안전모드로 전환.

## 4. 비기능 요구사항

- 설명가능성:
  - 각 Core 이벤트에 대해
    - sourceSpan(원문 위치)
    - 적용된 룰(ruleId)
    - 고지·심사 질문 ID(questionId)
  - 를 항상 제공할 것.

- 운영성:
  - 평가 스크립트/대시보드를 통해 A/B 지표 추이를 관리
  - 코드 변경 시 자동으로 case_sample 전체에 대한 평가 실행.

- 보안/개인정보:
  - 주민번호/연락처/주소 등 PII 마스킹 옵션
  - 평가/로그에는 원문 전체 대신 sourceSpan preview만 저장.
