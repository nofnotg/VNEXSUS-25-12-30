<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>손해사정보고서 통합 개선계획서 (후처리 + 코어엔진)</title>
  <style>
    :root { --bg:#0f1217; --card:#141923; --text:#e6edf3; --muted:#9aa4af; --accent:#58a6ff; --good:#2ea043; --warn:#d29922; --bad:#f85149; }
    body { margin:0; font-family:Segoe UI, Roboto, Apple SD Gothic Neo, Malgun Gothic, sans-serif; background:var(--bg); color:var(--text); }
    .container { max-width:1100px; margin:40px auto; padding:0 20px; }
    h1 { font-size:26px; margin:0 0 14px; }
    h2 { font-size:20px; margin:30px 0 10px; }
    p, li { line-height:1.6; }
    .card { background:var(--card); border:1px solid #222; border-radius:10px; padding:18px; margin:16px 0; }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; }
    .badge { display:inline-block; font-size:12px; padding:2px 8px; border-radius:20px; background:#1b2130; color:var(--muted); margin-left:8px; }
    .small { font-size:12px; }
    .muted { color:var(--muted); }
    code { background:#0e1420; color:#a8c1ff; padding:1px 6px; border-radius:6px; }
    .table { width:100%; border-collapse:collapse; margin-top:8px; }
    .table th, .table td { border:1px solid #243042; padding:8px; text-align:left; font-size:13px; }
    .table th { background:#182032; color:#cbd4de; }
    .table tr:nth-child(even) { background:#11161f; }
  </style>
</head>
<body>
  <div class="container">
    <h1>손해사정보고서 통합 개선계획서</h1>
    <p class="muted">기존 후처리(거대 날짜 블록·9~10항목 스켈레톤)과 코어엔진(엔티티 정규화·신뢰도·AI 합성)을 결합하여, 누락 없이 풍성하고 전문적인 보고서를 안정적으로 생성하기 위한 개선 계획입니다.</p>

    <div class="card">
      <h2>참조 문서</h2>
      <ul>
        <li>손해사정 보고서 프롬프트: <code>c:\VNEXSUS_Bin\손해사정_보고서_프롬프트.txt</code></li>
        <li>손해사정 보고서 프롬프트 (복제본): <code>c:\VNEXSUS_Bin\src\rag\손해사정 보고서 프롬프트.txt</code></li>
        <li>고지의무 위반 프롬프트: <code>c:\VNEXSUS_Bin\src\rag\고지의무위반 프롬프트.txt</code></li>
        <li>질환별 검사결과 적용 규칙 통합: <code>c:\VNEXSUS_Bin\src\rag\손해사정보고서 자동작성용 AI 프롬프트)질환별 검사결과 적용교칙 통합버전.txt</code></li>
        <li>프롬프트 통합 심층분석: <code>c:\VNEXSUS_Bin\reports\프롬프트_통합_심층분석_리포트.html</code></li>
        <li>Report_Sample.txt: 내부 샘플 보고서(경로 참조 필요)</li>
      </ul>
    </div>

    <div class="card">
      <h2>목표</h2>
      <ul>
        <li>구조(후처리)와 내용·근거(코어엔진)의 계약을 명확히 정의해 충돌·누락 최소화</li>
        <li>질환별 검사셋·고지의무 자동 검토·결재용 요약본을 표준 규칙으로 내장</li>
        <li>품질 예산(건당 3–5분)을 멀티 패스로 운용, 정확·일관·풍성 동시 달성</li>
      </ul>
    </div>

    <div class="card">
      <h2>항목 순서 재정렬 제안 (9–10항목)</h2>
      <table class="table">
        <tr><th>권장 순서</th><th>설명</th></tr>
        <tr><td>1) 요약/식별</td><td>계약일, 청구진단, 환자/병원 식별, 문서 범위</td></tr>
        <tr><td>2) 타임라인·앵커</td><td>내원·입원·퇴원·통원 앵커 정리(역전/중복 금지)</td></tr>
        <tr><td>3) 진단병명</td><td>원문+한글 병기, 표준코드(가능 시), 암은 TNM/원발·전이</td></tr>
        <tr><td>4) 검사결과(핵심)</td><td>영상·정밀검사 중심(시행일/보고일/소견), 질환별 필수셋 적용</td></tr>
        <tr><td>5) 치료내용</td><td>수술·시술·투약·처치 구체화, 조직검사 결과(암)</td></tr>
        <tr><td>6) 병원 경과</td><td>일자별 경과표(일자/경과/검사/치료), 요약 코멘트</td></tr>
        <tr><td>7) 입원/통원 기간</td><td>기간·일수·횟수 산정, 분류 명확화</td></tr>
        <tr><td>8) 과거병력(관련성)</td><td>청구진단과 연관성 높은 과거 내역 선별</td></tr>
        <tr><td>9) 고지의무 검토</td><td>3개월/2년/5년 윈도우 자동 분류·의심 라벨·인과관계</td></tr>
        <tr><td>10) 종합 판단/결재용 요약</td><td>약관 적용, 지급 판단, 핵심 요약(고정 템플릿)</td></tr>
      </table>
      <p class="muted small">기존 항목을 유지하되, 타임라인·검사·고지의무·요약의 위치를 조정하여 독해 흐름과 증거 일관성을 강화합니다.</p>
    </div>

    <div class="card">
      <h2>내용 풍성화 전략</h2>
      <ul>
        <li>질환별 검사셋 내장: 협심증/AMI/부정맥/뇌혈관/암 등 필수 검사 목록을 규칙화</li>
        <li>증거 스니펫·출처 링크 기본 포함(원문 인용, 시행/보고일 병기)</li>
        <li>동의어·약어 표준화(병원별 템플릿 캐시 + 도메인 사전)</li>
        <li>원발/전이 라인 고정 출력(암), TNM 가능 시 포함</li>
      </ul>
    </div>

    <div class="card">
      <h2>고지의무 위반 인식·정리</h2>
      <ul>
        <li>윈도우: <code>±90일/±730일/±1825일</code> 기준 자동 분류</li>
        <li>키워드: 의심/진단/수술/입원/추가검사/재검사/확정/중대질환 등</li>
        <li>결과: 해당 진료 라벨링 + 요약 박스 + 인과관계 설명</li>
        <li>입력: <code>contract_date</code>와 타임라인 앵커를 후처리에서 보장</li>
      </ul>
    </div>

    <div class="card">
      <h2>최종 보고용 요약 규칙</h2>
      <ul>
        <li>결재용 요약 템플릿 고정: 내원/진단/검사/치료/기간/과거/의사소견/원발·전이</li>
        <li>필수 지표: 고지의무 해당 내역 수, 입원일수·통원횟수, 핵심 검사·수술</li>
        <li>운영 모드: <code>qualityLevel</code>에 따라 요약의 간결/상세 조절</li>
      </ul>
    </div>

    <div class="card">
      <h2>통합 파이프라인 구현 계획</h2>
      <pre class="small" style="white-space:pre-wrap; background:#0e1420; padding:10px; border-radius:8px; border:1px solid #223;">POST /api/unified-report/generate
Body: { extractedText, patientInfo, contract_date, claim_diagnosis, qualityLevel }
Flow:
  1) PostProcessingManager: 대량 날짜 블록 + 전처리 + 앵커 생성
  2) EnhancedDnaValidator Stage1–4: 세그멘트/타임라인/정규화/AI 합성
  3) DiseaseRules 적용: 질환별 필수 검사셋 반영(영상·정밀 중심)
  4) NineItemReportGenerator: 9–10항목 조립 + 증거 스니펫
  5) DisclosureRules: 3/24/60개월(±90/730/1825일) 자동 분류·요약 박스
  6) DynamicValidationEngine: 누락/충돌/신뢰도 게이트 → 재시도/보강/폴백
  7) 출력: HTML/PDF/JSON(요약/상세/인쇄 모드)
      </pre>
    </div>

    <div class="card">
      <h2>품질 예산(3–5분) 운용안</h2>
      <ul>
        <li>초안(30–45초): 스켈레톤+앵커+핵심 진단/검사 라인</li>
        <li>보강(60–90초): 누락/의심 구간만 리트리벌, 스니펫/링크 채우기</li>
        <li>검토(60–120초): 날짜·수치·코드 검증, 충돌·경고 박스, 레드팀 질문</li>
      </ul>
    </div>

    <div class="card">
      <h2>케이스 배치 검증</h2>
      <ul>
        <li>대상: 최소 8–10건(가능 시 12+), AI 보고서 vs 실보고서 비교</li>
        <li>지표: 정확도/완결성/일관성/근거성, 고지의무 탐지 적중률</li>
        <li>튜닝: 임계치(신뢰도/누락/충돌), 윈도우 폭, 질환별 검사셋 우선순위</li>
      </ul>
    </div>

    <div class="card">
      <h2>Dev Studio 연동</h2>
      <ul>
        <li>토글: <code>qualityLevel</code>, <code>DisclosureRules</code>, <code>DiseaseRules</code> on/off</li>
        <li>대시보드: 원문/AI/최종 보고서 3분할, 경고 유형·처리시간·재시도 수 표시</li>
        <li>내보내기: HTML/PDF/JSON + 결재용 요약 자동 생성</li>
      </ul>
    </div>

    <div class="card">
      <h2>마일스톤</h2>
      <ul>
        <li>W1: 통합 오케스트레이터 초안 + 항목 재정렬 반영</li>
        <li>W2: 질환별 검사셋/고지의무 규칙 내장 + 검증 게이트</li>
        <li>W3: Dev Studio 토글/대시보드 + 8–10건 배치 비교</li>
        <li>W4: 임계치 튜닝 + 결재용 요약 안정화 + 문서화</li>
      </ul>
    </div>
  </div>
</body>
</html>