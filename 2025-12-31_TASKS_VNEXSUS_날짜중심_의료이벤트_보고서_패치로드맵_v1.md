# 2025-12-31 TASKS — VNEXSUS 날짜중심 의료이벤트·보고서 안정화 (v1)

> 목적: “정확한 날짜” 기반 의료이벤트를 안정적으로 추출하고, 10항목 보고서가 끊김 없이 출력되도록 한다.  
> 원칙: 판단 금지, 객관적 사실 + 근거/확인요망 중심.

---

## Patch-01 — Vision OCR Only 파이프라인 슬림화

- [ ] (코드) Textract/Tesseract 호출 경로 식별 및 제거(분기/환경변수/의존성)
- [ ] (설정) .env.example / config / CI 스크립트에서 관련 항목 제거
- [ ] (문서) OCR 엔진 선택 문서 갱신: “Vision only”로 단일화
- [ ] (회귀) 샘플 PDF 10개로 OCR→텍스트→이벤트 수 비교(제거 전/후)

## Patch-02 — 좌표 기반 Date Binding v3

- [ ] (전처리) 페이지 레이아웃 분석: 헤더/푸터/테이블 후보 탐지 규칙 강화
- [ ] (좌표) 날짜 후보 bbox와 텍스트 블록 bbox 거리 기반 클러스터링 구현
- [ ] (문맥) 날짜 키워드(내원일/수술일/보고일/판독일 등) 스코어링
- [ ] (Fallback) 텍스트-only 바인딩 로직의 confidence/확인요망 규칙 정리
- [ ] (평가) 이벤트 핵심군(입원/수술/조직검사/영상검사) 날짜 바인딩 정확도 측정 스크립트

## Patch-03 — 10항목 보고서 템플릿/스키마 고정

- [ ] (스키마) Event JSON 스키마 v1 정의(10항목 + optional meta)
- [ ] (템플릿) Full Report(확장형) 생성기: 날짜순 이벤트 렌더
- [ ] (템플릿) Summary(결재용) 생성기: 10항목 고정 출력
- [ ] (출력) Markdown/HTML/JSON 최소 2종 동일 스키마 보장
- [ ] (가독성) ‘기타/메모’는 확장 영역으로만(고정 10항목은 변형 금지)
- [ ] (회귀) report_sample 구조 데이터로 샘플 출력 테스트

## Patch-04 — 가중치·연관성 스코어링(소수점 민감도)

- [ ] (피처) severity / proximity / doc_strength / relevance / repetition / trigger 피처 정의
- [ ] (계수) 기본 weight 세트(초기값) + config로 외부조정 가능하게
- [ ] (산식) sigmoid 기반 score 0.000~1.000, 소수점 3자리 출력
- [ ] (연관성) 이벤트 간 rel score 산출(진단군/기관/부위/시간/검사 연쇄)
- [ ] (표시) Full Report에 “가중치/연관 이벤트”를 optional meta로만 노출

## Patch-05 — Web→RAG 자동확장(코드/용어/검사 표준화)

- [ ] (저장소) RAG 저장 구조 결정(SQL 테이블 + 벡터 인덱스 분리 권장)
- [ ] (조회) ICD/KCD 코드↔영문↔한글 우선 조회 API
- [ ] (웹보완) 미존재 시 1회 웹조회 → 결과 캐시/적재(출처/날짜/신뢰도 메타 포함)
- [ ] (정책) “1회성 금지”: 적재 실패 시 재시도 정책/오류 로깅
- [ ] (테스트) 코드만 있는 케이스 / 한글명만 있는 케이스 각각 보완 확인

## Patch-06 — 후처리 로직 정리 및 테스트 케이스 통합(경량화)

- [ ] (정리) 특정 케이스 전용 후처리 분기 목록화(사용 여부 기준)
- [ ] (아카이브) 실험/프로토타입 이동: /_archive 또는 /experiments
- [ ] (테스트) 표준 케이스 세트(최소 30개) 선정 및 골든 출력 저장
- [ ] (회귀) 골든 출력 대비 변경점(diff) 리포트 자동화
- [ ] (문서) 개발 규칙: “코어 엔진 변경 시 반드시 회귀테스트” 추가

---

## 릴리즈 체크리스트

- [ ] 10항목 보고서(요약본) 항목 누락 없이 출력(미기재 허용)
- [ ] 날짜 바인딩 실패 이벤트에 “확인요망” 자동 표기
- [ ] Vision OCR 파이프라인 단일화 완료(미사용 엔진 완전 제거)
- [ ] RAG 웹보완 결과가 누적 저장됨(재활용 가능)
