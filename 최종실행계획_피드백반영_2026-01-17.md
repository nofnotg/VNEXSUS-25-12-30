# VNEXSUS MVP 최종 실행 계획 (피드백 반영)

**작성일**: 2026-01-17
**PM 피드백**: 7가지 반영 완료
**우선순위**: MVP 기능 구현 최우선

---

## 🎯 핵심 원칙

1. **현재 파이프라인 보호**: 파일업로드 → OCR → 룰엔진 → AI보고서 생성 절대 건드리지 않음
2. **롤백 포인트**: 모든 변경 전 백업 브랜치 생성
3. **MVP 우선**: 30명 배포는 MVP 이후
4. **3D 벡터는 마지막**: 시급하지 않으나 중요한 내용

---

## 📅 Phase 1: 즉시 조치 (1-2주) - **현재 진행 중**

### ✅ 완료 항목
- [x] 롤백 포인트 생성: `backup/stable-mvp-2026-01-17`
- [x] 항목명 관용 표현 딕셔너리 구축 (`sectionNameDictionary.json`)
- [x] 항목명 매핑 로직 구현 (`sectionNameMapper.js`)
- [x] 저가치 정보 접기/펴기 모듈 (`lowValueInfoCollapsible.js`)

### ⬜ 진행 예정
- [ ] Textract 코드 완전 제거 (~800 라인)
  - `backend/services/textractService.js` 삭제
  - `backend/backup/textractService_TextractOCR_stay.js` 삭제
  - 의존성 검증 (grep 검색)

- [ ] Tesseract 사용 여부 확인
  - 실제 사용 중인지 코드 추적
  - 미사용 시 package.json에서 제거

- [ ] 테스트 파일 정리
  - `/tests/` 디렉토리로 이동
  - 중복 테스트 파일 제거

**예상 소요**: 3-5일
**담당**: 백엔드팀
**위험도**: Low (현재 파이프라인 영향 없음)

---

## 📅 Phase 2: MVP 기능 완성 (2-3주)

### 2.1 Gemini Flash 통합 (피드백 2)

**목표**: 비용 절감 + A/B 테스트

```javascript
// 복잡도 기반 자동 라우팅
if (documentComplexity < 0.5) {
  service = 'geminiFlash';  // 간단 → $0.075/1M (저렴)
} else if (documentComplexity < 0.8) {
  service = 'gpt4oMini';    // 중간 → $0.15/1M (가성비)
} else {
  service = 'sonnet';       // 복잡 → $3/1M (고품질)
}
```

**구현 위치**: `src/services/aiServiceIntegration.js` 확장
**예상 효과**: 비용 15-20% 절감
**소요 시간**: 3-5일

### 2.2 관용적 표현 통합 (피드백 5)

**적용 위치**:
1. `medicalEventModel.js` - 이벤트 생성 시 섹션명 표준화
2. `reportBuilder.js` - 보고서 생성 시 표준명 사용
3. LLM 프롬프트 - "항목명을 다음 중 하나로 정규화: ..."

**테스트 케이스**:
- "진단명" → "진단병명" ✅
- "F-U" → "치료내용" ✅
- "기왕력" → "과거병력" ✅
- "Lab" → "검사결과" ✅

**소요 시간**: 2-3일

### 2.3 저가치 정보 UI 적용 (피드백 6)

**적용 범위**:
- HTML 보고서: 접기/펴기 버튼
- Markdown 보고서: `<details>` 태그
- JSON 보고서: `displaySuggestions` 메타데이터
- Excel 보고서: 별도 시트 (기본 숨김)

**가중치 기준**:
- High (≥0.7): 주요 정보 (항상 표시)
- Medium (0.4-0.7): 보조 정보 (기본 표시)
- Low (<0.4): 저가치 정보 (접기)

**소요 시간**: 3-4일

### 2.4 원본 문맥 보존 강화 (피드백 4)

**변경 사항**:
```javascript
// 기존: LLM이 요약
{ diagnosis: "간담도계 혈관종", size: "8x6cm" }

// 개선: 원문 보존
{
  diagnosis: {
    name: "간담도계 혈관종",
    size: "8x6cm",
    확정도: "소견"  // 원문 용어 유지
  },
  원문: "간담도계 혈관종 8*6cm 소견으로...",
  출처: { 페이지: 3, 좌표: {x:100, y:250}, 신뢰도: 0.92 }
}
```

**LLM 프롬프트 수정**:
```
기존: "진단명을 추출하세요"
개선: "진단명을 의무기록에 표현된 그대로 인용하세요. 요약하지 마세요."
```

**소요 시간**: 2-3일

**Phase 2 총 소요**: 2-3주
**담당**: 전체팀
**위험도**: Low-Medium (점진적 통합)

---

## 📅 Phase 3: Legacy 코드 정리 (3-4주) - **현재 파이프라인 영향 최소화**

### 3.1 안전한 Legacy 제거 전략

**원칙**: 삭제가 아닌 "숨기기"

```bash
# 1단계: .backup/ 디렉토리 생성
mkdir -p backend/postprocess/.backup

# 2단계: Legacy 파일 이동 (삭제 아님!)
mv backend/postprocess/massiveDateBlockProcessor.js \
   backend/postprocess/.backup/

mv backend/postprocess/medicalDocumentNormalizer.js \
   backend/postprocess/.backup/

# 3단계: import 경로 Enhanced로 전환
# 모든 참조를 Enhanced 버전으로 변경

# 4단계: 테스트 (10회 반복)
for i in {1..10}; do
  npm test
done

# 문제 발생 시:
mv backend/postprocess/.backup/* backend/postprocess/
# 즉시 복구 가능
```

### 3.2 제거 대상 (단계별)

**Week 1**: 사용 빈도 0인 파일
- `massiveDateBlockProcessor.js` (Enhanced 버전 사용 중)
- 중복 테스트 파일 11개

**Week 2**: 사용 빈도 낮은 파일
- `medicalDocumentNormalizer.js` (Hybrid 버전 사용 중)
- `aiEntityExtractor.js` (Enhanced 버전 사용 중)

**Week 3**: 검증 및 최종 정리
- 전체 파이프라인 100회 테스트
- 의존성 맵 재검증
- .backup/ 디렉토리 아카이브

**Week 4**: 문서화
- 변경 사항 문서화
- 롤백 절차 문서화

**Phase 3 총 소요**: 3-4주
**담당**: 백엔드팀 + QA팀
**위험도**: Medium (단계별 진행으로 최소화)

---

## 📅 Phase 4: MVP 테스트 및 안정화 (2-3주)

### 4.1 기능 테스트

**테스트 케이스**:
1. 항목명 관용 표현 매핑 (50개 샘플)
2. 저가치 정보 접기/펴기 (UI 검증)
3. 원본 문맥 보존 (원문 vs 요약 비교)
4. Gemini Flash 비용/정확도 비교

### 4.2 성능 테스트

- 100페이지 문서 10건 처리
- 동시 사용자 5명 시뮬레이션
- 메모리/CPU 사용률 모니터링

### 4.3 사용자 테스트

- 내부 사용자 3-5명
- 실제 의료 문서 20건 처리
- 피드백 수집 및 개선

**Phase 4 총 소요**: 2-3주
**담당**: QA팀 + PM
**위험도**: Low

---

## 📅 Phase 5: 배포 및 확장 준비 (MVP 이후)

### 5.1 인프라 준비 (베타 30명 대비)

**현재**: 추정 4 vCPU, 8GB RAM
**목표**: 8 vCPU, 16GB RAM (최소) / 16 vCPU, 32GB (권장)

**조치 사항**:
- Rate Limiting 강화 (10명 동시)
- OCR 캐싱 구현 (Redis)
- 모니터링 대시보드 (Grafana)

### 5.2 비용 최적화

- Gemini Flash 통합으로 15-20% 절감
- OCR 캐싱으로 30% 절감
- 예상 월 비용: $1,300-$1,600 (30명 기준)

**Phase 5 총 소요**: 1-2개월
**담당**: DevOps + PM
**위험도**: Medium

---

## 📅 Phase 6: 고도화 (정식 런칭 이후)

### 6.1 질문 기반 추출 (피드백 3)

**타이밍**: MVP 검증 후 3-6개월
**조건**:
- 현재 방식 정확도 95%+ 달성
- VLM API 비용 50% 이상 하락
- 베타 피드백 100건 이상

### 6.2 3D 벡터 좌표 시스템 (피드백 7)

**타이밍**: 정식 런칭 후 6-12개월
**조건**:
- 처리 문서 1,000건 이상 확보
- DocumentVector 데이터 수집 완료
- 클러스터링 알고리즘 검증 완료

**우선순위**: **최하위 (시급하지 않으나 중요)**

**Phase 6 총 소요**: 6-12개월
**담당**: AI팀
**위험도**: Low

---

## 📊 전체 타임라인

```
현재 (2026-01-17)
│
├─ Week 1-2: Phase 1 완료 (즉시 조치)
│   ├─ 항목명 매핑 ✅
│   ├─ 저가치 정보 UI ✅
│   └─ Textract 제거 ⬜
│
├─ Week 3-5: Phase 2 (MVP 기능)
│   ├─ Gemini Flash 통합
│   ├─ 관용 표현 통합
│   └─ 원본 문맥 보존
│
├─ Week 6-9: Phase 3 (Legacy 정리)
│   └─ 안전한 코드 제거
│
├─ Week 10-12: Phase 4 (MVP 테스트)
│   └─ 기능/성능/사용자 테스트
│
└─ MVP 완료 (예상: 2026-04 중순)
    │
    ├─ Phase 5: 배포 준비 (1-2개월)
    │   └─ 베타 30명 대응
    │
    └─ Phase 6: 고도화 (6-12개월)
        ├─ 질문 기반 추출
        └─ 3D 벡터 좌표
```

---

## 🔒 안전장치 (Safety Measures)

### 1. 롤백 포인트

```bash
# 현재 안전 백업
git branch backup/stable-mvp-2026-01-17  ✅

# Phase별 추가 백업
git branch backup/after-phase-1
git branch backup/after-phase-2
git branch backup/after-phase-3
```

### 2. 파이프라인 보호

**절대 수정 금지 파일**:
- `backend/controllers/ocrController.js` (OCR 호출)
- `backend/services/visionService.js` (Vision API)
- `backend/routes/apiRoutes.js` (라우팅)

**수정 허용 (주의 필요)**:
- `backend/postprocess/*` (Legacy 제거만)
- `src/services/*` (통합 추가만)

### 3. 테스트 프로토콜

**모든 변경 후 필수 테스트**:
```bash
# 1. 단위 테스트
npm test

# 2. 통합 테스트 (3개 샘플 문서)
npm run test:integration

# 3. 파이프라인 end-to-end (10회 반복)
for i in {1..10}; do
  npm run test:pipeline
done
```

---

## 💰 예상 비용 (MVP)

| 항목 | 비용 |
|------|------|
| 개발 인력 (12주 × 3명) | 시간 투자 |
| 인프라 (현재) | ~$250/월 |
| API (개발/테스트) | ~$100/월 |
| **총계 (3개월)** | **~$1,050** |

---

## 📈 성공 지표 (KPI)

### MVP 완료 기준

- [ ] 항목명 매핑 정확도 95%+
- [ ] 저가치 정보 UI 적용률 100%
- [ ] 원본 문맥 보존율 90%+
- [ ] Legacy 코드 50,000 라인 제거
- [ ] 전체 테스트 통과율 100%
- [ ] 파이프라인 안정성 (10회 연속 성공)

### 베타 준비 기준

- [ ] 동시 사용자 10명 처리 가능
- [ ] 평균 처리 시간 < 2분 (100페이지)
- [ ] 메모리 사용량 < 8GB
- [ ] API 비용 < $2,000/월 (30명 기준)

---

## 👥 담당 및 역할

| 역할 | 담당자 | 책임 |
|------|--------|------|
| **PM** | 사용자 | 전체 조율, 우선순위 결정 |
| **백엔드** | TBD | Legacy 제거, 통합 구현 |
| **AI** | TBD | LLM 프롬프트, Gemini 통합 |
| **QA** | TBD | 테스트, 검증 |
| **DevOps** | TBD | 인프라, 배포 (Phase 5) |

---

## 📝 다음 단계 (즉시 실행)

1. ✅ 이 문서 검토 및 승인
2. ⬜ Phase 1 완료
   - Textract 제거
   - Tesseract 검증
3. ⬜ Phase 2 착수
   - Gemini Flash 통합 시작
4. ⬜ 주간 진행 상황 체크

---

**문서 버전**: 1.0
**최종 수정**: 2026-01-17
**다음 리뷰**: Phase 1 완료 시
